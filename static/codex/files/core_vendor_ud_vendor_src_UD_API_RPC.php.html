<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core/vendor/ud/vendor/src/UD/API/RPC.php - Flawless</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://a3d72a45d111006ec192-ec5b80a12b0b09b4d52373336afb4254.r80.cf1.rackcdn.com/usability-dynamics.png" title="Flawless"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/: Flawless.Element.html">: Flawless.Element</a></li>
            
                <li><a href="../classes/: Flawless.Flawless_Module.html">: Flawless.Flawless_Module</a></li>
            
                <li><a href="../classes/: Flawless.Flawless_Shortcode.html">: Flawless.Flawless_Shortcode</a></li>
            
                <li><a href="../classes/: Flawless.Flawless_Widget.html">: Flawless.Flawless_Widget</a></li>
            
                <li><a href="../classes/: Flawless.flawless_wpp_extensions.html">: Flawless.flawless_wpp_extensions</a></li>
            
                <li><a href="../classes/: Flawless.License.html">: Flawless.License</a></li>
            
                <li><a href="../classes/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../classes/Template Functions.html">Template Functions</a></li>
            
                <li><a href="../classes/Template Methods.html">Template Methods</a></li>
            
                <li><a href="../classes/Theme UI.html">Theme UI</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Core Assets.html">Core Assets</a></li>
            
                <li><a href="../modules/Flawless.html">Flawless</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: core/vendor/ud/vendor/src/UD/API/RPC.php</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&lt;?php

namespace UD\API;

/**
 * WP-Invoice XML-RPC API Class
 *
 * @since 3.08.7
 * @author korotkov@ud
 */
class RPC {

  /**
   * API Name
   *
   * @var string
   */
  public $name = &#x27;RPC&#x27;;

  /**
   * API Description
   *
   * @var string
   */
  public $description = &#x27;WP-Invoice XML-RPC API Handler. Can be used by authorized users by calling single method &quot;wp.invoice&quot; with arguments described in API Reference.&#x27;;

  /**
   * Initialize
   */
  function __construct() {
    //** Extend standard XML-RPC */
    add_filter( &#x27;xmlrpc_methods&#x27;, array( __CLASS__, &#x27;__register&#x27; ) );
    add_action( &#x27;wpi_settings_before_help&#x27;, &#x27;wpi_help_api_reference&#x27; );
  }

  /**
   * Register method-hook
   *
   * @param array $methods
   *
   * @return array
   */
  function __register( $methods ) {
    $methods[ &#x27;wp.invoice&#x27; ] = &#x27;wpi_xmlrpc_request&#x27;;
    return $methods;
  }

  /**
   * Create new invoice
   *
   * @param array $args
   *
   * @return UD_Invoice
   * @see UD_Invoice
   * @uses Internal API of plugin
   */
  function create_invoice( $args = array() ) {
    global $wpi_settings;

    //** Default arguments */
    $defaults = array(
      &#x27;custom_id&#x27; =&gt; false,
      &#x27;subject&#x27; =&gt; false,
      &#x27;description&#x27; =&gt; false,
      &#x27;type&#x27; =&gt; false,
      &#x27;user_data&#x27; =&gt; array(
        &#x27;user_email&#x27; =&gt; false,
        &#x27;first_name&#x27; =&gt; false,
        &#x27;last_name&#x27; =&gt; false,
        &#x27;phonenumber&#x27; =&gt; false,
        &#x27;streetaddress&#x27; =&gt; false,
        &#x27;city&#x27; =&gt; false,
        &#x27;state&#x27; =&gt; false,
        &#x27;zip&#x27; =&gt; false,
        &#x27;country&#x27; =&gt; false
      ),
      &#x27;deposit&#x27; =&gt; false,
      &#x27;due_date&#x27; =&gt; array(
        &#x27;year&#x27; =&gt; false,
        &#x27;month&#x27; =&gt; false,
        &#x27;day&#x27; =&gt; false
      ),
      &#x27;currency&#x27; =&gt; false,
      &#x27;tax&#x27; =&gt; false,
      &#x27;tax_method&#x27; =&gt; false,
      &#x27;recurring&#x27; =&gt; array(
        &#x27;unit&#x27; =&gt; false,
        &#x27;length&#x27; =&gt; false,
        &#x27;cycles&#x27; =&gt; false,
        &#x27;send_invoice_automatically&#x27; =&gt; false,
        &#x27;start_date&#x27; =&gt; array(
          &#x27;month&#x27; =&gt; false,
          &#x27;day&#x27; =&gt; false,
          &#x27;year&#x27; =&gt; false
        )
      ),
      &#x27;status&#x27; =&gt; false,
      &#x27;discount&#x27; =&gt; array(
        &#x27;name&#x27; =&gt; false,
        &#x27;type&#x27; =&gt; false,
        &#x27;amount&#x27; =&gt; false
      ),
      &#x27;items&#x27; =&gt; array(),
      &#x27;charges&#x27; =&gt; array()
    );

    //** Parse arguments */
    extract( $args = wp_parse_args( $args, $defaults ) );

    //** If empty subject - return error */
    if ( !$subject ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Method requires &quot;subject&quot; argument to be passed.&#x27;, WPI ), $args );

    //** If empty user_email - return error */
    if ( !$user_data[ &#x27;user_email&#x27; ] ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Method requires &quot;user_email&quot; in &quot;user_data&quot; argument to be passed.&#x27;, WPI ), $args );
    if ( !filter_var( $user_data[ &#x27;user_email&#x27; ], FILTER_VALIDATE_EMAIL ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;User Email is malformed.&#x27;, WPI ), $args );

    //** Items/Charges check */
    if ( empty( $items ) &amp;&amp; empty( $charges ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Method requires &quot;items&quot; or &quot;charges&quot; argument to be passed.&#x27;, WPI ), $args );

    //** If type is registered */
    if ( !array_key_exists( $type, $wpi_settings[ &#x27;types&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Unknown invoice type.&#x27;, WPI ), $args );

    //** If recurring */
    if ( $type == &#x27;recurring&#x27; ) {
      $recurring = array_filter( $recurring );
      if ( empty( $recurring[ &#x27;unit&#x27; ] ) || empty( $recurring[ &#x27;cycles&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Method requires correct &quot;recurring&quot; argument if &quot;type&quot; is recurring.&#x27;, WPI ), $args );
      if ( !empty( $deposit ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Cannot use &quot;deposit&quot; with &quot;recurring&quot; type.&#x27;, WPI ), $args );
    }

    //** If quote */
    if ( $type == &#x27;quote&#x27; ) {
      if ( !empty( $deposit ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Cannot use &quot;deposit&quot; with &quot;quote&quot; type.&#x27;, WPI ), $args );
    }

    //** Check status */
    if ( !$status ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Method requires &quot;status&quot; argument to be passed.&#x27;, WPI ), $args );
    if ( !array_key_exists( $status, $wpi_settings[ &#x27;invoice_statuses&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Unknown invoice status.&#x27;, WPI ), $args );

    //** New Invoice object */
    $invoice = new UD_Invoice();

    //** Load invoice by ID */
    $invoice-&gt;create_new_invoice( $args );

    //** Set type */
    $invoice-&gt;set( array(
      &#x27;type&#x27; =&gt; $type
    ) );

    //** If quote */
    if ( $type == &#x27;quote&#x27; ) {
      $invoice-&gt;set( array( &#x27;status&#x27; =&gt; $type ) );
      $invoice-&gt;set( array( &#x27;is_quote&#x27; =&gt; &#x27;true&#x27; ) );
    }

    //** Recurring */
    if ( $type == &#x27;recurring&#x27; ) {
      $invoice-&gt;create_schedule( $recurring );
    }

    //** Try loading user by email */
    $invoice-&gt;load_user( array(
      &#x27;email&#x27; =&gt; $user_data[ &#x27;user_email&#x27; ]
    ) );

    //** If new user - add data to his object */
    if ( empty( $invoice-&gt;data[ &#x27;user_data&#x27; ] ) ) {
      $invoice-&gt;data[ &#x27;user_data&#x27; ] = $user_data;
    }

    //** Create/Update user if need */
    UD_Functions::update_user( $user_data );

    //** Try loading user by email again */
    $invoice-&gt;load_user( array(
      &#x27;email&#x27; =&gt; $user_data[ &#x27;user_email&#x27; ]
    ) );

    //** Partial payments */
    if ( $deposit ) {
      $invoice-&gt;set( array( &#x27;deposit_amount&#x27; =&gt; $deposit ) );
    } else {
      $invoice-&gt;set( array( &#x27;deposit_amount&#x27; =&gt; 0 ) );
    }

    //** Due date */
    $invoice-&gt;set( array( &#x27;due_date_year&#x27; =&gt; $due_date[ &#x27;year&#x27; ] ) );
    $invoice-&gt;set( array( &#x27;due_date_month&#x27; =&gt; $due_date[ &#x27;month&#x27; ] ) );
    $invoice-&gt;set( array( &#x27;due_date_day&#x27; =&gt; $due_date[ &#x27;day&#x27; ] ) );

    //** Currency */
    $invoice-&gt;set( array( &#x27;default_currency_code&#x27; =&gt; $currency ) );

    //** Tax */
    $invoice-&gt;set( array( &#x27;tax&#x27; =&gt; $tax ) );

    //** Status */
    $invoice-&gt;set( array( &#x27;post_status&#x27; =&gt; $status ) );

    //** Discount */
    $discount = array_filter( $discount );
    if ( !empty( $discount ) ) {
      if ( empty( $discount[ &#x27;name&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Discount name is required.&#x27;, WPI ), $args );
      if ( empty( $discount[ &#x27;type&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Discount type is required. (&quot;amount&quot; or &quot;percent&quot;).&#x27;, WPI ), $args );
      if ( empty( $discount[ &#x27;amount&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Discount amount is required.&#x27;, WPI ), $args );
      $invoice-&gt;add_discount( $discount );
    }

    //** Items */
    foreach ( $items as $item ) {
      //** Do not allow to save melformed items */
      if ( empty( $item[ &#x27;name&#x27; ] ) ||
        empty( $item[ &#x27;quantity&#x27; ] ) ||
        empty( $item[ &#x27;price&#x27; ] )
      ) {
        return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;One or more &quot;items&quot; have malformed structure. Cannot create Invoice.&#x27;, WPI ), $args );
      }

      //** Global tax has higher priority */
      if ( !empty( $tax ) ) $item[ &#x27;tax_rate&#x27; ] = $tax;

      //** Check types */
      if ( !is_numeric( $item[ &#x27;quantity&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;One or more &quot;items&quot; have wrong &quot;quantity&quot; value. Cannot create Invoice.&#x27;, WPI ), $args );
      if ( !is_numeric( $item[ &#x27;price&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;One or more &quot;items&quot; have wrong &quot;price&quot; value. Cannot create Invoice.&#x27;, WPI ), $args );
      if ( !empty( $item[ &#x27;tax_rate&#x27; ] ) ) {
        if ( !is_numeric( $item[ &#x27;tax_rate&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;One or more &quot;items&quot; have wrong &quot;tax_rate&quot; value. Cannot create Invoice.&#x27;, WPI ), $args );
      }

      //** If passed validation - save item */
      $invoice-&gt;line_item( $item );
    }

    //** Charges */
    foreach ( $charges as $charge ) {
      //** Do not allow to save melformed items */
      if ( empty( $charge[ &#x27;name&#x27; ] ) ||
        empty( $charge[ &#x27;amount&#x27; ] )
      ) {
        return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;One or more &quot;charges&quot; have malformed structure. Cannot create Invoice.&#x27;, WPI ), $args );
      }

      //** Global tax has higher priority */
      if ( !empty( $tax ) ) $charge[ &#x27;tax&#x27; ] = $tax;

      //** Check types */
      if ( !is_numeric( $charge[ &#x27;amount&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;One or more &quot;charges&quot; have wrong &quot;amount&quot; value. Cannot create Invoice.&#x27;, WPI ), $args );
      if ( !empty( $charge[ &#x27;tax&#x27; ] ) ) {
        if ( !is_numeric( $charge[ &#x27;tax&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;One or more &quot;charges&quot; have wrong &quot;tax&quot; value. Cannot create Invoice.&#x27;, WPI ), $args );
      }

      //** If passed validation - save item */
      $invoice-&gt;line_charge( $charge );
    }

    //** Set tax method */
    if ( !empty( $tax_method ) ) {
      if ( $tax_method != &#x27;before_discount&#x27; &amp;&amp; $tax_method != &#x27;after_discount&#x27; ) {
        return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Unknown &quot;tax_method&quot;.&#x27;, WPI ), $args );
      }
    }
    $invoice-&gt;set( array( &#x27;tax_method&#x27; =&gt; $tax_method ) );

    //** Save */
    $invoice-&gt;save_invoice();

    //** Return saved object */
    return $invoice;
  }

  /**
   * Refund invoice by ID
   *
   * @param type $args
   *
   * @return WP_Error|UD_Invoice
   */
  function refund_invoice( $args = array() ) {
    //** Defaults  */
    $defaults = array(
      &#x27;ID&#x27; =&gt; false
    );

    //** Parse arguments */
    extract( wp_parse_args( $args, $defaults ) );

    //** Check */
    if ( !$ID ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Argument &quot;ID&quot; is required.&#x27;, WPI ), $args );

    //** New Invoice object */
    $invoice = new UD_Invoice();

    //** Load invoice by ID */
    $invoice-&gt;load_invoice( array( &#x27;id&#x27; =&gt; $ID ) );

    //** Check */
    if ( !empty( $invoice-&gt;error ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Invoice not found&#x27;, WPI ), $args );

    //** Do refund if it has payments */
    if ( empty( $invoice-&gt;data[ &#x27;total_payments&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Cannot be refunded. No payments found.&#x27;, WPI ), $args );

    $insert_id = $invoice-&gt;add_entry( array(
      &#x27;attribute&#x27; =&gt; &#x27;balance&#x27;,
      &#x27;note&#x27; =&gt; &#x27;Refunded via XML-RPC&#x27;,
      &#x27;amount&#x27; =&gt; (float) $invoice-&gt;data[ &#x27;total_payments&#x27; ],
      &#x27;type&#x27; =&gt; &#x27;refund&#x27;
    ) );
    if ( !$insert_id ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Could not refund due to unknown error.&#x27;, WPI ), $args );

    $invoice-&gt;save_invoice();

    //** Load again to get changes */
    $invoice = new UD_Invoice();
    $invoice-&gt;load_invoice( array( &#x27;id&#x27; =&gt; $ID ) );

    return $invoice;
  }

  /**
   * Pay invoice by ID
   *
   * @param type $args
   *
   * @return WP_Error|UD_Invoice
   */
  function pay_invoice( $args = array() ) {
    //** Default arguments */
    $defaults = array(
      &#x27;ID&#x27; =&gt; false,
      &#x27;amount&#x27; =&gt; false
    );

    //** Parse arguments */
    extract( wp_parse_args( $args, $defaults ) );

    //** Check */
    if ( !$ID ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Argument &quot;ID&quot; is required.&#x27;, WPI ), $args );
    if ( !$amount ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Argument &quot;amount&quot; is required.&#x27;, WPI ), $args );
    if ( !is_numeric( $amount ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Argument &quot;amount&quot; is malformed.&#x27;, WPI ), $args );

    //** New Invoice object */
    $invoice = new UD_Invoice();

    //** Load invoice by ID */
    $invoice-&gt;load_invoice( array( &#x27;id&#x27; =&gt; $ID ) );

    //** Check */
    if ( !empty( $invoice-&gt;error ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Invoice not found&#x27;, WPI ), $args );

    //** Pay only if status if not paid */
    if ( $invoice-&gt;data[ &#x27;post_status&#x27; ] == &#x27;paid&#x27; ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Invoice is completely paid. Payments are not acceptable anymore.&#x27;, WPI ), $args );

    //** Check amount */
    if ( (float) $invoice-&gt;data[ &#x27;net&#x27; ] &lt; (float) $amount ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Cannot pay more that the balance is. Maximum is &#x27; . $invoice-&gt;data[ &#x27;net&#x27; ], WPI ), $args );

    //** Handle partial */
    if ( (float) $invoice-&gt;data[ &#x27;net&#x27; ] &gt; (float) $amount ) {
      if ( empty( $invoice-&gt;data[ &#x27;deposit_amount&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Partial payments are not allowed. Pay minimum is &#x27; . $invoice-&gt;data[ &#x27;net&#x27; ], WPI ), $args );
      if ( (float) $amount &lt; (float) $invoice-&gt;data[ &#x27;deposit_amount&#x27; ] ) {
        return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Minimum allowed payment is &#x27; . $invoice-&gt;data[ &#x27;deposit_amount&#x27; ], WPI ), $args );
      }
    }

    //** Add payment item */
    $invoice-&gt;add_entry( array(
      &#x27;attribute&#x27; =&gt; &#x27;balance&#x27;,
      &#x27;note&#x27; =&gt; &#x27;Paid &#x27; . ( (float) $amount ) . &#x27; &#x27; . $invoice-&gt;data[ &#x27;default_currency_code&#x27; ] . &#x27; via XML-RPC API&#x27;,
      &#x27;amount&#x27; =&gt; (float) $amount,
      &#x27;type&#x27; =&gt; &#x27;add_payment&#x27;
    ) );

    //** Save to be sure totals recalculated */
    $invoice-&gt;save_invoice();

    //** Load again to get changes */
    $invoice = new UD_Invoice();
    $invoice-&gt;load_invoice( array( &#x27;id&#x27; =&gt; $ID ) );

    return $invoice;
  }

  /**
   * Delete Invoice by ID
   *
   * @param array $args
   *
   * @return bool
   */
  function delete_invoice( $args = array() ) {
    //** Default arguments */
    $defaults = array( &#x27;ID&#x27; =&gt; false );

    //** Parse arguments */
    extract( wp_parse_args( $args, $defaults ) );

    //** Check */
    if ( !$ID ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Argument &quot;ID&quot; is required.&#x27;, WPI ), $args );

    //** New Invoice object */
    $invoice = new UD_Invoice();

    //** Load invoice by ID */
    $invoice-&gt;load_invoice( array( &#x27;id&#x27; =&gt; $ID ) );

    //** Return result of delete method */
    return $invoice-&gt;delete();
  }

  /**
   * Returns invoice object requested by ID
   *
   * @param array $args
   *
   * @return UD_Invoice
   */
  function get_invoice( $args = array() ) {
    //** Default arguments */
    $defaults = array( &#x27;ID&#x27; =&gt; false );

    //** Parse arguments */
    extract( wp_parse_args( $args, $defaults ) );

    //** Check */
    if ( !$ID ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Argument &quot;ID&quot; is required.&#x27;, WPI ), $args );

    //** New Invoice object */
    $invoice = new UD_Invoice();

    //** Load invoice by ID */
    $invoice-&gt;load_invoice( array( &#x27;id&#x27; =&gt; $ID ) );

    //** Return ready object */
    return empty( $invoice-&gt;error ) ? $invoice : new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Invoice not found&#x27;, WPI ), $args );
  }

  /**
   * Update invoice by ID
   *
   * @global Array $wpi_settings
   *
   * @param Array $args
   *
   * @return WP_Error|UD_Invoice
   */
  function update_invoice( $args = array() ) {
    global $wpi_settings;

    //** Default arguments */
    $defaults = array(
      &#x27;ID&#x27; =&gt; false,
      &#x27;subject&#x27; =&gt; false,
      &#x27;description&#x27; =&gt; false,
      &#x27;type&#x27; =&gt; false,
      &#x27;deposit&#x27; =&gt; false,
      &#x27;due_date&#x27; =&gt; false,
      &#x27;tax&#x27; =&gt; false,
      &#x27;tax_method&#x27; =&gt; false,
      &#x27;recurring&#x27; =&gt; false,
      &#x27;discount&#x27; =&gt; false,
      &#x27;items&#x27; =&gt; array(),
      &#x27;charges&#x27; =&gt; array()
    );

    //** Parse arguments */
    extract( $args = wp_parse_args( $args, $defaults ) );

    //** Check */
    if ( !$ID ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Argument &quot;ID&quot; is required.&#x27;, WPI ), $args );

    //** New Invoice object */
    $invoice = new UD_Invoice();

    //** Load invoice by ID */
    $invoice-&gt;load_invoice( array( &#x27;id&#x27; =&gt; $ID ) );

    $set = array();

    //** Subject */
    if ( $subject ) {
      $subject = trim( $subject );
      if ( !empty( $subject ) ) {
        $set[ &#x27;subject&#x27; ] = $subject;
        $set[ &#x27;post_title&#x27; ] = $subject;
      }
    }

    //** Description */
    if ( $description ) {
      $description = trim( $description );
      if ( !empty( $description ) ) {
        $set[ &#x27;description&#x27; ] = $description;
      }
    }

    if ( $type ) {
      //** If type is registered */
      if ( !array_key_exists( $type, $wpi_settings[ &#x27;types&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Unknown invoice type.&#x27;, WPI ), $args );

      //** If recurring */
      if ( $type == &#x27;recurring&#x27; ) {
        $recurring = array_filter( $recurring );
        if ( empty( $recurring[ &#x27;unit&#x27; ] ) || empty( $recurring[ &#x27;cycles&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Method requires correct &quot;recurring&quot; argument if &quot;type&quot; is recurring.&#x27;, WPI ), $args );
        if ( !empty( $deposit ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Cannot use &quot;deposit&quot; with &quot;recurring&quot; type.&#x27;, WPI ), $args );
      }

      //** If quote */
      if ( $type == &#x27;quote&#x27; ) {
        if ( !empty( $deposit ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Cannot use &quot;deposit&quot; with &quot;quote&quot; type.&#x27;, WPI ), $args );
      }

      $set[ &#x27;type&#x27; ] = $type;

      //** If quote */
      if ( $type == &#x27;quote&#x27; ) {
        $set[ &#x27;status&#x27; ] = $type;
        $set[ &#x27;is_quote&#x27; ] = &#x27;true&#x27;;
      }

      //** Recurring */
      if ( $type == &#x27;recurring&#x27; ) {
        $invoice-&gt;create_schedule( $recurring );
      }
    }

    //** Partial payments */
    if ( $deposit ) {
      $set[ &#x27;deposit_amount&#x27; ] = (float) $deposit;
    }

    if ( $due_date ) {
      $set[ &#x27;due_date_year&#x27; ] = $due_date[ &#x27;year&#x27; ];
      $set[ &#x27;due_date_month&#x27; ] = $due_date[ &#x27;month&#x27; ];
      $set[ &#x27;due_date_day&#x27; ] = $due_date[ &#x27;day&#x27; ];
    }

    if ( $tax ) {
      $set[ &#x27;tax&#x27; ] = $tax;
    }

    if ( $tax_method ) {
      if ( $tax_method != &#x27;before_discount&#x27; &amp;&amp; $tax_method != &#x27;after_discount&#x27; ) {
        return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Unknown &quot;tax_method&quot;.&#x27;, WPI ), $args );
      }
      $set[ &#x27;tax_method&#x27; ] = $tax_method;
    }

    if ( $discount ) {
      if ( empty( $discount[ &#x27;name&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Discount name is required.&#x27;, WPI ), $args );
      if ( empty( $discount[ &#x27;type&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Discount type is required. (&quot;amount&quot; or &quot;percent&quot;).&#x27;, WPI ), $args );
      if ( empty( $discount[ &#x27;amount&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Discount amount is required.&#x27;, WPI ), $args );
      $invoice-&gt;data[ &#x27;discount&#x27; ] = array();
      $invoice-&gt;add_discount( $discount );
    }

    if ( $items ) {
      //** Items */
      foreach ( $items as $item ) {
        //** Do not allow to save melformed items */
        if ( empty( $item[ &#x27;name&#x27; ] ) ||
          empty( $item[ &#x27;quantity&#x27; ] ) ||
          empty( $item[ &#x27;price&#x27; ] )
        ) {
          return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;One or more &quot;items&quot; have malformed structure. Cannot create Invoice.&#x27;, WPI ), $args );
        }

        //** Global tax has higher priority */
        if ( !empty( $tax ) ) $item[ &#x27;tax_rate&#x27; ] = $tax;

        //** Check types */
        if ( !is_numeric( $item[ &#x27;quantity&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;One or more &quot;items&quot; have wrong &quot;quantity&quot; value. Cannot create Invoice.&#x27;, WPI ), $args );
        if ( !is_numeric( $item[ &#x27;price&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;One or more &quot;items&quot; have wrong &quot;price&quot; value. Cannot create Invoice.&#x27;, WPI ), $args );
        if ( !empty( $item[ &#x27;tax_rate&#x27; ] ) ) {
          if ( !is_numeric( $item[ &#x27;tax_rate&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;One or more &quot;items&quot; have wrong &quot;tax_rate&quot; value. Cannot create Invoice.&#x27;, WPI ), $args );
        }
      }
    }

    if ( $charges ) {
      //** Charges */
      foreach ( $charges as $charge ) {
        //** Do not allow to save melformed items */
        if ( empty( $charge[ &#x27;name&#x27; ] ) ||
          empty( $charge[ &#x27;amount&#x27; ] )
        ) {
          return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;One or more &quot;charges&quot; have malformed structure. Cannot create Invoice.&#x27;, WPI ), $args );
        }

        //** Global tax has higher priority */
        if ( !empty( $tax ) ) $charge[ &#x27;tax&#x27; ] = $tax;

        //** Check types */
        if ( !is_numeric( $charge[ &#x27;amount&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;One or more &quot;charges&quot; have wrong &quot;amount&quot; value. Cannot create Invoice.&#x27;, WPI ), $args );
        if ( !empty( $charge[ &#x27;tax&#x27; ] ) ) {
          if ( !is_numeric( $charge[ &#x27;tax&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;One or more &quot;charges&quot; have wrong &quot;tax&quot; value. Cannot create Invoice.&#x27;, WPI ), $args );
        }
      }
    }

    //** If passed validation - save item */
    if ( $charges ) {
      $invoice-&gt;data[ &#x27;itemized_charges&#x27; ] = array();
      foreach ( $charges as $charge ) {
        $invoice-&gt;line_charge( $charge );
      }
    }
    if ( $items ) {
      $invoice-&gt;data[ &#x27;itemized_list&#x27; ] = array();
      foreach ( $items as $item ) {
        $invoice-&gt;line_item( $item );
      }
    }

    $invoice-&gt;set( $set );

    $invoice-&gt;save_invoice();

    $invoice = new UD_Invoice();
    //** Load invoice by ID */
    $invoice-&gt;load_invoice( array( &#x27;id&#x27; =&gt; $ID ) );

    return $invoice;
  }

}

/**
 * Fires API methods in order to arguments passed
 *
 * @param array $args
 */
if ( !function_exists( &#x27;wpi_xmlrpc_request&#x27; ) ) {
  function wpi_xmlrpc_request( $args ) {
    global $wp_xmlrpc_server, $wpi_xml_rpc_api_reference;

    //** Escape args */
    $wp_xmlrpc_server-&gt;escape( $args );

    //** Sort args */
    $method = $args[ 0 ];
    $credentials = $args[ 1 ];
    $args = $args[ 2 ];
    $blog = isset( $args[ 3 ] ) ? $args[ 3 ] : 0;

    //** Check credentials */
    if ( !$user = $wp_xmlrpc_server-&gt;login( $credentials[ 0 ], $credentials[ 1 ] ) )
      return $wp_xmlrpc_server-&gt;error;

    if ( !current_user_can_for_blog( $blog, &#x27;manage_options&#x27; ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Access denied. Do not have rights.&#x27;, WPI ), $args );

    //** Check for reference */
    if ( !array_key_exists( $method, $wpi_xml_rpc_api_reference[ &#x27;methods&#x27; ] ) ) return new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Requested method is absent in API Reference&#x27;, WPI ), $args );

    //** Return result of calling requested method */
    return is_callable( array( $wpi_xml_rpc_api_reference[ &#x27;namespace&#x27; ], $method ) )
      ? call_user_func( array( $wpi_xml_rpc_api_reference[ &#x27;namespace&#x27; ], $method ), $args )
      : new WP_Error( &#x27;wp.invoice&#x27;, __( &#x27;Unknown method&#x27;, WPI ), $method );
  }
}

/**
 * Render API help
 */
if ( !function_exists( &#x27;wpi_help_api_reference&#x27; ) ) {
  function wpi_help_api_reference() {
    global $wpi_xml_rpc_api_reference;
    ?&gt;
    &lt;div class=&quot;wpi_settings_block&quot;&gt;
        &lt;?php _e( &#x27;WP-Invoice XML-RPC API Reference&#x27;, WPI ); ?&gt;
      &lt;input type=&quot;button&quot; class=&quot;wpi_settings_view&quot; value=&quot;&lt;?php esc_attr( _e( &#x27;Toggle&#x27;, WPI ) ); ?&gt;&quot;&gt;
        &lt;div class=&quot;wpi_settings_row hidden&quot;&gt;
          &lt;div class=&quot;wpi_scrollable_content&quot;&gt;
            &lt;h2&gt;
              &lt;?php _e( &#x27;WP-Invoice XML-RPC API Reference&#x27;, WPI ); ?&gt;
            &lt;/h2&gt;
            &lt;p&gt;
              &lt;?php echo $wpi_xml_rpc_api_reference[ &#x27;namespace&#x27; ]-&gt;description; ?&gt;
            &lt;/p&gt;
            &lt;h2&gt;
              &lt;?php _e( &#x27;Examples&#x27;, WPI ); ?&gt;
            &lt;/h2&gt;
            &lt;p&gt;
              &lt;a target=&quot;_blank&quot; href=&quot;https://github.com/UsabilityDynamics/wp-invoice/wiki/API#examples&quot;&gt;https://github.com/UsabilityDynamics/wp-invoice/wiki/API&lt;/a&gt;
            &lt;/p&gt;
            &lt;p&gt;
              &lt;?php _e( &#x27;Below is a list of available functions that current API supports.&#x27;, WPI ); ?&gt;
            &lt;/p&gt;

            &lt;ul&gt;
            &lt;?php foreach ( $wpi_xml_rpc_api_reference[ &#x27;methods&#x27; ] as $method =&gt; $info ): ?&gt;
              &lt;li class=&quot;wpi_api_method_wrapper&quot;&gt;
                &lt;code&gt;&lt;?php echo $method; ?&gt;&lt;/code&gt;
                &lt;p&gt;&lt;?php echo $info[ &#x27;description&#x27; ]; ?&gt;&lt;/p&gt;
                &lt;h4&gt;&lt;?php _e( &#x27;Arguments:&#x27;, WPI ); ?&gt;&lt;/h4&gt;
                &lt;ol&gt;
                  &lt;?php foreach ( $info[ &#x27;args&#x27; ] as $arg =&gt; $arg_info ): ?&gt;
                    &lt;li&gt;&lt;b&gt;&lt;?php echo $arg; ?&gt;&lt;/b&gt;:&lt;?php echo $arg_info[ &#x27;type&#x27; ]; ?&gt;&lt;?php echo $arg_info[ &#x27;required&#x27; ] ? &#x27;&lt;sup&gt;*&lt;/sup&gt;&#x27; : &#x27;&#x27;; ?&gt;
                      - &lt;?php echo $arg_info[ &#x27;description&#x27; ] ?&gt;&lt;/li&gt;
                  &lt;?php endforeach; ?&gt;
                &lt;/ol&gt;
              &lt;/li&gt;
            &lt;?php endforeach; ?&gt;
            &lt;/ul&gt;

          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
  &lt;?php
  }
}

/**
 * WP-Invoice XML-RPC API Reference
 *
 * @type Array
 * @author korotkov@ud
 */
global $wpi_xml_rpc_api_reference;

$wpi_xml_rpc_api_reference = array(

  //** Namespace */
  &#x27;namespace&#x27; =&gt; new RPC(),

  //** Methods */
  &#x27;methods&#x27; =&gt; array(

    //** Create Invoice */
    &#x27;create_invoice&#x27; =&gt; array(
      &#x27;description&#x27; =&gt; &#x27;Create new invoice based on information passed.&#x27;,
      &#x27;args&#x27; =&gt; array(
        &#x27;custom_id&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Previously generated Custom Invoice ID.&#x27;,
          &#x27;required&#x27; =&gt; false,
          &#x27;type&#x27; =&gt; &#x27;Number&#x27;
        ),
        &#x27;subject&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;The title of invoice post object.&#x27;,
          &#x27;required&#x27; =&gt; true,
          &#x27;type&#x27; =&gt; &#x27;String&#x27;
        ),
        &#x27;description&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;The content of invoice post object.&#x27;,
          &#x27;required&#x27; =&gt; false,
          &#x27;type&#x27; =&gt; &#x27;String&#x27;
        ),
        &#x27;type&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;The type of invoice object. One of allowed types can be used. (invoice, quote, single_payment, recurring).&#x27;,
          &#x27;required&#x27; =&gt; true,
          &#x27;type&#x27; =&gt; &#x27;String&#x27;
        ),
        &#x27;user_data&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Recipient data. Conditionaly required. Associative array should always contain &quot;user_email&quot;.&#x27;,
          &#x27;required&#x27; =&gt; true,
          &#x27;type&#x27; =&gt; &#x27;Array&#x27;
        ),
        &#x27;deposit&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Minimum amount of Partial Payment allowed. Partial Payments disabled if empty.&#x27;,
          &#x27;required&#x27; =&gt; false,
          &#x27;type&#x27; =&gt; &#x27;Number&#x27;
        ),
        &#x27;due_date&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Invoice Due Date. Associative array of 3 permanent elements: month, year, day (mm, yyyy, dd).&#x27;,
          &#x27;required&#x27; =&gt; false,
          &#x27;type&#x27; =&gt; &#x27;Array&#x27;
        ),
        &#x27;currency&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Currency code of the currency you need to use for current invoice. Format AAA.&#x27;,
          &#x27;required&#x27; =&gt; false,
          &#x27;type&#x27; =&gt; &#x27;String&#x27;
        ),
        &#x27;tax&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Global tax value in percents. Will be applied to every item and charge.&#x27;,
          &#x27;required&#x27; =&gt; false,
          &#x27;type&#x27; =&gt; &#x27;Number&#x27;
        ),
        &#x27;tax_method&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Method of tax counting. After or Before discount. (before_discount, after_discount).&#x27;,
          &#x27;required&#x27; =&gt; false,
          &#x27;type&#x27; =&gt; &#x27;String&#x27;
        ),
        &#x27;recurring&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Recurring billing cycles options.&#x27;,
          &#x27;required&#x27; =&gt; false,
          &#x27;type&#x27; =&gt; &#x27;String&#x27;
        ),
        &#x27;status&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;The status of invoice. One of registered statuses is allowed.&#x27;,
          &#x27;required&#x27; =&gt; true,
          &#x27;type&#x27; =&gt; &#x27;String&#x27;
        ),
        &#x27;discount&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Discount for current invoice. Associative array should contain 3 fields: name, type, amount.&#x27;,
          &#x27;required&#x27; =&gt; false,
          &#x27;type&#x27; =&gt; &#x27;Array&#x27;
        ),
        &#x27;items&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Line items of current invoice. Set of associative arrays. Conditionaly required.&#x27;,
          &#x27;required&#x27; =&gt; true,
          &#x27;type&#x27; =&gt; &#x27;Array&#x27;
        ),
        &#x27;charges&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Charges of current invoice. Set of associative arrays. Conditionaly required.&#x27;,
          &#x27;required&#x27; =&gt; true,
          &#x27;type&#x27; =&gt; &#x27;Array&#x27;
        )
      ),
      &#x27;return&#x27; =&gt; &#x27;UD_Invoice|WP_Error&#x27;
    ),

    //** Delete Invoice */
    &#x27;delete_invoice&#x27; =&gt; array(
      &#x27;description&#x27; =&gt; &#x27;Delete invoice by ID.&#x27;,
      &#x27;args&#x27; =&gt; array(
        &#x27;ID&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Invoice ID.&#x27;,
          &#x27;required&#x27; =&gt; true,
          &#x27;type&#x27; =&gt; &#x27;Number&#x27;
        )
      ),
      &#x27;return&#x27; =&gt; &#x27;Boolean|WP_Error&#x27;
    ),

    //** Get Invoice */
    &#x27;get_invoice&#x27; =&gt; array(
      &#x27;description&#x27; =&gt; &#x27;Get invoice by ID&#x27;,
      &#x27;args&#x27; =&gt; array(
        &#x27;ID&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Invoice ID.&#x27;,
          &#x27;required&#x27; =&gt; true,
          &#x27;type&#x27; =&gt; &#x27;Number&#x27;
        )
      ),
      &#x27;return&#x27; =&gt; &#x27;UD_Invoice|WP_Error&#x27;
    ),

    //** Refund invoice */
    &#x27;refund_invoice&#x27; =&gt; array(
      &#x27;description&#x27; =&gt; &#x27;Refund invoice by ID. Note that it does not do refund on merchant side.&#x27;,
      &#x27;args&#x27; =&gt; array(
        &#x27;ID&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Invoice ID.&#x27;,
          &#x27;required&#x27; =&gt; true,
          &#x27;type&#x27; =&gt; &#x27;Number&#x27;
        )
      ),
      &#x27;return&#x27; =&gt; &#x27;UD_Invoice|WP_Error&#x27;
    ),

    //** Pay invoice by ID */
    &#x27;pay_invoice&#x27; =&gt; array(
      &#x27;description&#x27; =&gt; &#x27;Pay invoice by ID&#x27;,
      &#x27;args&#x27; =&gt; array(
        &#x27;ID&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Invoice ID.&#x27;,
          &#x27;required&#x27; =&gt; true,
          &#x27;type&#x27; =&gt; &#x27;Number&#x27;
        ),
        &#x27;amount&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Amount to be paid.&#x27;,
          &#x27;required&#x27; =&gt; true,
          &#x27;type&#x27; =&gt; &#x27;Number&#x27;
        )
      ),
      &#x27;return&#x27; =&gt; &#x27;UD_Invoice|WP_Error&#x27;
    ),

    //** Update invoice */
    &#x27;update_invoice&#x27; =&gt; array(
      &#x27;description&#x27; =&gt; &#x27;Update some of the invoice attributes.&#x27;,
      &#x27;args&#x27; =&gt; array(
        &#x27;ID&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Invoice ID.&#x27;,
          &#x27;required&#x27; =&gt; true,
          &#x27;type&#x27; =&gt; &#x27;Number&#x27;
        ),
        &#x27;subject&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;The title of invoice post object.&#x27;,
          &#x27;required&#x27; =&gt; true,
          &#x27;type&#x27; =&gt; &#x27;String&#x27;
        ),
        &#x27;description&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;The content of invoice post object.&#x27;,
          &#x27;required&#x27; =&gt; false,
          &#x27;type&#x27; =&gt; &#x27;String&#x27;
        ),
        &#x27;type&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;The type of invoice object. One of allowed types can be used. (invoice, quote, single_payment, recurring).&#x27;,
          &#x27;required&#x27; =&gt; true,
          &#x27;type&#x27; =&gt; &#x27;String&#x27;
        ),
        &#x27;deposit&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Minimum amount of Partial Payment allowed. Partial Payments disabled if empty.&#x27;,
          &#x27;required&#x27; =&gt; false,
          &#x27;type&#x27; =&gt; &#x27;Number&#x27;
        ),
        &#x27;due_date&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Invoice Due Date. Associative array of 3 permanent elements: month, year, day (mm, yyyy, dd).&#x27;,
          &#x27;required&#x27; =&gt; false,
          &#x27;type&#x27; =&gt; &#x27;Array&#x27;
        ),
        &#x27;tax&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Global tax value in percents. Will be applied to every item and charge.&#x27;,
          &#x27;required&#x27; =&gt; false,
          &#x27;type&#x27; =&gt; &#x27;Number&#x27;
        ),
        &#x27;tax_method&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Method of tax counting. After or Before discount. (before_discount, after_discount).&#x27;,
          &#x27;required&#x27; =&gt; false,
          &#x27;type&#x27; =&gt; &#x27;String&#x27;
        ),
        &#x27;recurring&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Recurring billing cycles options.&#x27;,
          &#x27;required&#x27; =&gt; false,
          &#x27;type&#x27; =&gt; &#x27;String&#x27;
        ),
        &#x27;discount&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Discount for current invoice. Associative array should contain 3 fields: name, type, amount.&#x27;,
          &#x27;required&#x27; =&gt; false,
          &#x27;type&#x27; =&gt; &#x27;Array&#x27;
        ),
        &#x27;items&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Line items of current invoice. Set of associative arrays. Conditionaly required.&#x27;,
          &#x27;required&#x27; =&gt; true,
          &#x27;type&#x27; =&gt; &#x27;Array&#x27;
        ),
        &#x27;charges&#x27; =&gt; array(
          &#x27;description&#x27; =&gt; &#x27;Charges of current invoice. Set of associative arrays. Conditionaly required.&#x27;,
          &#x27;required&#x27; =&gt; true,
          &#x27;type&#x27; =&gt; &#x27;Array&#x27;
        )
      )
    )
  )

);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
