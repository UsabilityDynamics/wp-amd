<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core/vendor/lib/ud_asset.php - Flawless</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://a3d72a45d111006ec192-ec5b80a12b0b09b4d52373336afb4254.r80.cf1.rackcdn.com/usability-dynamics.png" title="Flawless"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/: Flawless.Element.html">: Flawless.Element</a></li>
            
                <li><a href="../classes/: Flawless.Flawless_Module.html">: Flawless.Flawless_Module</a></li>
            
                <li><a href="../classes/: Flawless.Flawless_Shortcode.html">: Flawless.Flawless_Shortcode</a></li>
            
                <li><a href="../classes/: Flawless.Flawless_Widget.html">: Flawless.Flawless_Widget</a></li>
            
                <li><a href="../classes/: Flawless.flawless_wpp_extensions.html">: Flawless.flawless_wpp_extensions</a></li>
            
                <li><a href="../classes/: Flawless.License.html">: Flawless.License</a></li>
            
                <li><a href="../classes/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../classes/Template Functions.html">Template Functions</a></li>
            
                <li><a href="../classes/Template Methods.html">Template Methods</a></li>
            
                <li><a href="../classes/Theme UI.html">Theme UI</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Core Assets.html">Core Assets</a></li>
            
                <li><a href="../modules/Flawless.html">Flawless</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: core/vendor/lib/ud_asset.php</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&lt;?php
if ( !class_exists( &#x27;UD_Asset&#x27; ) ) {

  /**
   * UD Assets Compiler Functions
   *
   * Description: Assets Compiler
   *
   * Notice: It&#x27;s not static class. Object should be initialized
   *
   * @author team@UD
   * @version 0.1.1
   * @package UD
   * @subpackage Functions
   */
  class UD_Asset {

    /**
     * The list of assets.
     *
     * @var type
     */
    private $assets = array();

    /**
     * Recompile assets in any case.
     * If false $this-&gt;monitor is used
     *
     * @var boolean
     */
    private $recompute = false;

    /**
     * Recompile assets only if input data was modified and if $this-&gt;recompute false
     *
     * @var boolean
     */
    private $monitor = false;

    /**
     * Pathes to all required libraries
     *
     * @var array
     */
    private $pathes = array(
      &#x27;jsmin&#x27; =&gt; false, // JSMin library to minify JS
      &#x27;lessc&#x27; =&gt; false, // Less PHP library. See https://github.com/leafo/lessphp
    );

    /**
     * Prefix is used in dynamic asset&#x27;s permalink
     *
     * @var string
     */
    private $prefix = &#x27;ud&#x27;;

    /**
     * Constructor.
     * All pathes to libraries must be defined here.
     * Should be called before init, because it adds specific hooks
     *
     * @param mixed $args
     *
     * @author peshkov@UD
     */
    function __construct( $args = array() ) {
      global $wp;

      $args = wp_parse_args( $args );

      foreach ( $args as $k =&gt; $v ) {
        switch ( $k ) {
          case &#x27;assets&#x27;:
            $this-&gt;set_assets( $v );
            break;
          case &#x27;recompute&#x27;:
            $this-&gt;recompute = $v;
            break;
          case &#x27;monitor&#x27;:
            $this-&gt;monitor = $v;
            break;
          case &#x27;prefix&#x27;:
            $this-&gt;prefix = !empty( $v ) &amp;&amp; is_string( $v ) ? $v : $this-&gt;prefix;
            break;
          case &#x27;pathes&#x27;:
            if ( is_array( $v ) ) {
              foreach ( $v as $lib =&gt; $path ) {
                if ( file_exists( $path ) &amp;&amp; in_array( $lib, array( &#x27;jsmin&#x27;, &#x27;lessc&#x27; ) ) ) {
                  $this-&gt;pathes[ $lib ] = $path;
                }
              }
            }
            break;
        }
      }

      //** Rewrite Vars */
      $wp-&gt;add_query_var( $this-&gt;prefix . &#x27;_asset&#x27; );

      //** Updates all WPP rewrite rules on flush_rewrite_rules() */
      add_action( &#x27;rewrite_rules_array&#x27;, array( $this, &#x27;_rewrite_rules&#x27; ), 20 );

      //** Handle high-level routing */
      add_filter( &#x27;parse_request&#x27;, array( $this, &#x27;_parse_request&#x27; ) );

    }

    /**
     * Get the list of all assets
     *
     * @author peshkov@UD
     */
    function get_assets() {
      return $this-&gt;assets;
    }

    /**
     * Sets assets
     *
     * @author peshkov@UD
     *
     * @param $assets
     *
     * @return array
     */
    function set_assets( $assets ) {
      $this-&gt;assets = array();
      $permalink = ( &#x27;&#x27; != get_option( &#x27;permalink_structure&#x27; ) ) ? true : false;

      foreach ( $assets as $k =&gt; $v ) {
        $v = array_merge( array(
          &#x27;file&#x27; =&gt; false,
          &#x27;type&#x27; =&gt; false,
          &#x27;scope&#x27; =&gt; &#x27;default&#x27;, // Available data: &#x27;default&#x27;,&#x27;cdn&#x27;
          &#x27;url&#x27; =&gt; false,
          &#x27;compile_options&#x27; =&gt; false
        ), (array) $v );

        switch ( $v[ &#x27;scope&#x27; ] ) {

          case &#x27;default&#x27;:
            //** Ignore WPP asset if any required param is missed. */
            if ( empty( $v[ &#x27;file&#x27; ] ) || empty( $v[ &#x27;type&#x27; ] ) ) {
              continue;
            }
            //** Set url to asset */
            if ( empty( $v[ &#x27;url&#x27; ] ) ) {
              $scheme = is_ssl() ? &#x27;https&#x27; : null;
              $v[ &#x27;url&#x27; ] = $permalink ? home_url( &quot;{$this-&gt;prefix}_asset/{$k}&quot;, $scheme ) : home_url( &quot;index.php?{$this-&gt;prefix}_asset={$k}&quot;, $scheme );
            }
            break;

          case &#x27;cdn&#x27;:
            //** Ignore CDN asset if url is not set. */
            if ( empty( $v[ &#x27;url&#x27; ] ) ) {
              continue;
            }
            break;

        }

        $this-&gt;assets[ $k ] = $v;
      }

      //echo &quot;&lt;pre&gt;&quot;;print_r( $this-&gt;assets );echo &quot;&lt;/pre&gt;&quot;;die();

      return $this-&gt;assets;

    }

    /**
     * Get URL for asset
     *
     * @param $asset
     *
     * @return bool
     */
    function get_dynamic_asset_url( $asset ) {
      $url = false;
      if ( is_array( $this-&gt;assets[ $asset ] ) ) {
        $url = $this-&gt;assets[ $asset ][ &#x27;url&#x27; ];
      }
      return $url;
    }

    /**
     * Returns compiled asset&#x27;s data.
     *
     * @author peshkov@UD
     *
     * @param $asset
     * @param array $args
     *
     * @return array|bool|type|WP_Error
     */
    function get_dynamic_asset( $asset, $args = array() ) {

      $args = wp_parse_args( $args, array(
        &#x27;recompute&#x27; =&gt; $this-&gt;recompute,
        &#x27;monitor&#x27; =&gt; $this-&gt;monitor,
      ) );

      if ( empty( $this-&gt;assets[ $asset ] ) ) {
        return new WP_Error( __METHOD__, &#x27;Asset doesn\&#x27;t exist&#x27; );
      }

      $data = false;
      $_asset = $this-&gt;assets[ $asset ];

      switch ( $_asset[ &#x27;type&#x27; ] ) {
        case &#x27;css&#x27;:
          $mime_type = &#x27;text/css&#x27;;
          break;
        case &#x27;js&#x27;:
          $mime_type = &#x27;text/javascript&#x27;;
          break;
        default:
          return new WP_Error( __METHOD__, &quot;Type &#x27;{$_asset[&#x27;type&#x27;]}&#x27; is not supported&quot; );
          break;
      }

      switch ( $_asset[ &#x27;scope&#x27; ] ) {

        /**
         * Returns local compiled asset.
         * It file doesn&#x27;t exist we try to compile it.
         */
        case &#x27;default&#x27;:

          if ( !empty( $_asset[ &#x27;compile_options&#x27; ] ) &amp;&amp; ( !file_exists( $_asset[ &#x27;file&#x27; ] ) || $args[ &#x27;monitor&#x27; ] ) ) {
            $result = $this-&gt;compile_asset( $asset, $args );
            if ( is_wp_error( $result ) ) {
              return $result;
            }
          } else if ( !$_asset[ &#x27;compile_options&#x27; ] &amp;&amp; !file_exists( $_asset[ &#x27;file&#x27; ] ) ) {
            return new WP_Error( __METHOD__, &#x27;Asset doesn\&#x27;t exist and can not be compiled.&#x27; );
          }

          //** Be sure that file exists on this step */
          if ( !file_exists( $_asset[ &#x27;file&#x27; ] ) ) {
            return new WP_Error( __METHOD__, &#x27;Asset doesn\&#x27;t exist&#x27; );
          }

          $data = array(
            &#x27;data&#x27; =&gt; file_get_contents( $_asset[ &#x27;file&#x27; ] ),
            &#x27;updated&#x27; =&gt; filemtime( $_asset[ &#x27;file&#x27; ] ),
            &#x27;mime_type&#x27; =&gt; $mime_type,
          );

          break;

        /**
         * Returns CDN Media Item
         */
        case &#x27;cdn&#x27;:
          // @todo: finish implementation for CDN assets. peshkov@UD
          wp_die( &#x27;WIP. Media Item Handler.&#x27; );
          break;

      }

      return $data;

    }

    /**
     * Recompiles all assets
     *
     * @param boolean $hard. Recompute all assets or just recompile modified ones
     *
     * @author peshkov@Ud
     */
    function recompile_all_assets( $hard = false ) {
      foreach ( $this-&gt;assets as $asset =&gt; $data ) {
        $this-&gt;compile_asset( $asset, array(
          &#x27;recompute&#x27; =&gt; $hard ? true : false,
          &#x27;monitor&#x27; =&gt; true,
        ) );
      }
    }

    /**
     * Compiles assets ( css, js )
     *
     * @see WPP_Config::get_assets();
     *
     * @param string $asset
     * @param array $args
     *
     * @return type
     * @author odokienko@UD
     * @author peshkov@UD
     */
    function compile_asset( $asset, $args = array() ) {

      $args = wp_parse_args( $args, array(
        &#x27;recompute&#x27; =&gt; $this-&gt;recompute,
        &#x27;monitor&#x27; =&gt; $this-&gt;monitor,
      ) );

      if ( empty( $this-&gt;assets[ $asset ] ) ) {
        return new WP_Error( __METHOD__, &#x27;Asset doesn\&#x27;t exist&#x27; );
      }

      $_asset = $this-&gt;assets[ $asset ];

      if ( $_asset[ &#x27;scope&#x27; ] != &#x27;default&#x27; ) {
        return new WP_Error( __METHOD__, &#x27;Asset\&#x27;s scope should be default to proceed.&#x27; );
      }

      $options = array_merge( $_asset[ &#x27;compile_options&#x27; ], array(
        &#x27;output&#x27; =&gt; $_asset[ &#x27;file&#x27; ],
        &#x27;recompute&#x27; =&gt; $args[ &#x27;recompute&#x27; ]
      ) );

      $result = false;

      if ( !file_exists( $_asset[ &#x27;file&#x27; ] ) || $args[ &#x27;monitor&#x27; ] ) {
        switch ( $_asset[ &#x27;type&#x27; ] ) {
          case &#x27;css&#x27;:
            $result = $this-&gt;compile_less( $options );
            break;
          case &#x27;js&#x27;:
            $result = $this-&gt;compile_js( $options );
            break;
        }
      }

      if ( !$result ) {
        return new WP_Error( __METHOD__, &#x27;Monitoring is turned off or file already exists.&#x27; );
      }

      return $result;
    }

    /**
     * Builds CSS via LessPHP
     *
     * @todo Need to handle LESS output when directory is not writable same as JS Compiling. - potanin@UD 11/27/2012
     * @source https://github.com/leafo/lessphp
     * @author potanin@UD
     * @author peshkov@UD
     */
    function compile_less( $args = array() ) {

      if ( !class_exists( &#x27;lessc&#x27; ) ) {
        if ( !$this-&gt;pathes[ &#x27;lessc&#x27; ] ) {
          return new WP_Error( __METHOD__, &#x27;Unable to load LESS&#x27; );
        }
        include_once $this-&gt;pathes[ &#x27;lessc&#x27; ];
      }

      $args = wp_parse_args( $args, array(
        &#x27;input&#x27; =&gt; &#x27;&#x27;,
        &#x27;output&#x27; =&gt; &#x27;&#x27;,
        &#x27;formatter&#x27; =&gt; &#x27;lessjs&#x27;, // lessjs|compressed|classic
        &#x27;recompute&#x27; =&gt; $this-&gt;recompute,
        &#x27;variables&#x27; =&gt; array(),
      ) );

      if ( !$args[ &#x27;input&#x27; ] || !$args[ &#x27;output&#x27; ] ) {
        return new WP_Error( __METHOD__, &#x27;Missed Arguments&#x27; );
      }

      try {

        $transient_key = MD5( (string) $args[ &#x27;input&#x27; ] . (string) $args[ &#x27;output&#x27; ] );

        if ( is_file( $args[ &#x27;output&#x27; ] ) &amp;&amp; !$args[ &#x27;recompute&#x27; ] &amp;&amp; $transient = get_transient( &#x27;wpp::less::&#x27; . $transient_key ) ) {
          //** Probably we don&#x27;t need to recompile less. Let&#x27;s check to be sure */
          //** Check if we have the same arguments to be sure that all compiled files and variables are the same. */
          $dif1 = array_diff_assoc( $args[ &#x27;variables&#x27; ], $transient[ &#x27;variables&#x27; ] );
          $dif2 = array_diff_assoc( $transient[ &#x27;variables&#x27; ], $args[ &#x27;variables&#x27; ] );
          //** Get the latest time of files changes */
          $max_fmt = 0;
          foreach ( (array) $transient[ &#x27;files&#x27; ] as $lfile ) {
            if ( !file_exists( $lfile ) ) {
              $max_fmt = 0;
              break;
            }
            $fmt = filemtime( $lfile );
            $max_fmt = $max_fmt &lt; $fmt ? $fmt : $max_fmt;
          }

          if ( empty( $dif1 ) &amp;&amp; empty( $dif2 ) &amp;&amp; $max_fmt &amp;&amp; filemtime( $args[ &#x27;output&#x27; ] ) &gt; $max_fmt ) {
            return array(
              &#x27;output&#x27; =&gt; $args[ &#x27;output&#x27; ],
              &#x27;size&#x27; =&gt; $this-&gt;_get_filesize( $args[ &#x27;output&#x27; ] ),
              &#x27;updated&#x27; =&gt; filemtime( $args[ &#x27;output&#x27; ] )
            );
          }
        }

        $less = new lessc;
        $less-&gt;setVariables( (array) $args[ &#x27;variables&#x27; ] );
        $less-&gt;setFormatter( $args[ &#x27;formatter&#x27; ] );

        $cache = $less-&gt;cachedCompile( $args[ &#x27;input&#x27; ] );

        $dirname = dirname( $args[ &#x27;output&#x27; ] );
        if ( !is_dir( $dirname ) ) {
          wp_mkdir_p( $dirname );
        }

        if ( isset( $cache[ &#x27;compiled&#x27; ] ) &amp;&amp; is_writable( $dirname ) &amp;&amp; file_put_contents( $args[ &#x27;output&#x27; ], $cache[ &#x27;compiled&#x27; ] ) ) {
          //** Set transient which is needed to determine if we need to recompile less file */
          set_transient( &#x27;wpp::less::&#x27; . $transient_key, array(
            &#x27;variables&#x27; =&gt; $args[ &#x27;variables&#x27; ],
            &#x27;files&#x27; =&gt; array_keys( (array) $cache[ &#x27;files&#x27; ] ),
          ) );
        } else {
          throw new Exception( &#x27;No file created.&#x27; );
        }

      } catch ( exception $error ) {
        return new WP_Error( __METHOD__, $error-&gt;getMessage() );
      }

      return array(
        &#x27;output&#x27; =&gt; $args[ &#x27;output&#x27; ],
        &#x27;size&#x27; =&gt; $this-&gt;_get_filesize( $args[ &#x27;output&#x27; ] ),
        &#x27;updated&#x27; =&gt; filemtime( $args[ &#x27;output&#x27; ] ),
      );

    }

    /**
     * Process Uncompressed JavaScript File and Create Minified Version
     *
     * @author potanin@UD
     */
    function compile_js( $args = &#x27;&#x27; ) {

      $args = array_filter( wp_parse_args( $args, array(
        &#x27;input&#x27; =&gt; array(),
        &#x27;output&#x27; =&gt; &#x27;&#x27;,
        &#x27;recompute&#x27; =&gt; $this-&gt;recompute,
        &#x27;monitor&#x27; =&gt; $this-&gt;monitor,
      ) ) );

      $js = array();

      foreach ( (array) $args[ &#x27;input&#x27; ] as $path ) {
        if ( !file_exists( $path ) ) {
          continue;
        }
        $js[ basename( $path ) ] = file_get_contents( $path );
        $args[ &#x27;updated&#x27; ][ basename( $path ) ] = filemtime( $path );
      }

      if ( is_file( $args[ &#x27;output&#x27; ] ) &amp;&amp; !$args[ &#x27;recompute&#x27; ] &amp;&amp; ( filemtime( $args[ &#x27;output&#x27; ] ) &gt;= max( $args[ &#x27;updated&#x27; ] ) ) ) {
        return array(
          &#x27;output&#x27; =&gt; $args[ &#x27;output&#x27; ],
          &#x27;size&#x27; =&gt; $this-&gt;_get_filesize( $args[ &#x27;output&#x27; ] ),
          &#x27;updated&#x27; =&gt; filemtime( $args[ &#x27;output&#x27; ] )
        );
      }

      $js = implode( &#x27;&#x27;, (array) $js );

      $js = $this-&gt;minify_js( $js, array( &#x27;engine&#x27; =&gt; &#x27;google_closure&#x27; ) );

      if ( is_wp_error( $js ) ) {
        return $js;
      }

      $dirname = dirname( $args[ &#x27;output&#x27; ] );
      if ( !is_dir( $dirname ) ) {
        wp_mkdir_p( $dirname );
      }

      if ( !is_writable( $dirname ) || !file_put_contents( $args[ &#x27;output&#x27; ], $js ) ) {
        return new WP_Error( __METHOD__, &#x27;No file created&#x27; );
      }

      return array(
        &#x27;output&#x27; =&gt; $args[ &#x27;output&#x27; ],
        &#x27;size&#x27; =&gt; $this-&gt;_get_filesize( $args[ &#x27;output&#x27; ] ),
        &#x27;updated&#x27; =&gt; filemtime( $args[ &#x27;output&#x27; ] ),
      );

    }

    /**
     * Minify JavaScript
     *
     * Uses third-party JSMin if class isn&#x27;t declared.
     * If WP3 is detected, class not loaded to avoid footer warning error.
     * If for some reason W3_Plugin is active, but JSMin is not found,
     * we load ours to avoid breaking property maps.
     *
     * @todo Add Google Cosure API call.
     * @updated 2.0
     * @since 1.06
     */
    function minify_js( $data = &#x27;&#x27;, $args = array() ) {

      $args = wp_parse_args( $args, array(
        &#x27;engine&#x27; =&gt; &#x27;jsmin&#x27;
      ) );

      switch ( $args[ &#x27;engine&#x27; ] ) {

        case &#x27;jsmin&#x27;:

          if ( class_exists( &#x27;W3_Plugin&#x27; ) &amp;&amp; file_exists( WP_PLUGIN_DIR . &#x27;/w3-total-cache/lib/Minify/JSMin.php&#x27; ) ) {
            include_once WP_PLUGIN_DIR . &#x27;/w3-total-cache/lib/Minify/JSMin.php&#x27;;
          } elseif ( !empty( $this-&gt;pathes[ &#x27;jsmin&#x27; ] ) ) {
            include_once $this-&gt;pathes[ &#x27;jsmin&#x27; ];
          }

          if ( !class_exists( &#x27;JSMin&#x27; ) ) {
            return new WP_Error( __METHOD__, &#x27;Class JSMin is undefined&#x27; );
          }

          $data = JSMin::minify( $data );

          break;

        case &#x27;google_closure&#x27;:

          $_post = wp_remote_post( &#x27;http://closure-compiler.appspot.com/compile&#x27;, array(
            &#x27;body&#x27; =&gt; wp_parse_args( $args[ &#x27;params&#x27; ], array(
              &#x27;js_code&#x27; =&gt; $data,
              &#x27;compilation_level&#x27; =&gt;
              &#x27;SIMPLE_OPTIMIZATIONS&#x27;,
              &#x27;output_format&#x27; =&gt; &#x27;json&#x27;,
              &#x27;output_info&#x27; =&gt; &#x27;compiled_code&#x27;
            ) )
          ) );

          if ( is_wp_error( $_post ) ) {
            return $_post;
          }

          $response = json_decode( $_post[ &#x27;body&#x27; ] );

          /** Check if we have success response from google closure, if not - we try to use jsmin library */
          $data = $response-&gt;compiledCode ? $response-&gt;compiledCode : $this-&gt;minify_js( $data, array( &#x27;engine&#x27; =&gt; &#x27;jsmin&#x27; ) );

          break;

      }

      return $data;

    }

    /**
     * Rewrite Rules - called only on flush.
     *
     * @action rewrite_rules_array ( 20 )
     * @author peshkov@UD
     */
    public function _rewrite_rules( $rules ) {
      //* Add rewrite rule for assets */
      $rules = array( &quot;{$this-&gt;prefix}_asset/(.+?)/?$&quot; =&gt; &quot;index.php?{$this-&gt;prefix}_asset=\$matches[1]&quot; ) + $rules;
      return $rules;
    }

    /**
     * Returns Frontend Data Model and Scripts. Fallback when a file cannot be saved to disk.
     *
     * @author peshkov@UD
     * @author odokienko@UD
     */
    public function _parse_request( $query ) {
      if ( !empty( $query-&gt;query_vars[ &quot;{$this-&gt;prefix}_asset&quot; ] ) ) {
        $result = $this-&gt;get_dynamic_asset( $query-&gt;query_vars[ &quot;{$this-&gt;prefix}_asset&quot; ] );
        if ( !is_wp_error( $result ) &amp;&amp; is_array( $result ) ) {
          header( &#x27;Content-Length: &#x27; . strlen( $result[ &#x27;data&#x27; ] ) );
          header( &#x27;Last-Modified: &#x27; . gmdate( &#x27;D, d M Y H:i:s&#x27;, $result[ &#x27;updated&#x27; ] ) . &#x27; GMT&#x27; );
          header( &#x27;ETag: &#x27; . md5( $result[ &#x27;updated&#x27; ] ) );
          header( &#x27;Expires: &#x27; . gmdate( &#x27;D, d M Y H:i:s&#x27;, time() + 100000000 ) . &#x27; GMT&#x27; );
          header( &#x27;Content-Type: &#x27; . $result[ &#x27;mime_type&#x27; ] );
          header( &#x27;X-Content-Type-Options: nosniff&#x27; );
          die( $result[ &#x27;data&#x27; ] );
        } elseif ( is_wp_error( $result ) ) {
          do_action( &#x27;ud::asset::error&#x27;, $result );
        }
        die();
      }
    }

    /**
     * Get filesize of a file.
     */
    private function _get_filesize( $file ) {
      if ( !is_file( $file ) ) {
        return &#x27;&#x27;;
      }
      $bytes = filesize( $file );
      $s = array( &#x27;b&#x27;, &#x27;Kb&#x27;, &#x27;Mb&#x27;, &#x27;Gb&#x27; );
      $e = floor( log( $bytes ) / log( 1024 ) );
      return sprintf( &#x27;%.2f &#x27; . $s[ $e ], !empty( $bytes ) ? ( $bytes / pow( 1024, floor( $e ) ) ) : false );
    }

  }

}
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
