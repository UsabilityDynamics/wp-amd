<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core/controllers/theme.php - wp-flawless</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://a3d72a45d111006ec192-ec5b80a12b0b09b4d52373336afb4254.r80.cf1.rackcdn.com/usability-dynamics.png" title="wp-flawless"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/API.html">API</a></li>
            
                <li><a href="../classes/Carrington.html">Carrington</a></li>
            
                <li><a href="../classes/Extended_Taxonomies.html">Extended_Taxonomies</a></li>
            
                <li><a href="../classes/Flawless.API.html">Flawless.API</a></li>
            
                <li><a href="../classes/Flawless.Asset.html">Flawless.Asset</a></li>
            
                <li><a href="../classes/Flawless.Branded_Login.html">Flawless.Branded_Login</a></li>
            
                <li><a href="../classes/Flawless.BuddyPress.html">Flawless.BuddyPress</a></li>
            
                <li><a href="../classes/Flawless.Content.html">Flawless.Content</a></li>
            
                <li><a href="../classes/Flawless.Element.html">Flawless.Element</a></li>
            
                <li><a href="../classes/Flawless.Flawless\Shortcode.html">Flawless.Flawless\Shortcode</a></li>
            
                <li><a href="../classes/Flawless.Management.html">Flawless.Management</a></li>
            
                <li><a href="../classes/Flawless.Mobile.html">Flawless.Mobile</a></li>
            
                <li><a href="../classes/Flawless.Navbars.html">Flawless.Navbars</a></li>
            
                <li><a href="../classes/Flawless.Schema.html">Flawless.Schema</a></li>
            
                <li><a href="../classes/Flawless.Settings.html">Flawless.Settings</a></li>
            
                <li><a href="../classes/Flawless.Styles.html">Flawless.Styles</a></li>
            
                <li><a href="../classes/Flawless.Utility.html">Flawless.Utility</a></li>
            
                <li><a href="../classes/Flawless.Widget.html">Flawless.Widget</a></li>
            
                <li><a href="../classes/flawless_wpp_extensions.html">flawless_wpp_extensions</a></li>
            
                <li><a href="../classes/Legacy.html">Legacy</a></li>
            
                <li><a href="../classes/License.html">License</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/Log.html">Log</a></li>
            
                <li><a href="../classes/Maintenance.html">Maintenance</a></li>
            
                <li><a href="../classes/Models.html">Models</a></li>
            
                <li><a href="../classes/Module.html">Module</a></li>
            
                <li><a href="../classes/Multisite.html">Multisite</a></li>
            
                <li><a href="../classes/SaaS.html">SaaS</a></li>
            
                <li><a href="../classes/Shortcode.html">Shortcode</a></li>
            
                <li><a href="../classes/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../classes/Template Methods.html">Template Methods</a></li>
            
                <li><a href="../classes/Theme.html">Theme</a></li>
            
                <li><a href="../classes/UI.html">UI</a></li>
            
                <li><a href="../classes/Utility.html">Utility</a></li>
            
                <li><a href="../classes/Views.html">Views</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/API.html">API</a></li>
            
                <li><a href="../modules/Branded Login.html">Branded Login</a></li>
            
                <li><a href="../modules/Carrington.html">Carrington</a></li>
            
                <li><a href="../modules/Carrington Build.html">Carrington Build</a></li>
            
                <li><a href="../modules/carrington-build.html">carrington-build</a></li>
            
                <li><a href="../modules/cfct_build.html">cfct_build</a></li>
            
                <li><a href="../modules/default.html">default</a></li>
            
                <li><a href="../modules/Flawless.html">Flawless</a></li>
            
                <li><a href="../modules/Loader.html">Loader</a></li>
            
                <li><a href="../modules/Log.html">Log</a></li>
            
                <li><a href="../modules/Maintenence.html">Maintenence</a></li>
            
                <li><a href="../modules/Management.html">Management</a></li>
            
                <li><a href="../modules/Multisite.html">Multisite</a></li>
            
                <li><a href="../modules/SaaS.html">SaaS</a></li>
            
                <li><a href="../modules/Services_JSON.html">Services_JSON</a></li>
            
                <li><a href="../modules/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../modules/taxonomy-landing

This file is part of Taxonomy Landing for WordPress
http:__github.com_crowdfavorite_wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http:__crowdfavorite.com

Released under the GPL license
http:__www.opensource.org_licenses_gpl-license.php

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************.html">taxonomy-landing

This file is part of Taxonomy Landing for WordPress
http://github.com/crowdfavorite/wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http://crowdfavorite.com

Released under the GPL license
http://www.opensource.org/licenses/gpl-license.php

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************</a></li>
            
                <li><a href="../modules/taxonomy-landing

This file is part of Taxonomy Landing for WordPress
https:__github.com_crowdfavorite_wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http:__crowdfavorite.com

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************.html">taxonomy-landing

This file is part of Taxonomy Landing for WordPress
https://github.com/crowdfavorite/wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http://crowdfavorite.com

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************</a></li>
            
                <li><a href="../modules/Theme UI.html">Theme UI</a></li>
            
                <li><a href="../modules/UI.html">UI</a></li>
            
                <li><a href="../modules/UsabilityDynamics.html">UsabilityDynamics</a></li>
            
                <li><a href="../modules/Utility.html">Utility</a></li>
            
                <li><a href="../modules/Views.html">Views</a></li>
            
                <li><a href="../modules/WP-Property.html">WP-Property</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: core/controllers/theme.php</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&lt;?php
/**
 * Presentation
 *
 * @namespace Flawless
 * @class Flawless\Shortcode
 *
 * @user: potanin@UD
 * @date: 8/31/13
 * @time: 10:33 AM
 */
namespace Flawless {

  /**
   * Shortcode Management
   *
   * -
   *
   * @module Flawless
   * @class Theme
   */
  class Theme {

    /**
     * Theme Class version.
     *
     * @public
     * @static
     * @property $version
     * @type {Object}
     */
    public static $version = &#x27;0.1.1&#x27;;

    /**
     * Constructor
     *
     * @method __construct
     * @for Theme
     *
     */
    public function __construct( $options = false ) {
      add_filter( &#x27;flawless::template_redirect&#x27;, array( $this, &#x27;template_redirect&#x27; ) );
      add_filter( &#x27;flawless::theme_setup&#x27;, array( $this, &#x27;theme_setup&#x27; ), 100 );
      add_filter( &#x27;flawless::init_upper&#x27;, array( $this, &#x27;init_upper&#x27; ) );

      add_filter( &#x27;wp_title&#x27;, array( __SELF__, &#x27;wp_title&#x27; ) );
      add_action( &#x27;wp_head&#x27;, array( __SELF__, &#x27;wp_head&#x27; ) );

      add_filter( &#x27;post_link&#x27;, array( __SELF__, &#x27;filter_post_link&#x27; ), 10, 2 );
      add_filter( &#x27;post_type_link&#x27;, array( __SELF__, &#x27;filter_post_link&#x27; ), 10, 2 );
      add_filter( &#x27;post_type_link&#x27;, array( __SELF__, &#x27;filter_post_link&#x27; ), 10, 2 );

      add_filter( &#x27;widget_text&#x27;, &#x27;do_shortcode&#x27; );

    }

    /**
     * Setup theme features using the WordPress API as much as possible.
     *
     * Have to be run on after_setup_theme() level.
     *
     * @updated 0.0.6
     * @since 0.0.2
     */
    public function theme_setup( &amp;$flawless ) {

      //** Load styles to be used by editor */
      add_editor_style( array(
        &#x27;ux/styles/content.css&#x27;,
        &#x27;ux/styles/editor-style.css&#x27;
      ));

      if ( $flawless[ &#x27;color_scheme&#x27; ] ) {
        $flawless[ &#x27;color_scheme_data&#x27; ] = Theme::get_color_schemes( $flawless[ &#x27;color_scheme&#x27; ] );
      }

      $flawless[ &#x27;current_theme_options&#x27; ] = array_merge( (array) $flawless[ &#x27;theme_data&#x27; ], (array) $flawless[ &#x27;child_theme_data&#x27; ], (array) $flawless[ &#x27;color_scheme_data&#x27; ] );

      if ( !empty( $flawless[ &#x27;current_theme_options&#x27; ][ &#x27;Google Fonts&#x27; ] ) ) {
        $flawless[ &#x27;current_theme_options&#x27; ][ &#x27;Google Fonts&#x27; ] = Utility::trim_array( explode( &#x27;, &#x27;, trim( $flawless[ &#x27;current_theme_options&#x27; ][ &#x27;Google Fonts&#x27; ] ) ) );
      }

      if ( !empty( $flawless[ &#x27;current_theme_options&#x27; ][ &#x27;Supported Features&#x27; ] ) ) {
        $flawless[ &#x27;current_theme_options&#x27; ][ &#x27;Supported Features&#x27; ] = Utility::trim_array( explode( &#x27;, &#x27;, trim( $flawless[ &#x27;current_theme_options&#x27; ][ &#x27;Supported Features&#x27; ] ) ) );
      }

      define( &#x27;HEADER_TEXTCOLOR&#x27;, &#x27;000&#x27; );
      define( &#x27;HEADER_IMAGE&#x27;, apply_filters( &#x27;flawless::header_image&#x27;, &#x27;&#x27; ) );
      define( &#x27;HEADER_IMAGE_WIDTH&#x27;, apply_filters( &#x27;flawless::header_image_width&#x27;, $flawless[ &#x27;header_image_width&#x27; ] ? $flawless[ &#x27;header_image_width&#x27; ] : 1090 ) );
      define( &#x27;HEADER_IMAGE_HEIGHT&#x27;, apply_filters( &#x27;flawless::header_image_height&#x27;, $flawless[ &#x27;header_image_height&#x27; ] ? $flawless[ &#x27;header_image_height&#x27; ] : 314 ) );

      add_image_size( &#x27;large-feature&#x27;, HEADER_IMAGE_WIDTH, HEADER_IMAGE_HEIGHT, true );

      //** All Available Theme Features */
      $flawless[ &#x27;available_theme_features&#x27; ][ &#x27;custom-skins&#x27; ] = true;
      $flawless[ &#x27;available_theme_features&#x27; ][ &#x27;post-thumbnails&#x27; ] = true;
      $flawless[ &#x27;available_theme_features&#x27; ][ &#x27;custom-background&#x27; ] = true;
      $flawless[ &#x27;available_theme_features&#x27; ][ &#x27;custom-header&#x27; ] = true;
      $flawless[ &#x27;available_theme_features&#x27; ][ &#x27;automatic-feed-links&#x27; ] = true;
      $flawless[ &#x27;available_theme_features&#x27; ][ &#x27;header-dropdowns&#x27; ] = true;
      $flawless[ &#x27;available_theme_features&#x27; ][ &#x27;header-logo&#x27; ] = true;
      $flawless[ &#x27;available_theme_features&#x27; ][ &#x27;header-navbar&#x27; ] = true;
      $flawless[ &#x27;available_theme_features&#x27; ][ &#x27;header-search&#x27; ] = true;
      $flawless[ &#x27;available_theme_features&#x27; ][ &#x27;header-text&#x27; ] = true;
      $flawless[ &#x27;available_theme_features&#x27; ][ &#x27;mobile-navbar&#x27; ] = true;
      $flawless[ &#x27;available_theme_features&#x27; ][ &#x27;footer-copyright&#x27; ] = true;
      $flawless[ &#x27;available_theme_features&#x27; ][ &#x27;extended-taxonomies&#x27; ] = true;
      $flawless[ &#x27;available_theme_features&#x27; ] = apply_filters( &#x27;flawless::available_theme_features&#x27;, $flawless[ &#x27;available_theme_features&#x27; ] );

      //** Load all Available Theme featurse */
      foreach ( (array) $flawless[ &#x27;available_theme_features&#x27; ] as $feature =&gt; $always_true ) {
        add_theme_support( $feature );
      }

      //** Remove any explicitly disabled Features */
      foreach ( (array) $flawless[ &#x27;disabled_theme_features&#x27; ] as $feature =&gt; $not_false ) {

        if ( $not_false !== &#x27;false&#x27; ) {
          return;
        }

        remove_theme_support( $feature );

        if ( in_array( $feature, array( &#x27;custom-background&#x27;, &#x27;custom-header&#x27;, &#x27;editor-style&#x27;, &#x27;widgets&#x27;, &#x27;menus&#x27; ) ) ) {

          switch ( $feature ) {

            case &#x27;custom-background&#x27;:
              // remove_custom_background();
            break;

            case &#x27;custom-header&#x27;:
              // remove_custom_image_header();
            break;

          }

        }

      }

      do_action( &#x27;flawless::setup_theme_features::after&#x27;, $flawless );

      return $flawless;

    }

    /**
     * Initializer.
     *
     * @method init_upper
     * @for Theme
     */
    public function init_upper( &amp;$flawless ) {

      add_filter( &#x27;request&#x27;, array( __SELF__, &#x27;request&#x27; ), 0 );

    }

    /**
     * Frontend Initializer
     *
     * @method template_redirect
     * @for Theme
     */
    public function template_redirect( &amp;$flawless ) {
      global $wp_query;

      add_filter( &#x27;wp_nav_menu_args&#x27;, array( __CLASS__, &#x27;wp_nav_menu_args&#x27; ), 5 );
      add_filter( &#x27;walker_nav_menu_start_el&#x27;, array( __CLASS__, &#x27;walker_nav_menu_start_el&#x27; ), 5, 4 );
      add_filter( &#x27;nav_menu_css_class&#x27;, array( __CLASS__, &#x27;nav_menu_css_class&#x27; ), 5, 3 );

      add_filter( &#x27;body_class&#x27;, array( __SELF__, &#x27;body_class&#x27; ) );
      add_filter( &#x27;post_class&#x27;, array( __CLASS__, &#x27;post_class&#x27; ), 10, 3 );

      add_filter( &#x27;wp_title&#x27;, array( __CLASS__, &#x27;wp_title&#x27; ), 10, 3 );

      add_action( &#x27;flawless::content_container_top&#x27;, array( __CLASSS__, &#x27;content_container_top&#x27; ) );



      $wp_query-&gt;query_vars[ &#x27;flawless&#x27; ] = &amp;$flawless;

    }

    /**
     * content_container_top
     *
     * ?
     *
     * @method content_container_top
     * @for Theme
     */
    static function content_container_top() {
      flawless_primary_notice_container( &#x27;&#x27; );
    }

    /**
     * Tweaks the default title. In most cases a specialty plugin will be used.
     *
     * @since 0.3.7
     */
    static function wp_title( $current_title, $sep, $seplocation ) {

      $title = array();

      if ( is_home() || is_front_page() ) {
        $title[ ] = get_bloginfo( &#x27;name&#x27; );

        if ( get_bloginfo( &#x27;description&#x27; ) ) {
          $title[ ] = get_bloginfo( &#x27;description&#x27; );
        }

      } else {
        $title[ ] = $current_title;
        $title[ ] = get_bloginfo( &#x27;name&#x27; );
      }

      return trim( implode( &#x27; - &#x27;, $title ) );

    }

    /**
     * Front-end Header Things
     *
     * @since 0.0.2
     */
    public function wp_head() {
      Log::add( &#x27;Executed: Flawless::wp_head();&#x27; );

      $html = array( &#x27;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0&quot;/&gt;&#x27; );

      //** Check for and load favico.ico */
      if ( file_exists( untrailingslashit( get_stylesheet_directory() ) . &#x27;/favicon.ico&#x27; ) ) {
        $html[] = &#x27;&lt;link rel=&quot;shortcut icon&quot; href=&quot;&#x27; . get_bloginfo( &#x27;stylesheet_directory&#x27; ) . &#x27;/favicon.ico&quot; type=&quot;image/x-icon&quot; /&gt;&#x27;;
      };

      if ( file_exists( untrailingslashit( get_stylesheet_directory() ) . &#x27;/apple-touch-icon.png&#x27; ) ) {
        $html[] = &#x27;&lt;link type=&quot;image/png&quot; rel=&quot;apple-touch-icon&quot; href=&quot;&#x27; . untrailingslashit( get_stylesheet_directory_uri() ) . &#x27;&quot;/&gt;&#x27;;
      }

      echo implode( &quot;\n&quot;, $html );

    }

    /**
     * Determines if search request exists but it&#x27;s empty, we do &#x27;hack&#x27; to show Search result page.
     *
     * @author peshkov@UD
     */
    public function request( $query_vars ) {

      if ( isset( $_GET[ &#x27;s&#x27; ] ) &amp;&amp; empty( $_GET[ &#x27;s&#x27; ] ) ) {
        $query_vars[ &#x27;s&#x27; ] = &quot; &quot;;
      }

      return $query_vars;

    }

    /**
     * Filters a post permalink to replace the tag placeholder with the first
     * used term from the taxonomy in question.
     *
     * @source http://www.viper007bond.com/2011/10/07/code-snippet-helper-class-to-add-custom-taxonomy-to-post-permalinks/
     * @since 0.5.0
     */
    static function filter_post_link( $permalink, $post ) {
      global $flawless;

      foreach ( (array) $flawless[ &#x27;taxonomies&#x27; ] as $taxonomy =&gt; $data ) {

        if ( false === strpos( $permalink, $data[ &#x27;rewrite_tag&#x27; ] ) ) {
          continue;
        }

        $terms = get_the_terms( $post-&gt;ID, $taxonomy );
        if ( empty( $terms ) ) {
          $permalink = str_replace( $data[ &#x27;rewrite_tag&#x27; ], $taxonomy, $permalink );
        } else {
          $first_term = array_shift( $terms );
          $permalink = str_replace( $data[ &#x27;rewrite_tag&#x27; ], $first_term-&gt;slug, $permalink );
        }

      }

      return $permalink;

    }

    /**
     * Adds content-specific classes
     *
     */
    static function post_class( $classes ) {

      if ( has_post_thumbnail() ) {
        $classes[ ] = &#x27;has-img&#x27;;
      } else {
        $classes[ ] = &#x27;has-not-img&#x27;;
      }

      return $classes;

    }

    /**
     * Scans asset directories for available color schemes, or can be used to get information about a specific skin.
     *
     * Scans child theme first.
     *
     * @since 0.0.2
     */
    static function get_color_schemes( $requested_scheme = false ) {
      global $flawless;

      $files = wp_cache_get( &#x27;color_schemes&#x27;, &#x27;flawless&#x27; );

      if ( !$files ) {

        //** Reverse so child theme gets scanned first */
        $skin_directories = apply_filters( &#x27;flawless::skin_directories&#x27;, array_reverse( $flawless[ &#x27;asset_directories&#x27; ] ) );

        foreach ( (array) $skin_directories as $path =&gt; $url ) {

          if ( !is_dir( $path ) || !$resource = opendir( $path ) ) {
            continue;
          }

          while ( false !== ( $file = readdir( $resource ) ) ) {

            if ( $file == &quot;.&quot; || $file == &quot;..&quot; || strpos( $file, &#x27;skin-&#x27; ) !== 0 || substr( strrchr( $file, &#x27;.&#x27; ), 1 ) != &#x27;css&#x27; ) {
              continue;
            }

            $file_data = array_filter( (array) @get_file_data( $path . &#x27;/&#x27; . $file, $flawless[ &#x27;default_header&#x27; ][ &#x27;themes&#x27; ], &#x27;themes&#x27; ) );

            if ( empty( $file_data ) ) {
              continue;
            }

            $file_data[ &#x27;css_path&#x27; ] = $path . &#x27;/&#x27; . $file;
            $file_data[ &#x27;css_url&#x27; ] = $url . &#x27;/&#x27; . $file;

            $potential_thumbnails = array(
              str_replace( &#x27;.css&#x27;, &#x27;.jpg&#x27;, $file ),
              str_replace( &#x27;.css&#x27;, &#x27;.png&#x27;, $file )
            );

            if ( !empty( $file_data[ &#x27;Thumbnail&#x27; ] ) ) {
              $potential_thumbnails[ ] = $file_data[ &#x27;Thumbnail&#x27; ];
              array_reverse( $potential_thumbnails );
            }

            foreach ( (array) $potential_thumbnails as $thumbnail_filename ) {
              foreach ( (array) $skin_directories as $thumb_path =&gt; $thumb_url ) {
                if ( file_exists( trailingslashit( $thumb_path ) . &#x27;/&#x27; . $thumbnail_filename ) ) {
                  $file_data[ &#x27;thumb_url&#x27; ] = $thumb_url . &#x27;/&#x27; . $thumbnail_filename;
                  break;
                }
              }
            }

            if ( !isset( $files[ $file ] ) ) {
              $files[ $file ] = array_filter( ( array) $file_data );
            }

          }
        }

        $files = array_filter( (array) $files );

      }

      wp_cache_set( &#x27;color_schemes&#x27;, $files, &#x27;flawless&#x27; );

      if ( $requested_scheme &amp;&amp; $files[ $requested_scheme ] ) {
        return $files[ $requested_scheme ];
      }

      if ( empty( $files ) ) {
        return false;
      }

      return $files;

    }

    /**
     * Add all the body classes
     *
     * @since 0.2.5
     * @author potanin@UD
     */
    static function body_class( $classes, $class ) {
      global $flawless;

      //** Added classes to body */
      foreach ( (array) $flawless[ &#x27;current_view&#x27; ][ &#x27;body_classes&#x27; ] as $class ) {
        $classes[ ] = $class;
      }

      if ( $flawless[ &#x27;visual_debug&#x27; ] == &#x27;true&#x27; ) {
        $classes[ ] = &#x27;flawless_visual_debug&#x27;;
      }

      $classes = apply_filters( &#x27;flawless::body_class&#x27;, $classes, $class );

      return array_unique( $classes );

    }

    /**
     * {need description}
     *
     * Adds a special class to menus that display descriptions for the individual menu items
     *
     * @since 0.0.2
     *
     */
    static function wp_nav_menu_args( $args ) {
      global $flawless;

      if ( $flawless[ &#x27;menus&#x27; ][ $args[ &#x27;theme_location&#x27; ] ][ &#x27;show_descriptions&#x27; ] == &#x27;true&#x27; ) {
        $args[ &#x27;menu_class&#x27; ] = $args[ &#x27;menu_class&#x27; ] . &#x27; menu_items_have_descriptions&#x27;;
      }

      return $args;

    }

    /**
     * {need description}
     *
     * @since 0.0.2
     *
     */
    static function walker_nav_menu_start_el( $item_output, $item, $depth, $args ) {
      global $flawless;

      //** Do not add description if this is not a top level menu item */
      if ( $item-&gt;menu_item_parent || $flawless[ &#x27;menus&#x27; ][ $args-&gt;theme_location ][ &#x27;show_descriptions&#x27; ] != &#x27;true&#x27; ) {
        return $item_output;
      }

      $char_limit = 50;

      $description = substr( $item-&gt;description, 0, $char_limit ) . ( strlen( $item-&gt;description ) &gt; $char_limit ? &#x27;...&#x27; : &#x27;&#x27; );

      $trigger = &#x27;&lt;/a&gt;&#x27; . $args-&gt;after;

      //** Inject description HTML by identifying the $args-&gt;after */
      $item_output = str_replace( $trigger, $trigger . ( $description ? &#x27;&lt;span class=&quot;menu_item_description&quot;&gt;&#x27; . $description . &#x27;&lt;/span&gt;&#x27; : &#x27;&#x27; ), $item_output );

      return $item_output;

    }

    /**
     * Modified front-end menus and adds extra classes
     *
     * @todo Find way to inexpensively figure out if current item is last and add a class.
     * @since 0.0.2
     */
    static function nav_menu_css_class( $classes, $item, $args ) {
      global $post, $flawless, $wpdb;

      $total_items = $wpdb-&gt;get_var( &quot;SELECT count FROM {$wpdb-&gt;term_relationships} tr LEFT JOIN {$wpdb-&gt;term_taxonomy} tt ON tr.term_taxonomy_id = tt.term_taxonomy_id WHERE object_id = {$item-&gt;db_id} AND taxonomy = &#x27;nav_menu&#x27; &quot; );

      if ( !$item-&gt;menu_item_parent ) {
        $classes[ ] = &#x27;top_level_item&#x27;;
      } else {
        $classes[ ] = &#x27;sub_menu_level_item&#x27;;
      }

      if ( $item-&gt;menu_order == 1 ) {
        $classes[ ] = &#x27;first&#x27;;

      }
      if ( $item-&gt;menu_order == $total_items ) {
        $classes[ ] = &#x27;last&#x27;;
      }

      //** Check if the currently rendered item is a child of this link */
      if ( untrailingslashit( $item-&gt;url ) == untrailingslashit( $flawless[ &#x27;post_types&#x27; ][ $post-&gt;post_type ][ &#x27;archive_url&#x27; ] ) ) {

        $classes[ ] = &#x27;current-page-ancestor current-menu-ancestor current-menu-parent current-page-parent current_page_parent flawless_ad_hoc_menu_parent&#x27;;

        //** This menu item is an ad-hoc parent of something, we need to update parent elements as well */
        if ( $item-&gt;menu_item_parent ) {

        }

      }

      return $classes;

    }

  }

}
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
