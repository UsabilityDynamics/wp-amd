<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>premium/carrington-build/vendor/carrington-build/lib/wp-taxonomy-landing/functions/cftl-post-type.php - Flawless</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://a3d72a45d111006ec192-ec5b80a12b0b09b4d52373336afb4254.r80.cf1.rackcdn.com/usability-dynamics.png" title="Flawless"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/: Flawless.Element.html">: Flawless.Element</a></li>
            
                <li><a href="../classes/: Flawless.Flawless_Module.html">: Flawless.Flawless_Module</a></li>
            
                <li><a href="../classes/: Flawless.Flawless_Shortcode.html">: Flawless.Flawless_Shortcode</a></li>
            
                <li><a href="../classes/: Flawless.Flawless_Widget.html">: Flawless.Flawless_Widget</a></li>
            
                <li><a href="../classes/: Flawless.flawless_wpp_extensions.html">: Flawless.flawless_wpp_extensions</a></li>
            
                <li><a href="../classes/: Flawless.License.html">: Flawless.License</a></li>
            
                <li><a href="../classes/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../classes/Template Functions.html">Template Functions</a></li>
            
                <li><a href="../classes/Template Methods.html">Template Methods</a></li>
            
                <li><a href="../classes/Theme UI.html">Theme UI</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Core Assets.html">Core Assets</a></li>
            
                <li><a href="../modules/Flawless.html">Flawless</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: premium/carrington-build/vendor/carrington-build/lib/wp-taxonomy-landing/functions/cftl-post-type.php</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&lt;?php

/**
 * @package taxonomy-landing
 *
 * This file is part of Taxonomy Landing for WordPress
 * https://github.com/crowdfavorite/wp-taxonomy-landing
 *
 * Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
 * http://crowdfavorite.com
 *
 * **********************************************************************
 * This program is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * **********************************************************************
 */

if (__FILE__ == $_SERVER[&#x27;SCRIPT_FILENAME&#x27;]) { die(); }

/**
 * Registers the taxonomy-landing custom post type
 */
function cftl_register_taxonomy_landing() {
  register_post_type(&#x27;cftl-tax-landing&#x27;, array(
    &#x27;labels&#x27; =&gt; array(
      &#x27;name&#x27; =&gt; __(&#x27;Landing Pages&#x27;, &#x27;cf-tax-landing&#x27;),
      &#x27;singular_name&#x27; =&gt; __(&#x27;Landing Page&#x27;, &#x27;cf-tax-landing&#x27;),
      &#x27;add_new&#x27; =&gt; _x(&#x27;Add New&#x27;, &#x27;cftl-tax-landing&#x27;, &#x27;cf-tax-landing&#x27;),
      &#x27;add_new_item&#x27; =&gt; __(&#x27;Add New Landing Page&#x27;, &#x27;cf-tax-landing&#x27;),
      &#x27;edit_item&#x27; =&gt; __(&#x27;Edit Landing Page&#x27;, &#x27;cf-tax-landing&#x27;),
      &#x27;new_item&#x27; =&gt; __(&#x27;New Landing Page&#x27;, &#x27;cf-tax-landing&#x27;),
      &#x27;all_items&#x27; =&gt; __(&#x27;All Landing Pages&#x27;, &#x27;cf-tax-landing&#x27;),
      &#x27;view_item&#x27; =&gt; __(&#x27;View Landing Page&#x27;, &#x27;cf-tax-landing&#x27;),
      &#x27;search_items&#x27; =&gt; __(&#x27;Search Landing Pages&#x27;, &#x27;cf-tax-landing&#x27;),
      &#x27;not_found&#x27; =&gt;  __(&#x27;No Landing Pages found&#x27;, &#x27;cf-tax-landing&#x27;),
      &#x27;not_found_in_trash&#x27; =&gt; __(&#x27;No Landing Pages found in Trash&#x27;, &#x27;cf-tax-landing&#x27;),
      &#x27;parent_item_colon&#x27; =&gt; &#x27;&#x27;,
      &#x27;menu_name&#x27; =&gt; __(&#x27;Landing Pages&#x27;, &#x27;cf-tax-landing&#x27;)
    ),
    &#x27;supports&#x27; =&gt; array(
      &#x27;title&#x27;,
      &#x27;editor&#x27;,
      &#x27;page-attributes&#x27;,
      &#x27;thumbnail&#x27;,
      &#x27;revisions&#x27;,
    ),
    &#x27;public&#x27; =&gt; false,
    &#x27;exclude_from_search&#x27; =&gt; true,
    &#x27;show_in_nav_menus&#x27; =&gt; false,
    &#x27;show_ui&#x27; =&gt; true,
    &#x27;show_in_menu&#x27; =&gt; true,
    &#x27;hierarchical&#x27; =&gt; true,
  ));
}

add_action(&#x27;init&#x27;, &#x27;cftl_register_taxonomy_landing&#x27;);

/**
 * Remove Permalink display / edit controls
 */
function cfct_get_sample_permalink_html($return, $id, $new_title, $new_slug) {
  $post = get_post($id);
  if (!empty($post) &amp;&amp; $post-&gt;post_type == &#x27;cftl-tax-landing&#x27;) {
    return &#x27;&#x27;;
  }
  return $return;
}

add_filter(&#x27;get_sample_permalink_html&#x27;, &#x27;cfct_get_sample_permalink_html&#x27;, 10, 4);

/**
 * Remove Categories and Tags submenu items
 */
function cftl_remove_submenu_items() {
  global $wp_taxonomies;
  foreach ($wp_taxonomies as $tax) {
    remove_submenu_page(&#x27;edit.php?post_type=cftl-tax-landing&#x27;, &#x27;edit-tags.php?taxonomy=&#x27; . $tax-&gt;name . &#x27;&amp;amp;post_type=cftl-tax-landing&#x27;);
  }
}

add_action(&#x27;admin_menu&#x27;, &#x27;cftl_remove_submenu_items&#x27;);

function cftl_register_taxonomies_to_tax_landing() {
  global $wp_taxonomies;
  foreach ($wp_taxonomies as $taxonomy) {
    register_taxonomy_for_object_type($taxonomy-&gt;name, &#x27;cftl-tax-landing&#x27;);
  }
}

add_action(&#x27;init&#x27;, &#x27;cftl_register_taxonomies_to_tax_landing&#x27;, 99999);

function cftl_register_taxonomy_landing_filter($types) {
  $types = array_merge($types, array(&#x27;post&#x27;, &#x27;cftl-tax-landing&#x27;));
  return $types;
}

add_filter(&#x27;cftl-build-enabled-post-types&#x27;, &#x27;cftl_register_taxonomy_landing_filter&#x27;);

function cftl_set_tax_landing_title_admin($title) {
  global $post;
  if (!$post) {
    return $title;
  }
  if ($post-&gt;post_type != &#x27;cftl-tax-landing&#x27; || !is_admin()) {
    return $title;
  }
  $title_array = array();
  foreach (get_the_taxonomies($post) as $tax_name =&gt; $tax_list) {
    $title_array[] = strip_tags($tax_list);
  }
  if (empty($title_array)) {
    return sprintf(__(&#x27;%s - No specified taxonomies.&#x27;, &#x27;cf-tax-landing&#x27;), $title);
  }
  return $title . &#x27; - &#x27; . implode(&#x27; &#x27;, $title_array);
}

function cftl_set_tax_landing_title($title) {
  global $post, $cftl_tax_landing;
  if (!$post) {
    return $title;
  }
  if ($post-&gt;post_type != &#x27;cftl-tax-landing&#x27;) {
    return $title;
  }

  $substitutions = array(
    &#x27;[archives]&#x27; =&gt; __(&#x27;Archives&#x27;, &#x27;cf-tax-landing&#x27;),
    &#x27;[tax-title]&#x27; =&gt; $cftl_tax_landing[&#x27;original_title&#x27;],
    );
  $title = str_replace(array_keys($substitutions), array_values($substitutions), $title);

  return $title;
}

if (is_admin()) {
  add_filter(&#x27;the_title&#x27;, &#x27;cftl_set_tax_landing_title_admin&#x27;);
}
else {
  add_filter(&#x27;the_title&#x27;, &#x27;cftl_set_tax_landing_title&#x27;);
}

function cftl_tax_landing_messages($messages) {
  global $post;
  $taxonomy_array = get_the_taxonomies($post);
  if (!empty($taxonomy_array)) {
    $taxonomy_links = implode(&#x27; &#x27;, $taxonomy_array);
  }
  else {
    $taxonomy_links = __(&quot;No taxonomies specified.&quot;, &#x27;cf-tax-landing&#x27;);
  }

  $messages[&#x27;cftl-tax-landing&#x27;] = array(
    0 =&gt; &#x27;&#x27;, // Unused. Messages start at index 1.
    1 =&gt; sprintf(__(&#x27;Landing Page updated.  %s&#x27;, &#x27;cf-tax-landing&#x27;), $taxonomy_links),
    2 =&gt; __(&#x27;Custom field updated.&#x27;),
    3 =&gt; __(&#x27;Custom field deleted.&#x27;),
    4 =&gt; __(&#x27;Landing Page updated.&#x27;, &#x27;cf-tax-landing&#x27;),
    /* translators: %s: date and time of the revision */
    5 =&gt; isset($_GET[&#x27;revision&#x27;]) ? sprintf(__(&#x27;Landing Page restored to revision from %s&#x27;, &#x27;cf-tax-landing&#x27;), wp_post_revision_title((int) $_GET[&#x27;revision&#x27;], false)) : false,
    6 =&gt; sprintf(__(&#x27;Landing Page published.  %s&#x27;, &#x27;cf-tax-landing&#x27;), $taxonomy_links),
    7 =&gt; __(&#x27;Landing Page saved.&#x27;, &#x27;cf-tax-landing&#x27;),
    8 =&gt; sprintf(__(&#x27;Landing Page submitted.  %s&#x27;, &#x27;cf-tax-landing&#x27;), $taxonomy_links),
    9 =&gt; sprintf(__(&#x27;Landing Page scheduled for: &lt;strong&gt;%1$s&lt;/strong&gt;.&#x27;, &#x27;cf-tax-landing&#x27;),
      // translators: Publish box date format, see http://php.net/date
      date_i18n(__(&#x27;M j, Y @ G:i&#x27;), strtotime($post-&gt;post_date))),
    10 =&gt; sprintf(__(&#x27;Landing Page updated.&#x27;, &#x27;cf-tax-landing&#x27;)),
  );

  return $messages;
}

add_filter(&#x27;post_updated_messages&#x27;, &#x27;cftl_tax_landing_messages&#x27;);


function cftl_tax_landing_help($contextual_help, $screen_id, $screen) {
  // $contextual_help .= var_dump($screen); // use this to help determine $screen-&gt;id
  if (&#x27;cftl-tax-landing&#x27; == $screen-&gt;id) {
  $contextual_help =
    &#x27;&lt;p&gt;&#x27; . __(&#x27;When adding or editing a Landing Page:&#x27;, &#x27;cf-tax-landing&#x27;) . &#x27;&lt;/p&gt;&#x27; .
    &#x27;&lt;ul&gt;&#x27; .
    &#x27;&lt;li&gt;&#x27; . __(&#x27;Specify at least one category, tag, or custom taxonomy.&#x27;) . &#x27;&lt;/li&gt;&#x27; .
    &#x27;&lt;li&gt;&#x27; . __(&#x27;When a taxonomy archive is requested, such as a category page, the first Landing Page with that taxonomy (if any) is used.&#x27;) . &#x27;&lt;/li&gt;&#x27; .
    &#x27;&lt;/ul&gt;&#x27;;
  }
  elseif (&#x27;edit-cftl-tax-landing&#x27; == $screen-&gt;id) {
    $contextual_help = &#x27;&lt;p&gt;&#x27; . __(&#x27;Landing Pages are used to override the default category, tag, and custom Landing Pages with a Build-layout page.&#x27;, &#x27;cf-tax-landing&#x27;) . &#x27;&lt;/p&gt;&#x27;;
  }
  return $contextual_help;
}
add_action(&#x27;contextual_help&#x27;, &#x27;cftl_tax_landing_help&#x27;, 10, 3);

function cftl_tax_landing_add_extras_box() {
  if (0 != count(get_page_templates())) {
    add_meta_box(
      &#x27;cftl_tax_landing_extras&#x27;,
      __(&#x27;Landing Page Details&#x27;, &#x27;cf-tax-landing&#x27;),
      &#x27;cftl_tax_landing_extras_box&#x27;,
      &#x27;cftl-tax-landing&#x27;,
      &#x27;side&#x27;,
      &#x27;high&#x27;
    );
  }
}
add_action(&#x27;add_meta_boxes&#x27;, &#x27;cftl_tax_landing_add_extras_box&#x27;);


function cftl_tax_landing_extras_box($post) {
  wp_nonce_field(plugin_basename(__FILE__), &#x27;cftl_tax_landing_extras_nonce&#x27;);

  $taxonomy_array = get_the_taxonomies($post);
  if (!empty($taxonomy_array)) {
    $taxonomy_links = implode(&#x27;&lt;br/&gt;&#x27;, $taxonomy_array);
  }
  else {
    $taxonomy_links = __(&quot;No taxonomies specified.&quot;, &#x27;cf-tax-landing&#x27;);
  }

  $page_template = get_post_meta($post-&gt;ID, &#x27;_wp_page_template&#x27;, true);
  ?&gt;
&lt;div class=&quot;form-field&quot;&gt;
  &lt;label for=&quot;cftl_page_template&quot;&gt;&lt;?php _e(&#x27;Page Template&#x27;, &#x27;cf-tax-landing&#x27;) ?&gt;&lt;/label&gt;
  &lt;select name=&quot;cftl_page_template&quot; id=&quot;cftl_page_template&quot;&gt;
    &lt;option value=&quot;&quot;&lt;?php echo empty($page_template) ? &#x27; selected=&quot;selected&quot;&#x27; : &#x27;&#x27; ?&gt;&gt;&lt;?php _e(&#x27;No Template (Use Post Templates)&#x27;, &#x27;cf-tax-landing&#x27;); ?&gt;&lt;/option&gt;
    &lt;option value=&quot;default&quot;&lt;?php echo (&quot;default&quot; == $page_template) ? &#x27; selected=&quot;selected&quot;&#x27; : &#x27;&#x27;?&gt;&gt;&lt;?php _e(&#x27;Default (Page) Template&#x27;, &#x27;cf-tax-landing&#x27;); ?&gt;&lt;/option&gt;
    &lt;?php page_template_dropdown($page_template); ?&gt;
  &lt;/select&gt;
&lt;/div&gt;
&lt;div class=&quot;form-field&quot;&gt;
  &lt;label&gt;&lt;?php _e(&#x27;Current taxonomy links:&#x27;, &#x27;cf-tax-landing&#x27;) ?&gt;&lt;/label&gt;&lt;br/&gt;
  &lt;?php echo $taxonomy_links; ?&gt;
&lt;/div&gt;
&lt;?php
}


function cftl_tax_landing_save_extras($post_id) {
  if (defined(&#x27;DOING_AUTOSAVE&#x27;) &amp;&amp; DOING_AUTOSAVE) {
    return;
  }

  if (!isset($_POST[&#x27;post_type&#x27;]) || $_POST[&#x27;post_type&#x27;] != &#x27;cftl-tax-landing&#x27;) {
    return;
  }

  if (!isset($_POST[&#x27;cftl_tax_landing_extras_nonce&#x27;]) || !wp_verify_nonce($_POST[&#x27;cftl_tax_landing_extras_nonce&#x27;], plugin_basename(__FILE__))) {
    return;
  }


  if (!current_user_can(&#x27;edit_post&#x27;, $post_id)) {
    return;
  }
  $page_template = isset($_POST[&#x27;cftl_page_template&#x27;]) ? $_POST[&#x27;cftl_page_template&#x27;] : null;
  $page_templates = get_page_templates();
  if (empty($page_template) || (&#x27;default&#x27; != $page_template &amp;&amp; !in_array($page_template, $page_templates))) {

    delete_post_meta($post_id, &#x27;_wp_page_template&#x27;);
  }
  else {
    update_post_meta($post_id, &#x27;_wp_page_template&#x27;, $page_template);
  }
}


add_action(&#x27;save_post&#x27;, &#x27;cftl_tax_landing_save_extras&#x27;);

function cftl_post_type_link($post_link, $post) {
  if ($post-&gt;post_type != &quot;cftl-tax-landing&quot;) {
    return $post_link;
  }
  $tax = get_object_taxonomies($post, &#x27;object&#x27;);
  $term = null;
  foreach ($tax as $label =&gt; $tax_obj) {
    $terms = get_object_term_cache($post-&gt;ID, $label);
    if (!empty($terms)) {
      $term = array_shift($terms);
      break;
    }
  }
  if (!empty($term)) {
    return get_term_link($term);
  }

  return $post_link;

}

add_filter(&#x27;post_type_link&#x27;, &#x27;cftl_post_type_link&#x27;, 10, 2);


    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
