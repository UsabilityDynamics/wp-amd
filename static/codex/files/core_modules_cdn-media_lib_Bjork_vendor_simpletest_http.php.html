<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core/modules/cdn-media/lib/Bjork/vendor/simpletest/http.php - wp-flawless</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://a3d72a45d111006ec192-ec5b80a12b0b09b4d52373336afb4254.r80.cf1.rackcdn.com/usability-dynamics.png" title="wp-flawless"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/API.html">API</a></li>
            
                <li><a href="../classes/Carrington.html">Carrington</a></li>
            
                <li><a href="../classes/Extended_Taxonomies.html">Extended_Taxonomies</a></li>
            
                <li><a href="../classes/Flawless.API.html">Flawless.API</a></li>
            
                <li><a href="../classes/Flawless.Asset.html">Flawless.Asset</a></li>
            
                <li><a href="../classes/Flawless.Branded_Login.html">Flawless.Branded_Login</a></li>
            
                <li><a href="../classes/Flawless.BuddyPress.html">Flawless.BuddyPress</a></li>
            
                <li><a href="../classes/Flawless.Content.html">Flawless.Content</a></li>
            
                <li><a href="../classes/Flawless.Element.html">Flawless.Element</a></li>
            
                <li><a href="../classes/Flawless.Flawless\Shortcode.html">Flawless.Flawless\Shortcode</a></li>
            
                <li><a href="../classes/Flawless.Management.html">Flawless.Management</a></li>
            
                <li><a href="../classes/Flawless.Mobile.html">Flawless.Mobile</a></li>
            
                <li><a href="../classes/Flawless.Navbars.html">Flawless.Navbars</a></li>
            
                <li><a href="../classes/Flawless.Schema.html">Flawless.Schema</a></li>
            
                <li><a href="../classes/Flawless.Settings.html">Flawless.Settings</a></li>
            
                <li><a href="../classes/Flawless.Styles.html">Flawless.Styles</a></li>
            
                <li><a href="../classes/Flawless.Utility.html">Flawless.Utility</a></li>
            
                <li><a href="../classes/Flawless.Widget.html">Flawless.Widget</a></li>
            
                <li><a href="../classes/flawless_wpp_extensions.html">flawless_wpp_extensions</a></li>
            
                <li><a href="../classes/Legacy.html">Legacy</a></li>
            
                <li><a href="../classes/License.html">License</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/Log.html">Log</a></li>
            
                <li><a href="../classes/Maintenance.html">Maintenance</a></li>
            
                <li><a href="../classes/Models.html">Models</a></li>
            
                <li><a href="../classes/Module.html">Module</a></li>
            
                <li><a href="../classes/Multisite.html">Multisite</a></li>
            
                <li><a href="../classes/SaaS.html">SaaS</a></li>
            
                <li><a href="../classes/Shortcode.html">Shortcode</a></li>
            
                <li><a href="../classes/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../classes/Template Methods.html">Template Methods</a></li>
            
                <li><a href="../classes/Theme.html">Theme</a></li>
            
                <li><a href="../classes/UI.html">UI</a></li>
            
                <li><a href="../classes/Utility.html">Utility</a></li>
            
                <li><a href="../classes/Views.html">Views</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/API.html">API</a></li>
            
                <li><a href="../modules/Branded Login.html">Branded Login</a></li>
            
                <li><a href="../modules/Carrington.html">Carrington</a></li>
            
                <li><a href="../modules/Carrington Build.html">Carrington Build</a></li>
            
                <li><a href="../modules/carrington-build.html">carrington-build</a></li>
            
                <li><a href="../modules/cfct_build.html">cfct_build</a></li>
            
                <li><a href="../modules/default.html">default</a></li>
            
                <li><a href="../modules/Flawless.html">Flawless</a></li>
            
                <li><a href="../modules/Loader.html">Loader</a></li>
            
                <li><a href="../modules/Log.html">Log</a></li>
            
                <li><a href="../modules/Maintenence.html">Maintenence</a></li>
            
                <li><a href="../modules/Management.html">Management</a></li>
            
                <li><a href="../modules/Multisite.html">Multisite</a></li>
            
                <li><a href="../modules/SaaS.html">SaaS</a></li>
            
                <li><a href="../modules/Services_JSON.html">Services_JSON</a></li>
            
                <li><a href="../modules/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../modules/taxonomy-landing

This file is part of Taxonomy Landing for WordPress
http:__github.com_crowdfavorite_wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http:__crowdfavorite.com

Released under the GPL license
http:__www.opensource.org_licenses_gpl-license.php

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************.html">taxonomy-landing

This file is part of Taxonomy Landing for WordPress
http://github.com/crowdfavorite/wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http://crowdfavorite.com

Released under the GPL license
http://www.opensource.org/licenses/gpl-license.php

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************</a></li>
            
                <li><a href="../modules/taxonomy-landing

This file is part of Taxonomy Landing for WordPress
https:__github.com_crowdfavorite_wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http:__crowdfavorite.com

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************.html">taxonomy-landing

This file is part of Taxonomy Landing for WordPress
https://github.com/crowdfavorite/wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http://crowdfavorite.com

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************</a></li>
            
                <li><a href="../modules/Theme UI.html">Theme UI</a></li>
            
                <li><a href="../modules/UI.html">UI</a></li>
            
                <li><a href="../modules/UsabilityDynamics.html">UsabilityDynamics</a></li>
            
                <li><a href="../modules/Utility.html">Utility</a></li>
            
                <li><a href="../modules/Views.html">Views</a></li>
            
                <li><a href="../modules/WP-Property.html">WP-Property</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: core/modules/cdn-media/lib/Bjork/vendor/simpletest/http.php</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&lt;?php
/**
 *  base include file for SimpleTest
 *  @package    SimpleTest
 *  @subpackage WebTester
 *  @version    $Id: http.php 2011 2011-04-29 08:22:48Z pp11 $
 */

/**#@+
 *  include other SimpleTest class files
 */
require_once(dirname(__FILE__) . &#x27;/socket.php&#x27;);
require_once(dirname(__FILE__) . &#x27;/cookies.php&#x27;);
require_once(dirname(__FILE__) . &#x27;/url.php&#x27;);
/**#@-*/

/**
 *    Creates HTTP headers for the end point of
 *    a HTTP request.
 *    @package SimpleTest
 *    @subpackage WebTester
 */
class SimpleRoute {
    private $url;

    /**
     *    Sets the target URL.
     *    @param SimpleUrl $url   URL as object.
     *    @access public
     */
    function __construct($url) {
        $this-&gt;url = $url;
    }

    /**
     *    Resource name.
     *    @return SimpleUrl        Current url.
     *    @access protected
     */
    function getUrl() {
        return $this-&gt;url;
    }

    /**
     *    Creates the first line which is the actual request.
     *    @param string $method   HTTP request method, usually GET.
     *    @return string          Request line content.
     *    @access protected
     */
    protected function getRequestLine($method) {
        return $method . &#x27; &#x27; . $this-&gt;url-&gt;getPath() .
                $this-&gt;url-&gt;getEncodedRequest() . &#x27; HTTP/1.0&#x27;;
    }

    /**
     *    Creates the host part of the request.
     *    @return string          Host line content.
     *    @access protected
     */
    protected function getHostLine() {
        $line = &#x27;Host: &#x27; . $this-&gt;url-&gt;getHost();
        if ($this-&gt;url-&gt;getPort()) {
            $line .= &#x27;:&#x27; . $this-&gt;url-&gt;getPort();
        }
        return $line;
    }

    /**
     *    Opens a socket to the route.
     *    @param string $method      HTTP request method, usually GET.
     *    @param integer $timeout    Connection timeout.
     *    @return SimpleSocket       New socket.
     *    @access public
     */
    function createConnection($method, $timeout) {
        $default_port = (&#x27;https&#x27; == $this-&gt;url-&gt;getScheme()) ? 443 : 80;
        $socket = $this-&gt;createSocket(
                $this-&gt;url-&gt;getScheme() ? $this-&gt;url-&gt;getScheme() : &#x27;http&#x27;,
                $this-&gt;url-&gt;getHost(),
                $this-&gt;url-&gt;getPort() ? $this-&gt;url-&gt;getPort() : $default_port,
                $timeout);
        if (! $socket-&gt;isError()) {
            $socket-&gt;write($this-&gt;getRequestLine($method) . &quot;\r\n&quot;);
            $socket-&gt;write($this-&gt;getHostLine() . &quot;\r\n&quot;);
            $socket-&gt;write(&quot;Connection: close\r\n&quot;);
        }
        return $socket;
    }

    /**
     *    Factory for socket.
     *    @param string $scheme                   Protocol to use.
     *    @param string $host                     Hostname to connect to.
     *    @param integer $port                    Remote port.
     *    @param integer $timeout                 Connection timeout.
     *    @return SimpleSocket/SimpleSecureSocket New socket.
     *    @access protected
     */
    protected function createSocket($scheme, $host, $port, $timeout) {
        if (in_array($scheme, array(&#x27;file&#x27;))) {
            return new SimpleFileSocket($this-&gt;url);
        } elseif (in_array($scheme, array(&#x27;https&#x27;))) {
            return new SimpleSecureSocket($host, $port, $timeout);
        } else {
            return new SimpleSocket($host, $port, $timeout);
        }
    }
}

/**
 *    Creates HTTP headers for the end point of
 *    a HTTP request via a proxy server.
 *    @package SimpleTest
 *    @subpackage WebTester
 */
class SimpleProxyRoute extends SimpleRoute {
    private $proxy;
    private $username;
    private $password;

    /**
     *    Stashes the proxy address.
     *    @param SimpleUrl $url     URL as object.
     *    @param string $proxy      Proxy URL.
     *    @param string $username   Username for autentication.
     *    @param string $password   Password for autentication.
     *    @access public
     */
    function __construct($url, $proxy, $username = false, $password = false) {
        parent::__construct($url);
        $this-&gt;proxy = $proxy;
        $this-&gt;username = $username;
        $this-&gt;password = $password;
    }

    /**
     *    Creates the first line which is the actual request.
     *    @param string $method   HTTP request method, usually GET.
     *    @param SimpleUrl $url   URL as object.
     *    @return string          Request line content.
     *    @access protected
     */
    function getRequestLine($method) {
        $url = $this-&gt;getUrl();
        $scheme = $url-&gt;getScheme() ? $url-&gt;getScheme() : &#x27;http&#x27;;
        $port = $url-&gt;getPort() ? &#x27;:&#x27; . $url-&gt;getPort() : &#x27;&#x27;;
        return $method . &#x27; &#x27; . $scheme . &#x27;://&#x27; . $url-&gt;getHost() . $port .
                $url-&gt;getPath() . $url-&gt;getEncodedRequest() . &#x27; HTTP/1.0&#x27;;
    }

    /**
     *    Creates the host part of the request.
     *    @param SimpleUrl $url   URL as object.
     *    @return string          Host line content.
     *    @access protected
     */
    function getHostLine() {
        $host = &#x27;Host: &#x27; . $this-&gt;proxy-&gt;getHost();
        $port = $this-&gt;proxy-&gt;getPort() ? $this-&gt;proxy-&gt;getPort() : 8080;
        return &quot;$host:$port&quot;;
    }

    /**
     *    Opens a socket to the route.
     *    @param string $method       HTTP request method, usually GET.
     *    @param integer $timeout     Connection timeout.
     *    @return SimpleSocket        New socket.
     *    @access public
     */
    function createConnection($method, $timeout) {
        $socket = $this-&gt;createSocket(
                $this-&gt;proxy-&gt;getScheme() ? $this-&gt;proxy-&gt;getScheme() : &#x27;http&#x27;,
                $this-&gt;proxy-&gt;getHost(),
                $this-&gt;proxy-&gt;getPort() ? $this-&gt;proxy-&gt;getPort() : 8080,
                $timeout);
        if ($socket-&gt;isError()) {
            return $socket;
        }
        $socket-&gt;write($this-&gt;getRequestLine($method) . &quot;\r\n&quot;);
        $socket-&gt;write($this-&gt;getHostLine() . &quot;\r\n&quot;);
        if ($this-&gt;username &amp;&amp; $this-&gt;password) {
            $socket-&gt;write(&#x27;Proxy-Authorization: Basic &#x27; .
                    base64_encode($this-&gt;username . &#x27;:&#x27; . $this-&gt;password) .
                    &quot;\r\n&quot;);
        }
        $socket-&gt;write(&quot;Connection: close\r\n&quot;);
        return $socket;
    }
}

/**
 *    HTTP request for a web page. Factory for
 *    HttpResponse object.
 *    @package SimpleTest
 *    @subpackage WebTester
 */
class SimpleHttpRequest {
    private $route;
    private $encoding;
    private $headers;
    private $cookies;

    /**
     *    Builds the socket request from the different pieces.
     *    These include proxy information, URL, cookies, headers,
     *    request method and choice of encoding.
     *    @param SimpleRoute $route              Request route.
     *    @param SimpleFormEncoding $encoding    Content to send with
     *                                           request.
     *    @access public
     */
    function __construct($route, $encoding) {
        $this-&gt;route = $route;
        $this-&gt;encoding = $encoding;
        $this-&gt;headers = array();
        $this-&gt;cookies = array();
    }

    /**
     *    Dispatches the content to the route&#x27;s socket.
     *    @param integer $timeout      Connection timeout.
     *    @return SimpleHttpResponse   A response which may only have
     *                                 an error, but hopefully has a
     *                                 complete web page.
     *    @access public
     */
    function fetch($timeout) {
        $socket = $this-&gt;route-&gt;createConnection($this-&gt;encoding-&gt;getMethod(), $timeout);
        if (! $socket-&gt;isError()) {
            $this-&gt;dispatchRequest($socket, $this-&gt;encoding);
        }
        return $this-&gt;createResponse($socket);
    }

    /**
     *    Sends the headers.
     *    @param SimpleSocket $socket           Open socket.
     *    @param string $method                 HTTP request method,
     *                                          usually GET.
     *    @param SimpleFormEncoding $encoding   Content to send with request.
     *    @access private
     */
    protected function dispatchRequest($socket, $encoding) {
        foreach ($this-&gt;headers as $header_line) {
            $socket-&gt;write($header_line . &quot;\r\n&quot;);
        }
        if (count($this-&gt;cookies) &gt; 0) {
            $socket-&gt;write(&quot;Cookie: &quot; . implode(&quot;;&quot;, $this-&gt;cookies) . &quot;\r\n&quot;);
        }
        $encoding-&gt;writeHeadersTo($socket);
        $socket-&gt;write(&quot;\r\n&quot;);
        $encoding-&gt;writeTo($socket);
    }

    /**
     *    Adds a header line to the request.
     *    @param string $header_line    Text of full header line.
     *    @access public
     */
    function addHeaderLine($header_line) {
        $this-&gt;headers[] = $header_line;
    }

    /**
     *    Reads all the relevant cookies from the
     *    cookie jar.
     *    @param SimpleCookieJar $jar     Jar to read
     *    @param SimpleUrl $url           Url to use for scope.
     *    @access public
     */
    function readCookiesFromJar($jar, $url) {
        $this-&gt;cookies = $jar-&gt;selectAsPairs($url);
    }

    /**
     *    Wraps the socket in a response parser.
     *    @param SimpleSocket $socket   Responding socket.
     *    @return SimpleHttpResponse    Parsed response object.
     *    @access protected
     */
    protected function createResponse($socket) {
        $response = new SimpleHttpResponse(
                $socket,
                $this-&gt;route-&gt;getUrl(),
                $this-&gt;encoding);
        $socket-&gt;close();
        return $response;
    }
}

/**
 *    Collection of header lines in the response.
 *    @package SimpleTest
 *    @subpackage WebTester
 */
class SimpleHttpHeaders {
    private $raw_headers;
    private $response_code;
    private $http_version;
    private $mime_type;
    private $location;
    private $cookies;
    private $authentication;
    private $realm;

    /**
     *    Parses the incoming header block.
     *    @param string $headers     Header block.
     *    @access public
     */
    function __construct($headers) {
        $this-&gt;raw_headers = $headers;
        $this-&gt;response_code = false;
        $this-&gt;http_version = false;
        $this-&gt;mime_type = &#x27;&#x27;;
        $this-&gt;location = false;
        $this-&gt;cookies = array();
        $this-&gt;authentication = false;
        $this-&gt;realm = false;
        foreach (explode(&quot;\r\n&quot;, $headers) as $header_line) {
            $this-&gt;parseHeaderLine($header_line);
        }
    }

    /**
     *    Accessor for parsed HTTP protocol version.
     *    @return integer           HTTP error code.
     *    @access public
     */
    function getHttpVersion() {
        return $this-&gt;http_version;
    }

    /**
     *    Accessor for raw header block.
     *    @return string        All headers as raw string.
     *    @access public
     */
    function getRaw() {
        return $this-&gt;raw_headers;
    }

    /**
     *    Accessor for parsed HTTP error code.
     *    @return integer           HTTP error code.
     *    @access public
     */
    function getResponseCode() {
        return (integer)$this-&gt;response_code;
    }

    /**
     *    Returns the redirected URL or false if
     *    no redirection.
     *    @return string      URL or false for none.
     *    @access public
     */
    function getLocation() {
        return $this-&gt;location;
    }

    /**
     *    Test to see if the response is a valid redirect.
     *    @return boolean       True if valid redirect.
     *    @access public
     */
    function isRedirect() {
        return in_array($this-&gt;response_code, array(301, 302, 303, 307)) &amp;&amp;
                (boolean)$this-&gt;getLocation();
    }

    /**
     *    Test to see if the response is an authentication
     *    challenge.
     *    @return boolean       True if challenge.
     *    @access public
     */
    function isChallenge() {
        return ($this-&gt;response_code == 401) &amp;&amp;
                (boolean)$this-&gt;authentication &amp;&amp;
                (boolean)$this-&gt;realm;
    }

    /**
     *    Accessor for MIME type header information.
     *    @return string           MIME type.
     *    @access public
     */
    function getMimeType() {
        return $this-&gt;mime_type;
    }

    /**
     *    Accessor for authentication type.
     *    @return string        Type.
     *    @access public
     */
    function getAuthentication() {
        return $this-&gt;authentication;
    }

    /**
     *    Accessor for security realm.
     *    @return string        Realm.
     *    @access public
     */
    function getRealm() {
        return $this-&gt;realm;
    }

    /**
     *    Writes new cookies to the cookie jar.
     *    @param SimpleCookieJar $jar   Jar to write to.
     *    @param SimpleUrl $url         Host and path to write under.
     *    @access public
     */
    function writeCookiesToJar($jar, $url) {
        foreach ($this-&gt;cookies as $cookie) {
            $jar-&gt;setCookie(
                    $cookie-&gt;getName(),
                    $cookie-&gt;getValue(),
                    $url-&gt;getHost(),
                    $cookie-&gt;getPath(),
                    $cookie-&gt;getExpiry());
        }
    }

    /**
     *    Called on each header line to accumulate the held
     *    data within the class.
     *    @param string $header_line        One line of header.
     *    @access protected
     */
    protected function parseHeaderLine($header_line) {
        if (preg_match(&#x27;/HTTP\/(\d+\.\d+)\s+(\d+)/i&#x27;, $header_line, $matches)) {
            $this-&gt;http_version = $matches[1];
            $this-&gt;response_code = $matches[2];
        }
        if (preg_match(&#x27;/Content-type:\s*(.*)/i&#x27;, $header_line, $matches)) {
            $this-&gt;mime_type = trim($matches[1]);
        }
        if (preg_match(&#x27;/Location:\s*(.*)/i&#x27;, $header_line, $matches)) {
            $this-&gt;location = trim($matches[1]);
        }
        if (preg_match(&#x27;/Set-cookie:(.*)/i&#x27;, $header_line, $matches)) {
            $this-&gt;cookies[] = $this-&gt;parseCookie($matches[1]);
        }
        if (preg_match(&#x27;/WWW-Authenticate:\s+(\S+)\s+realm=\&quot;(.*?)\&quot;/i&#x27;, $header_line, $matches)) {
            $this-&gt;authentication = $matches[1];
            $this-&gt;realm = trim($matches[2]);
        }
    }

    /**
     *    Parse the Set-cookie content.
     *    @param string $cookie_line    Text after &quot;Set-cookie:&quot;
     *    @return SimpleCookie          New cookie object.
     *    @access private
     */
    protected function parseCookie($cookie_line) {
        $parts = explode(&quot;;&quot;, $cookie_line);
        $cookie = array();
        preg_match(&#x27;/\s*(.*?)\s*=(.*)/&#x27;, array_shift($parts), $cookie);
        foreach ($parts as $part) {
            if (preg_match(&#x27;/\s*(.*?)\s*=(.*)/&#x27;, $part, $matches)) {
                $cookie[$matches[1]] = trim($matches[2]);
            }
        }
        return new SimpleCookie(
                $cookie[1],
                trim($cookie[2]),
                isset($cookie[&quot;path&quot;]) ? $cookie[&quot;path&quot;] : &quot;&quot;,
                isset($cookie[&quot;expires&quot;]) ? $cookie[&quot;expires&quot;] : false);
    }
}

/**
 *    Basic HTTP response.
 *    @package SimpleTest
 *    @subpackage WebTester
 */
class SimpleHttpResponse extends SimpleStickyError {
    private $url;
    private $encoding;
    private $sent;
    private $content;
    private $headers;

    /**
     *    Constructor. Reads and parses the incoming
     *    content and headers.
     *    @param SimpleSocket $socket   Network connection to fetch
     *                                  response text from.
     *    @param SimpleUrl $url         Resource name.
     *    @param mixed $encoding        Record of content sent.
     *    @access public
     */
    function __construct($socket, $url, $encoding) {
        parent::__construct();
        $this-&gt;url = $url;
        $this-&gt;encoding = $encoding;
        $this-&gt;sent = $socket-&gt;getSent();
        $this-&gt;content = false;
        $raw = $this-&gt;readAll($socket);
        if ($socket-&gt;isError()) {
            $this-&gt;setError(&#x27;Error reading socket [&#x27; . $socket-&gt;getError() . &#x27;]&#x27;);
            return;
        }
        $this-&gt;parse($raw);
    }

    /**
     *    Splits up the headers and the rest of the content.
     *    @param string $raw    Content to parse.
     *    @access private
     */
    protected function parse($raw) {
        if (! $raw) {
            $this-&gt;setError(&#x27;Nothing fetched&#x27;);
            $this-&gt;headers = new SimpleHttpHeaders(&#x27;&#x27;);
        } elseif (&#x27;file&#x27; == $this-&gt;url-&gt;getScheme()) {
            $this-&gt;headers = new SimpleHttpHeaders(&#x27;&#x27;);
            $this-&gt;content = $raw;
        } elseif (! strstr($raw, &quot;\r\n\r\n&quot;)) {
            $this-&gt;setError(&#x27;Could not split headers from content&#x27;);
            $this-&gt;headers = new SimpleHttpHeaders($raw);
        } else {
            list($headers, $this-&gt;content) = explode(&quot;\r\n\r\n&quot;, $raw, 2);
            $this-&gt;headers = new SimpleHttpHeaders($headers);
        }
    }

    /**
     *    Original request method.
     *    @return string        GET, POST or HEAD.
     *    @access public
     */
    function getMethod() {
        return $this-&gt;encoding-&gt;getMethod();
    }

    /**
     *    Resource name.
     *    @return SimpleUrl        Current url.
     *    @access public
     */
    function getUrl() {
        return $this-&gt;url;
    }

    /**
     *    Original request data.
     *    @return mixed              Sent content.
     *    @access public
     */
    function getRequestData() {
        return $this-&gt;encoding;
    }

    /**
     *    Raw request that was sent down the wire.
     *    @return string        Bytes actually sent.
     *    @access public
     */
    function getSent() {
        return $this-&gt;sent;
    }

    /**
     *    Accessor for the content after the last
     *    header line.
     *    @return string           All content.
     *    @access public
     */
    function getContent() {
        return $this-&gt;content;
    }

    /**
     *    Accessor for header block. The response is the
     *    combination of this and the content.
     *    @return SimpleHeaders        Wrapped header block.
     *    @access public
     */
    function getHeaders() {
        return $this-&gt;headers;
    }

    /**
     *    Accessor for any new cookies.
     *    @return array       List of new cookies.
     *    @access public
     */
    function getNewCookies() {
        return $this-&gt;headers-&gt;getNewCookies();
    }

    /**
     *    Reads the whole of the socket output into a
     *    single string.
     *    @param SimpleSocket $socket  Unread socket.
     *    @return string               Raw output if successful
     *                                 else false.
     *    @access private
     */
    protected function readAll($socket) {
        $all = &#x27;&#x27;;
        while (! $this-&gt;isLastPacket($next = $socket-&gt;read())) {
            $all .= $next;
        }
        return $all;
    }

    /**
     *    Test to see if the packet from the socket is the
     *    last one.
     *    @param string $packet    Chunk to interpret.
     *    @return boolean          True if empty or EOF.
     *    @access private
     */
    protected function isLastPacket($packet) {
        if (is_string($packet)) {
            return $packet === &#x27;&#x27;;
        }
        return ! $packet;
    }
}
?&gt;
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
