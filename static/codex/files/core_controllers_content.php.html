<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core/controllers/content.php - wp-flawless</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://a3d72a45d111006ec192-ec5b80a12b0b09b4d52373336afb4254.r80.cf1.rackcdn.com/usability-dynamics.png" title="wp-flawless"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/API.html">API</a></li>
            
                <li><a href="../classes/Carrington.html">Carrington</a></li>
            
                <li><a href="../classes/Extended_Taxonomies.html">Extended_Taxonomies</a></li>
            
                <li><a href="../classes/Flawless.API.html">Flawless.API</a></li>
            
                <li><a href="../classes/Flawless.Asset.html">Flawless.Asset</a></li>
            
                <li><a href="../classes/Flawless.Branded_Login.html">Flawless.Branded_Login</a></li>
            
                <li><a href="../classes/Flawless.BuddyPress.html">Flawless.BuddyPress</a></li>
            
                <li><a href="../classes/Flawless.Content.html">Flawless.Content</a></li>
            
                <li><a href="../classes/Flawless.Element.html">Flawless.Element</a></li>
            
                <li><a href="../classes/Flawless.Flawless\Shortcode.html">Flawless.Flawless\Shortcode</a></li>
            
                <li><a href="../classes/Flawless.Management.html">Flawless.Management</a></li>
            
                <li><a href="../classes/Flawless.Mobile.html">Flawless.Mobile</a></li>
            
                <li><a href="../classes/Flawless.Navbars.html">Flawless.Navbars</a></li>
            
                <li><a href="../classes/Flawless.Schema.html">Flawless.Schema</a></li>
            
                <li><a href="../classes/Flawless.Settings.html">Flawless.Settings</a></li>
            
                <li><a href="../classes/Flawless.Styles.html">Flawless.Styles</a></li>
            
                <li><a href="../classes/Flawless.Utility.html">Flawless.Utility</a></li>
            
                <li><a href="../classes/Flawless.Widget.html">Flawless.Widget</a></li>
            
                <li><a href="../classes/flawless_wpp_extensions.html">flawless_wpp_extensions</a></li>
            
                <li><a href="../classes/Legacy.html">Legacy</a></li>
            
                <li><a href="../classes/License.html">License</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/Log.html">Log</a></li>
            
                <li><a href="../classes/Maintenance.html">Maintenance</a></li>
            
                <li><a href="../classes/Models.html">Models</a></li>
            
                <li><a href="../classes/Module.html">Module</a></li>
            
                <li><a href="../classes/Multisite.html">Multisite</a></li>
            
                <li><a href="../classes/SaaS.html">SaaS</a></li>
            
                <li><a href="../classes/Shortcode.html">Shortcode</a></li>
            
                <li><a href="../classes/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../classes/Template Methods.html">Template Methods</a></li>
            
                <li><a href="../classes/Theme.html">Theme</a></li>
            
                <li><a href="../classes/UI.html">UI</a></li>
            
                <li><a href="../classes/Utility.html">Utility</a></li>
            
                <li><a href="../classes/Views.html">Views</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/API.html">API</a></li>
            
                <li><a href="../modules/Branded Login.html">Branded Login</a></li>
            
                <li><a href="../modules/Carrington.html">Carrington</a></li>
            
                <li><a href="../modules/Carrington Build.html">Carrington Build</a></li>
            
                <li><a href="../modules/carrington-build.html">carrington-build</a></li>
            
                <li><a href="../modules/cfct_build.html">cfct_build</a></li>
            
                <li><a href="../modules/default.html">default</a></li>
            
                <li><a href="../modules/Flawless.html">Flawless</a></li>
            
                <li><a href="../modules/Loader.html">Loader</a></li>
            
                <li><a href="../modules/Log.html">Log</a></li>
            
                <li><a href="../modules/Maintenence.html">Maintenence</a></li>
            
                <li><a href="../modules/Management.html">Management</a></li>
            
                <li><a href="../modules/Multisite.html">Multisite</a></li>
            
                <li><a href="../modules/SaaS.html">SaaS</a></li>
            
                <li><a href="../modules/Services_JSON.html">Services_JSON</a></li>
            
                <li><a href="../modules/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../modules/taxonomy-landing

This file is part of Taxonomy Landing for WordPress
http:__github.com_crowdfavorite_wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http:__crowdfavorite.com

Released under the GPL license
http:__www.opensource.org_licenses_gpl-license.php

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************.html">taxonomy-landing

This file is part of Taxonomy Landing for WordPress
http://github.com/crowdfavorite/wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http://crowdfavorite.com

Released under the GPL license
http://www.opensource.org/licenses/gpl-license.php

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************</a></li>
            
                <li><a href="../modules/taxonomy-landing

This file is part of Taxonomy Landing for WordPress
https:__github.com_crowdfavorite_wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http:__crowdfavorite.com

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************.html">taxonomy-landing

This file is part of Taxonomy Landing for WordPress
https://github.com/crowdfavorite/wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http://crowdfavorite.com

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************</a></li>
            
                <li><a href="../modules/Theme UI.html">Theme UI</a></li>
            
                <li><a href="../modules/UI.html">UI</a></li>
            
                <li><a href="../modules/UsabilityDynamics.html">UsabilityDynamics</a></li>
            
                <li><a href="../modules/Utility.html">Utility</a></li>
            
                <li><a href="../modules/Views.html">Views</a></li>
            
                <li><a href="../modules/WP-Property.html">WP-Property</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: core/controllers/content.php</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&lt;?php
/**
 * Flawless
 *
 * @author potanin@UD
 * @version 0.0.1
 * @namespace Flawless
 */
namespace Flawless {

  /**
   * Content Type Management
   *
   * @author potanin@UD
   * @version 0.1.0
   * @class Content
   */
  class Content {

    /**
     * Content Class version.
     *
     * @property $version
     * @type {Object}
     */
    public static $version = &#x27;0.1.1&#x27;;

    /**
     * Constructor for the Content class.
     *
     * @author potanin@UD
     * @version 0.0.1
     * @method __construct
     *
     * @constructor
     * @for Content
     *
     * @param array 
     */
    public function __construct( $options = array() ) {
      add_filter( &#x27;flawless::init_upper&#x27;, array( $this, &#x27;setup_content_types&#x27; ) );
      add_filter( &#x27;flawless::template_redirect&#x27;, array( $this, &#x27;template_redirect&#x27; ) );
    }

    /**
     * Return the allowed pages that $pagenow global is allowed to be.
     *
     */
    public function changeable_post_type( $post_type = false ) {
      global $post, $flawless;

      $post_type = $post_type ? $post_type : $post-&gt;post_type;

      if ( !$post_type ) {
        return false;
      }

      $changeable_post_types = (array) apply_filters( &#x27;flawless::changeable_post_types&#x27;, array_keys( (array) $flawless[ &#x27;post_types&#x27; ] ) );

      if ( in_array( $post_type, $changeable_post_types ) ) {
        return true;
      }

      return false;
    }

    /**
     * Primary function for handling front-end actions
     *
     * @method template_redirect
     * @for Content
     */
    static function template_redirect( &amp;$flawless ) {
      global $post;

      if ( get_post_meta( $post-&gt;ID, &#x27;must_be_logged_in&#x27;, true ) == &#x27;true&#x27; &amp;&amp; !is_user_logged_in() ) {
        die( wp_redirect( home_url() ) );
      }

    }

    /**
     * Setup theme features using the WordPress API as much as possible.
     *
     * This function must run after all the post types are created and initialized to have effect.
     *
     * This function may be called more than once at different action levels ( ALs ) since taxonomy and post types may be added by plugins,
     * yet we want the admin to have full control over all the post types and taxonomies in one UI.
     *
     * @todo Need to update all labels for taxonomoies. - potanin@UD
     *
     * @method setup_content_types
     * @for Content
     *
     * @action init (0)
     * @since 0.0.2
     */
    static function setup_content_types( &amp;$flawless ) {
      global $wp_post_types, $wp_taxonomies;

      Log::add( &#x27;Executed: Flawless::setup_content_types();&#x27; );

      do_action( &#x27;flawless::content_types&#x27;, $flawless );

      //** May only be necessary temporarily since Attachments were included in version 0.0.6 by accident */
      unset( $flawless[ &#x27;post_types&#x27; ][ &#x27;attachment&#x27; ] );

      //** Create any new post types that are in our settings array, but not in the global $wp_post_types variable*/
      foreach ( (array) $flawless[ &#x27;post_types&#x27; ] as $type =&gt; $data ) {

        if ( $data[ &#x27;flawless_post_type&#x27; ] != &#x27;true&#x27; ) {
          continue;
        }

        Log::add( sprintf( __( &#x27;Adding custom post type: %1s&#x27;, &#x27;flawless&#x27; ), $type ) );

        $post_type_settings = array(
          &#x27;label&#x27; =&gt; $data[ &#x27;name&#x27; ],
          &#x27;menu_position&#x27; =&gt; ( $data[ &#x27;hierarchical&#x27; ] == &quot;true&quot; ? 21 : 6 ),
          &#x27;public&#x27; =&gt; true,
          &#x27;exclude_from_search&#x27; =&gt; $data[ &#x27;exclude_from_search&#x27; ],
          &#x27;hierarchical&#x27; =&gt; $data[ &#x27;hierarchical&#x27; ],
          &#x27;has_archive&#x27; =&gt; is_numeric( $data[ &#x27;root_page&#x27; ] ) &amp;&amp; $data[ &#x27;root_page&#x27; ] &gt; 0 ? false : true,
          &#x27;supports&#x27; =&gt; array( &#x27;title&#x27;, &#x27;editor&#x27;, &#x27;thumbnail&#x27;, &#x27;excerpt&#x27;, &#x27;comments&#x27;, &#x27;revisions&#x27;, &#x27;post-formats&#x27;, &#x27;author&#x27; ),
        );

        if ( !empty( $data[ &#x27;rewrite_slug&#x27; ] ) ) {
          $post_type_settings[ &#x27;rewrite&#x27; ] = array(
            &#x27;slug&#x27; =&gt; $data[ &#x27;rewrite_slug&#x27; ],
            &#x27;with_front&#x27; =&gt; true
          );
        }

        //** &#x27;has_archive&#x27; allows post_type entries list korotkov@ud */
        register_post_type( $type, $post_type_settings );

        do_action( &#x27;flawless_content_type_added&#x27;, array( &#x27;type&#x27; =&gt; $type, &#x27;data&#x27; =&gt; $data ) );

      }

      //** Create any Flawless taxonomoies an create them, or update existing ones with custom settings  */
      foreach ( (array) $flawless[ &#x27;taxonomies&#x27; ] as $type =&gt; $data ) {
        if ( $data[ &#x27;flawless_taxonomy&#x27; ] == &#x27;true&#x27; ) {

          Log::add( sprintf( __( &#x27;Adding custom flawless_taxonomy: %1s&#x27;, &#x27;flawless&#x27; ), $type ) );

          $flawless[ &#x27;taxonomies&#x27; ][ $type ][ &#x27;rewrite_tag&#x27; ] = &#x27;%&#x27; . $type . &#x27;%&#x27;;

          if ( !taxonomy_exists( $type ) ) {

            $taxonomy_settings = array(
              &#x27;label&#x27; =&gt; $data[ &#x27;label&#x27; ],
              &#x27;exclude_from_search&#x27; =&gt; $data[ &#x27;exclude_from_search&#x27; ],
              &#x27;hierarchical&#x27; =&gt; $data[ &#x27;hierarchical&#x27; ]
            );

            $taxonomy_settings[ &#x27;rewrite&#x27; ] = array(
              &#x27;slug&#x27; =&gt; $data[ &#x27;rewrite_slug&#x27; ] ? $data[ &#x27;rewrite_slug&#x27; ] : $type,
              &#x27;with_front&#x27; =&gt; true
            );

            register_taxonomy( $type, &#x27;&#x27;, $taxonomy_settings );
          }

          add_rewrite_tag( $flawless[ &#x27;taxonomies&#x27; ][ &#x27;rewrite_tag&#x27; ], &#x27;([^/]+)&#x27; );

          do_action( &#x27;flawless_content_type_added&#x27;, array( &#x27;type&#x27; =&gt; $type, &#x27;data&#x27; =&gt; $data ) );

        }

        //** Check to see if a taxonomy has disappeared ( i.e. plugin deactivated that was adding it ) */
        if ( !in_array( $type, array_keys( $wp_taxonomies ) ) ) {
          unset( $flawless[ &#x27;taxonomies&#x27; ][ $type ] );
        }

        $data = apply_filters( &#x27;flawless::generate_taxonomies&#x27;, $data, $type );

        //** Save our custom settings to global taxononmy object */
        $wp_taxonomies[ $type ]-&gt;hierarchical = $data[ &#x27;hierarchical&#x27; ] == &#x27;true&#x27; ? true : false;
        $wp_taxonomies[ $type ]-&gt;exclude_from_search = $data[ &#x27;exclude_from_search&#x27; ] == &#x27;true&#x27; ? true : false;
        //$wp_taxonomies[ $type ]-&gt;show_tagcloud = $data[ &#x27;show_tagcloud&#x27; ] == &#x27;true&#x27; ? true : false;

        $wp_taxonomies[ $type ]-&gt;label = $data[ &#x27;label&#x27; ] ? $data[ &#x27;label&#x27; ] : $wp_taxonomies[ $type ]-&gt;label;

        //** Automatically try to get singular form if not set ( experimental ) */
        $wp_taxonomies[ $type ]-&gt;labels-&gt;singular_name = $data[ &#x27;singular_label&#x27; ] ? $data[ &#x27;singular_label&#x27; ] : self::depluralize( $data[ &#x27;label&#x27; ] );
        $wp_taxonomies[ $type ]-&gt;labels-&gt;name = $data[ &#x27;label&#x27; ] ? $data[ &#x27;label&#x27; ] : $wp_taxonomies[ $type ]-&gt;label;

        //** Set singular labels */
        $wp_taxonomies[ $type ]-&gt;labels-&gt;add_new_item = sprintf( __( &#x27;New %1s&#x27;, &#x27;flawless&#x27; ), $wp_taxonomies[ $type ]-&gt;labels-&gt;singular_name );
        $wp_taxonomies[ $type ]-&gt;labels-&gt;new_item = sprintf( __( &#x27;New %1s&#x27;, &#x27;flawless&#x27; ), $wp_taxonomies[ $type ]-&gt;labels-&gt;singular_name );
        $wp_taxonomies[ $type ]-&gt;labels-&gt;edit_item = sprintf( __( &#x27;Edit %1s&#x27;, &#x27;flawless&#x27; ), $wp_taxonomies[ $type ]-&gt;labels-&gt;singular_name );
        $wp_taxonomies[ $type ]-&gt;labels-&gt;update_item = sprintf( __( &#x27;Update %1s&#x27;, &#x27;flawless&#x27; ), $wp_taxonomies[ $type ]-&gt;labels-&gt;singular_name );
        $wp_taxonomies[ $type ]-&gt;labels-&gt;view_item = sprintf( __( &#x27;No %1s found.&#x27;, &#x27;flawless&#x27; ), $wp_taxonomies[ $type ]-&gt;labels-&gt;singular_name );
        $wp_taxonomies[ $type ]-&gt;labels-&gt;new_item_name = sprintf( __( &#x27;New %1s Name.&#x27;, &#x27;flawless&#x27; ), $wp_taxonomies[ $type ]-&gt;labels-&gt;singular_name );
        $wp_taxonomies[ $type ]-&gt;labels-&gt;not_found = sprintf( __( &#x27;Add New %1s&#x27;, &#x27;flawless&#x27; ), $wp_taxonomies[ $type ]-&gt;labels-&gt;singular_name );
        $wp_taxonomies[ $type ]-&gt;labels-&gt;not_found_in_trash = sprintf( __( &#x27;Add New %1s&#x27;, &#x27;flawless&#x27; ), $wp_taxonomies[ $type ]-&gt;labels-&gt;singular_name );

        //** Plural Labels */
        $wp_taxonomies[ $type ]-&gt;labels-&gt;search_items = sprintf( __( &#x27;Search %1s&#x27;, &#x27;flawless&#x27; ), $wp_taxonomies[ $type ]-&gt;labels-&gt;name );
        $wp_taxonomies[ $type ]-&gt;labels-&gt;not_found_in_trash = sprintf( __( &#x27;No %1s found in trash.&#x27;, &#x27;flawless&#x27; ), $wp_taxonomies[ $type ]-&gt;labels-&gt;name );
        $wp_taxonomies[ $type ]-&gt;labels-&gt;popular_items = sprintf( __( &#x27;Popular %1s&#x27;, &#x27;flawless&#x27; ), $wp_taxonomies[ $type ]-&gt;labels-&gt;name );
        $wp_taxonomies[ $type ]-&gt;labels-&gt;add_or_remove_items = sprintf( __( &#x27;Add ore remove %1s&#x27;, &#x27;flawless&#x27; ), $wp_taxonomies[ $type ]-&gt;labels-&gt;name );
        $wp_taxonomies[ $type ]-&gt;labels-&gt;choose_from_most_used = sprintf( __( &#x27;Choose from most used %1s&#x27;, &#x27;flawless&#x27; ), $wp_taxonomies[ $type ]-&gt;labels-&gt;name );
        $wp_taxonomies[ $type ]-&gt;labels-&gt;all_items = sprintf( __( &#x27;All %1s&#x27;, &#x27;flawless&#x27; ), $wp_taxonomies[ $type ]-&gt;labels-&gt;name );
        $wp_taxonomies[ $type ]-&gt;labels-&gt;menu_name = $wp_taxonomies[ $type ]-&gt;labels-&gt;name;

      }

      //** Cycle through all existing taxonomies, and load their settings into FS settings */
      foreach ( (array) $wp_taxonomies as $type =&gt; $data ) {

        //** We do not do anything with non displayed taxononomies */
        if ( !$data-&gt;show_ui ) {
          continue;
        }

        if ( $flawless[ &#x27;taxonomies&#x27; ][ $type ][ &#x27;flawless_taxonomy&#x27; ] == &#x27;true&#x27; ) {
          $flawless[ &#x27;taxonomies&#x27; ][ $type ][ &#x27;rewrite_slug&#x27; ] = $data-&gt;rewrite[ &#x27;slug&#x27; ];
        }

        $flawless[ &#x27;taxonomies&#x27; ][ $type ][ &#x27;label&#x27; ] = $wp_taxonomies[ $type ]-&gt;labels-&gt;name;
        $flawless[ &#x27;taxonomies&#x27; ][ $type ][ &#x27;label&#x27; ] = $wp_taxonomies[ $type ]-&gt;labels-&gt;name;
        $flawless[ &#x27;taxonomies&#x27; ][ $type ][ &#x27;hierarchical&#x27; ] = $wp_taxonomies[ $type ]-&gt;hierarchical ? &#x27;true&#x27; : &#x27;false&#x27;;
        $flawless[ &#x27;taxonomies&#x27; ][ $type ][ &#x27;exclude_from_search&#x27; ] = $wp_taxonomies[ $type ]-&gt;exclude_from_search ? &#x27;true&#x27; : &#x27;false&#x27;;
        //$flawless[ &#x27;taxonomies&#x27; ][ $type ][ &#x27;show_tagcloud&#x27; ] = $wp_taxonomies[ $type ]-&gt;show_tagcloud ? &#x27;true&#x27; : &#x27;false&#x27;;

        do_action( &#x27;flawless::setup_taxonomy::&#x27; . $type, $data );
        do_action( &#x27;flawless::setup_taxonomy&#x27;, $type, $data );

      }

      //** Loop through post types and update the $flawless array */
      foreach ( (array) $wp_post_types as $type =&gt; $data ) {

        //** We don&#x27;t do anything with any post types that are not displayed */
        if ( !$data-&gt;public || !$data-&gt;show_ui ) {
          continue;
        }

        $defaults = get_object_taxonomies( $type );

        //** Configure special settings if they are set, or use default settings */
        $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;name&#x27; ] = ( isset( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;name&#x27; ] ) ? $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;name&#x27; ] : $data-&gt;labels-&gt;name );
        $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;hierarchical&#x27; ] = ( isset( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;hierarchical&#x27; ] ) ? $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;hierarchical&#x27; ] : ( $data-&gt;hierarchical ? &#x27;true&#x27; : false ) );

        //** Cycle through all available taxonomies and add them back to post type. */
        foreach ( (array) $flawless[ &#x27;taxonomies&#x27; ] as $tax =&gt; $tax_data ) {

          $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;taxonomies&#x27; ][ $tax ] = ( isset( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;taxonomies&#x27; ][ $tax ] ) ? $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;taxonomies&#x27; ][ $tax ] : ( in_array( $tax, $defaults ) ? &#x27;enabled&#x27; : &#x27;&#x27; ) );

          if ( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;taxonomies&#x27; ][ $tax ] == &#x27;enabled&#x27; ) {
            register_taxonomy_for_object_type( $tax, $type );
          }

          //** Remove blank values added as placeholders when FL taxonomies are initially registered */
          $wp_taxonomies[ $tax ]-&gt;object_type = array_filter( $wp_taxonomies[ $tax ]-&gt;object_type );
        }

        $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;rewrite_slug&#x27; ] = $data-&gt;rewrite[ &#x27;slug&#x27; ];

        @ksort( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;taxonomies&#x27; ] );

        if ( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;hierarchical&#x27; ] == &#x27;true&#x27; ) {
          $wp_post_types[ $type ]-&gt;hierarchical = true;
          add_post_type_support( $type, &#x27;page-attributes&#x27; );
        }

        if ( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;disable_comments&#x27; ] == &#x27;true&#x27; ) {
          remove_post_type_support( $type, &#x27;comments&#x27; );
        }

        if ( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;custom_fields&#x27; ] != &#x27;true&#x27; ) {
          remove_post_type_support( $type, &#x27;custom-fields&#x27; );
        }

        if ( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;disable_author&#x27; ] == &#x27;true&#x27; ) {
          remove_post_type_support( $type, &#x27;author&#x27; );
        }

        if ( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;exclude_from_search&#x27; ] == &#x27;true&#x27; ) {
          $wp_post_types[ $type ]-&gt;exclude_from_search = true;
        }

        //** Rename post types. Do special stuff for post and page since they are built in, and Menu is hardcoded for some reason. */
        if ( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;name&#x27; ] != $data-&gt;labels-&gt;name || $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;flawless_post_type&#x27; ] == &#x27;true&#x27; ) {

          if ( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;name&#x27; ] != $data-&gt;labels-&gt;name ) {
            Log::add( sprintf( __( &#x27;Changing labels for post type: %1s, from %2s to %3s&#x27;, &#x27;flawless&#x27; ), $type, $data-&gt;labels-&gt;name, $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;name&#x27; ] ) );
          }

          $original_labels = ( !empty( $wp_post_types[ $type ]-&gt;labels ) ? (array) $wp_post_types[ $type ]-&gt;labels : array() );

          //** Update Post Type Labels */
          if ( empty( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;singular_name&#x27; ] ) ) {
            $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;singular_name&#x27; ] = self::depluralize( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;name&#x27; ] );
          }

          $wp_post_types[ $type ]-&gt;labels = ( object ) array_merge( $original_labels, array(
            &#x27;name&#x27; =&gt; $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;name&#x27; ], /* plural */
            &#x27;singular_name&#x27; =&gt; ucfirst( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;singular_name&#x27; ] ),
            &#x27;add_new_item&#x27; =&gt; sprintf( __( &#x27;Add New %1s&#x27;, &#x27;flawless&#x27; ), $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;singular_name&#x27; ] ),
            &#x27;new_item&#x27; =&gt; sprintf( __( &#x27;New %1s&#x27;, &#x27;flawless&#x27; ), $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;singular_name&#x27; ] ),
            &#x27;edit_item&#x27; =&gt; sprintf( __( &#x27;Edit %1s&#x27;, &#x27;flawless&#x27; ), ucfirst( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;singular_name&#x27; ] ) ),
            &#x27;search_items&#x27; =&gt; sprintf( __( &#x27;Search %1s&#x27;, &#x27;flawless&#x27; ), $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;name&#x27; ] ),
            &#x27;view_item&#x27; =&gt; sprintf( __( &#x27;View %1s&#x27;, &#x27;flawless&#x27; ), $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;singular_name&#x27; ] ),
            &#x27;search_items&#x27; =&gt; sprintf( __( &#x27;Search %1s&#x27;, &#x27;flawless&#x27; ), $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;name&#x27; ] ),
            &#x27;not_found&#x27; =&gt; sprintf( __( &#x27;No %1s found.&#x27;, &#x27;flawless&#x27; ), strtolower( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;singular_name&#x27; ] ) ),
            &#x27;not_found_in_trash&#x27; =&gt; sprintf( __( &#x27;No %1s found in trash.&#x27;, &#x27;flawless&#x27; ), strtolower( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;name&#x27; ] ) )
          ) );

          switch ( $type ) {
            case &#x27;post&#x27;:
              add_action( &#x27;admin_menu&#x27;, create_function( &#x27;&#x27;, &#x27; global $menu, $submenu, $flawless; $menu[5][0] = $flawless[&quot;post_types&quot;][&quot;post&quot;][&quot;name&quot;]; $submenu[&quot;edit.php&quot;][5][0] = &quot;All &quot; . $flawless[&quot;post_types&quot;][&quot;post&quot;][&quot;name&quot;];  &#x27; ) );
              break;
            case &#x27;page&#x27;:
              add_action( &#x27;admin_menu&#x27;, create_function( &#x27;&#x27;, &#x27; global $menu, $submenu, $flawless; $menu[20][0] = $flawless[&quot;post_types&quot;][&quot;page&quot;][&quot;name&quot;]; $submenu[&quot;edit.php?post_type=page&quot;][5][0] = &quot;All &quot; . $flawless[&quot;post_types&quot;][&quot;page&quot;][&quot;name&quot;];  &#x27; ) );
              break;
          }

        }

        //** If this post type can have an archive, we determine the URL */
        //** @todo This nees work, we are guessing that the permalink will be top level, need to check other factors */
        if ( $wp_post_types[ $type ]-&gt;has_archive ) {

          add_filter( &#x27;nav_menu_items_&#x27; . $type, array( __SELF__, &#x27;add_archive_checkbox&#x27; ), null, 3 );

          $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;archive_url&#x27; ] = get_bloginfo( &#x27;url&#x27; ) . &#x27;/&#x27; . $type . &#x27;/&#x27;;

        }

        //** Disable post type, and do work-around for built-in types since they are hardcoded into menu.*/
        if ( $flawless[ &#x27;post_types&#x27; ][ $type ][ &#x27;disabled&#x27; ] == &#x27;true&#x27; ) {
          switch ( $type ) {
            case &#x27;post&#x27;:
              add_action( &#x27;admin_menu&#x27;, create_function( &#x27;&#x27;, &#x27;global $menu; unset( $menu[5] );&#x27; ) );
              break;
            case &#x27;page&#x27;:
              add_action( &#x27;admin_menu&#x27;, create_function( &#x27;&#x27;, &#x27;global $menu; unset( $menu[20] );&#x27; ) );
              break;
          }
          unset( $wp_post_types[ $type ] );
        }

      }

    }

    /**
     * {need description}
     *
     *
     * @since 0.0.2
     *
     */
    static function add_archive_checkbox( $posts, $args, $post_type ) {
      global $_nav_menu_placeholder, $wp_rewrite, $flawless;

      $_nav_menu_placeholder = ( 0 &gt; $_nav_menu_placeholder ) ? intval( $_nav_menu_placeholder ) - 1 : -1;

      $archive_slug = $post_type[ &#x27;args&#x27; ]-&gt;has_archive === true ? $post_type[ &#x27;args&#x27; ]-&gt;rewrite[ &#x27;slug&#x27; ] : $post_type[ &#x27;args&#x27; ]-&gt;has_archive;

      if ( $post_type[ &#x27;args&#x27; ]-&gt;rewrite[ &#x27;with_front&#x27; ] ) {
        $archive_slug = substr( $wp_rewrite-&gt;front, 1 ) . $archive_slug;
      } else {
        $archive_slug = $wp_rewrite-&gt;root . $archive_slug;
      }

      array_unshift( $posts, ( object ) array(
        &#x27;ID&#x27; =&gt; 0,
        &#x27;_add_to_top&#x27; =&gt; true,
        &#x27;object_id&#x27; =&gt; $_nav_menu_placeholder,
        &#x27;post_content&#x27; =&gt; &#x27;&#x27;,
        &#x27;post_excerpt&#x27; =&gt; &#x27;&#x27;,
        &#x27;custom_thing&#x27; =&gt; &#x27;hola&#x27;,
        &#x27;post_title&#x27; =&gt; sprintf( __( &#x27;%1s Archive Root&#x27;, &#x27;flawless&#x27; ), $post_type[ &#x27;args&#x27; ]-&gt;labels-&gt;all_items ),
        &#x27;post_type&#x27; =&gt; &#x27;nav_menu_item&#x27;,
        &#x27;type&#x27; =&gt; &#x27;custom&#x27;,
        &#x27;url&#x27; =&gt; site_url( $archive_slug ),
      ) );

      return $posts;

    }

  }

}
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
