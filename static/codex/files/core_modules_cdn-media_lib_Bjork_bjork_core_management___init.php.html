<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core/modules/cdn-media/lib/Bjork/bjork/core/management/__init.php - wp-flawless</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://a3d72a45d111006ec192-ec5b80a12b0b09b4d52373336afb4254.r80.cf1.rackcdn.com/usability-dynamics.png" title="wp-flawless"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/API.html">API</a></li>
            
                <li><a href="../classes/Carrington.html">Carrington</a></li>
            
                <li><a href="../classes/Extended_Taxonomies.html">Extended_Taxonomies</a></li>
            
                <li><a href="../classes/Flawless.API.html">Flawless.API</a></li>
            
                <li><a href="../classes/Flawless.Asset.html">Flawless.Asset</a></li>
            
                <li><a href="../classes/Flawless.Branded_Login.html">Flawless.Branded_Login</a></li>
            
                <li><a href="../classes/Flawless.BuddyPress.html">Flawless.BuddyPress</a></li>
            
                <li><a href="../classes/Flawless.Content.html">Flawless.Content</a></li>
            
                <li><a href="../classes/Flawless.Element.html">Flawless.Element</a></li>
            
                <li><a href="../classes/Flawless.Flawless\Shortcode.html">Flawless.Flawless\Shortcode</a></li>
            
                <li><a href="../classes/Flawless.Management.html">Flawless.Management</a></li>
            
                <li><a href="../classes/Flawless.Mobile.html">Flawless.Mobile</a></li>
            
                <li><a href="../classes/Flawless.Navbars.html">Flawless.Navbars</a></li>
            
                <li><a href="../classes/Flawless.Schema.html">Flawless.Schema</a></li>
            
                <li><a href="../classes/Flawless.Settings.html">Flawless.Settings</a></li>
            
                <li><a href="../classes/Flawless.Styles.html">Flawless.Styles</a></li>
            
                <li><a href="../classes/Flawless.Utility.html">Flawless.Utility</a></li>
            
                <li><a href="../classes/Flawless.Widget.html">Flawless.Widget</a></li>
            
                <li><a href="../classes/flawless_wpp_extensions.html">flawless_wpp_extensions</a></li>
            
                <li><a href="../classes/Legacy.html">Legacy</a></li>
            
                <li><a href="../classes/License.html">License</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/Log.html">Log</a></li>
            
                <li><a href="../classes/Maintenance.html">Maintenance</a></li>
            
                <li><a href="../classes/Models.html">Models</a></li>
            
                <li><a href="../classes/Module.html">Module</a></li>
            
                <li><a href="../classes/Multisite.html">Multisite</a></li>
            
                <li><a href="../classes/SaaS.html">SaaS</a></li>
            
                <li><a href="../classes/Shortcode.html">Shortcode</a></li>
            
                <li><a href="../classes/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../classes/Template Methods.html">Template Methods</a></li>
            
                <li><a href="../classes/Theme.html">Theme</a></li>
            
                <li><a href="../classes/UI.html">UI</a></li>
            
                <li><a href="../classes/Utility.html">Utility</a></li>
            
                <li><a href="../classes/Views.html">Views</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/API.html">API</a></li>
            
                <li><a href="../modules/Branded Login.html">Branded Login</a></li>
            
                <li><a href="../modules/Carrington.html">Carrington</a></li>
            
                <li><a href="../modules/Carrington Build.html">Carrington Build</a></li>
            
                <li><a href="../modules/carrington-build.html">carrington-build</a></li>
            
                <li><a href="../modules/cfct_build.html">cfct_build</a></li>
            
                <li><a href="../modules/default.html">default</a></li>
            
                <li><a href="../modules/Flawless.html">Flawless</a></li>
            
                <li><a href="../modules/Loader.html">Loader</a></li>
            
                <li><a href="../modules/Log.html">Log</a></li>
            
                <li><a href="../modules/Maintenence.html">Maintenence</a></li>
            
                <li><a href="../modules/Management.html">Management</a></li>
            
                <li><a href="../modules/Multisite.html">Multisite</a></li>
            
                <li><a href="../modules/SaaS.html">SaaS</a></li>
            
                <li><a href="../modules/Services_JSON.html">Services_JSON</a></li>
            
                <li><a href="../modules/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../modules/taxonomy-landing

This file is part of Taxonomy Landing for WordPress
http:__github.com_crowdfavorite_wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http:__crowdfavorite.com

Released under the GPL license
http:__www.opensource.org_licenses_gpl-license.php

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************.html">taxonomy-landing

This file is part of Taxonomy Landing for WordPress
http://github.com/crowdfavorite/wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http://crowdfavorite.com

Released under the GPL license
http://www.opensource.org/licenses/gpl-license.php

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************</a></li>
            
                <li><a href="../modules/taxonomy-landing

This file is part of Taxonomy Landing for WordPress
https:__github.com_crowdfavorite_wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http:__crowdfavorite.com

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************.html">taxonomy-landing

This file is part of Taxonomy Landing for WordPress
https://github.com/crowdfavorite/wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http://crowdfavorite.com

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************</a></li>
            
                <li><a href="../modules/Theme UI.html">Theme UI</a></li>
            
                <li><a href="../modules/UI.html">UI</a></li>
            
                <li><a href="../modules/UsabilityDynamics.html">UsabilityDynamics</a></li>
            
                <li><a href="../modules/Utility.html">Utility</a></li>
            
                <li><a href="../modules/Views.html">Views</a></li>
            
                <li><a href="../modules/WP-Property.html">WP-Property</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: core/modules/cdn-media/lib/Bjork/bjork/core/management/__init.php</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&lt;?php

namespace bjork\core {

use os\path;

use strutils;

use bjork,
    bjork\conf\settings,
    bjork\core\management\ImportError,
    bjork\core\management\ManagementUtility,
    bjork\core\management\base\CommandError,
    bjork\utils\importlib;

require_once &#x27;bjork/bjork.php&#x27;;

final class management {
    
    protected static $commands = null;
    
    public static function get_version() {
        return bjork::get_version();
    }
    
    /**
    * Given a path to a management directory, returns a list of all the command
    * names that are available.
    * 
    * Returns an empty list if no commands are defined.
    */
    public static function find_commands($management_dir) {
        $command_dir = $management_dir . DIRECTORY_SEPARATOR . &#x27;commands&#x27;;
        $commands = array();
        
        if ($handle = opendir($command_dir)) {
            try {
                while (false !== ($entry = readdir($handle))) {
                    if (is_file($command_dir . DIRECTORY_SEPARATOR . $entry)) {
                        if ($entry{0} != &#x27;_&#x27; &amp;&amp; substr($entry, -4) == &#x27;.php&#x27;)
                            $commands[] = substr($entry, 0, -4);
                    }
                }
                closedir($handle);
            } catch (\ErrorException $e) {
                closedir($handle);
                return array();
            }
        }
        
        return $commands;
    }
    
    /**
    * Determines the path to the management module for the given app_name,
    * without actually importing the application or the management module.
    * 
    * Raises ImportError if the management module cannot be found for any
    * reason.
    */
    public static function find_management_module($app_name) {
        $path = str_replace(&#x27;\\&#x27;, DIRECTORY_SEPARATOR, &quot;{$app_name}\management&quot;);
        $found_path = null;
        
        foreach (importlib::get_include_paths() as $dir) {
            $p = path::join($dir, $path);
            if (is_dir($p)) {
                $found_path = $p;
                break;
            }
        }
        
        if (!$found_path)
            throw new ImportError($path);
        return $found_path;
    }
    
    /**
    * Given a command name and an application name, returns the Command
    * class instance. All errors raised by the import process
    * (ImportError, AttributeError) are allowed to propagate.
    */
    public static function load_command_class($app_name, $name) {
        $command_file = str_replace(&#x27;\\&#x27;, DIRECTORY_SEPARATOR,
            &quot;{$app_name}\management\commands\\{$name}.php&quot;);
        $command_class = &quot;{$app_name}\management\commands\\{$name}\Command&quot;;
        try {
            require_once $command_file;
        } catch (\ErrorException $e) {
            throw new ImportError($command_class);
        }
        
        if (class_exists($command_class))
            return new $command_class();
        
        throw new ImportError($command_class);
    }
    
    /**
    * Returns a dictionary mapping command names to their callback
    * applications.
    * 
    * This works by looking for a management.commands package in django.core,
    * and in each installed application -- if a commands package exists, all
    * commands in that package are registered.
    * 
    * Core commands are always included. If a settings module has been
    * specified, user-defined commands will also be included.
    * 
    * The dictionary is in the format {command_name: app_name}. Key-value
    * pairs from this dictionary can then be used in calls to
    * load_command_class(app_name, command_name)
    * 
    * If a specific version of a command must be loaded (e.g., with the
    * startapp command), the instantiated module can be placed in the
    * dictionary in place of the application name.
    * 
    * The dictionary is cached on the first call and reused on subsequent
    * calls.
    */
    public static function get_commands() {
        if (null === self::$commands) {
            $commands = array();
            foreach (self::find_commands(__DIR__) as $name)
                $commands[$name] = &#x27;bjork\core&#x27;;
            
            try {
                $apps = settings::get(&#x27;INSTALLED_APPS&#x27;);
            } catch (\Exception $e) {
                $apps = array();
            }
            
            foreach ($apps as $app_name) {
                try {
                    $path = self::find_management_module($app_name);
                    $c = array();
                    foreach (self::find_commands($path) as $name)
                        $c[$name] = $app_name;
                    $commands = array_merge($commands, $c);
                } catch (ImportError $e) {
                    // pass -- no management module
                }
            }
            
            self::$commands = $commands;
        }
        
        return self::$commands;
    }
    
    /**
    * Calls the given command, with the given options and args/kwargs.
    *
    * This is the primary API you should use for calling specific commands.
    *
    * Some examples:
    *     call_command(&#x27;syncdb&#x27;)
    *     call_command(&#x27;shell&#x27;, plain=True)
    *     call_command(&#x27;sqlall&#x27;, &#x27;myapp&#x27;)
    */
    public static function call_command($name, array $args=null, array $options=null) {
        if (null === $args) $args = array();
        if (null === $options) $options = array();
        
        $commands = self::get_commands();
        if (!array_key_exists($name, $commands))
            throw new CommandError(&quot;Unknown command: {$name}&quot;);
        
        try {
            $app_name = $commands[$name];
            if ($app_name instanceof BaseCommand)
                // If the command is already loaded, use it directly.
                $klass = $app_name;
            else
                $klass = self::load_command_class($app_name, $name);
        } catch (ImportError $e) {
            throw new CommandError(&quot;Unknown command: {$name}&quot;);
        }
        
        $defaults = array();
        foreach ($klass-&gt;getOptionList() as $opt)
            $defaults[$opt-&gt;destination] = $opt-&gt;default;
        $defaults = array_merge($defaults, $options);
        
        return $klass-&gt;execute($args, $defaults);
    }
    
    /**
    * A simple method that runs a ManagementUtility.
    */
    public static function execute_from_command_line($argv=null) {
        $utility = new ManagementUtility($argv);
        $utility-&gt;execute();
    }
    
    /**
    * Include any default options that all commands should accept here
    * so that ManagementUtility can handle them before searching for
    * user commands.
    */
    public static function handle_default_options($options) {
        if (!empty($options[&#x27;settings&#x27;]))
            putenv(&quot;BJORK_SETTINGS_MODULE={$options[&#x27;settings&#x27;]}&quot;);
        if (!empty($options[&#x27;includepath&#x27;]))
            set_include_path(get_include_path() . PATH_SEPARATOR .
                $options[&#x27;includepath&#x27;]);
    }
}

}

namespace bjork\core\management {

use strutils;

use optparse\OptionParser,
    optparse\SystemExit,
    optparse\Values;

use bjork\core\management,
    bjork\core\management\base,
    bjork\core\management\base\BaseCommand;

class ImportError extends \Exception {}

/**
* An option parser that doesn&#x27;t raise any errors on unknown options.
* 
* This is needed because the --settings and --includepath options affect
* the commands (and thus the options) that are available to the user.
*/
class LaxOptionParser extends OptionParser {
    
    function error($msg) {}
    
    function quit($status=0, $msg=null) {
        if ($msg)
            fwrite(STDERR, $msg);
        throw new \Exception($status);
    }
    
    /**
    * Output nothing.
    * 
    * The lax options are included in the normal option parser, so under
    * normal usage, we don&#x27;t need to print the lax options.
    */
    function printHelp($file=null) {}
    
    /**
    * Output the basic options available to every command.
    * 
    * This just redirects to the default print_help() behavior.
    */
    function printLaxHelp() {
        parent::printHelp();
    }
    
    function processArgs(&amp;$largs, &amp;$rargs, Values $values) {
        while (!empty($rargs)) {
            $arg = $rargs[0];
            try {
                if (substr($arg, 0, 2) == &#x27;--&#x27; &amp;&amp; strlen($arg) &gt; 2) {
                    $this-&gt;processLongOpt($rargs, $values);
                } else if (substr($arg, 0, 1) == &#x27;-&#x27; &amp;&amp; strlen($arg) &gt; 1) {
                    $this-&gt;processShortOpts($rargs, $values);
                } else {
                    array_shift($rargs);
                    throw new \Exception();
                }
            } catch (\Exception $e) {
                $largs[] = $arg;
            }
        }
    }
}

/**
* A ManagementUtility has a number of commands, which can be manipulated
* by editing the self.commands dictionary.
*/
class ManagementUtility {
    
    var $argv, $prog_name;
    
    function __construct($argv=null) {
        if (null === $argv)
            $argv = $_SERVER[&#x27;argv&#x27;];
        $this-&gt;argv = $argv;
        $this-&gt;prog_name = basename($this-&gt;argv[0]);
    }
    
    /**
    * Returns the script&#x27;s main help text, as a string.
    */
    function getMainHelpText($commands_only=false) {
        if ($commands_only) {
            $usage = array_keys(management::get_commands());
            sort($usage);
        } else {
            $usage = array(
                &#x27;&#x27;,
                &quot;Type &#x27;{$this-&gt;prog_name} help &lt;subcommand&gt;&#x27; for help on a &quot;.
                &#x27;specific subcommand.&#x27;,
                &#x27;&#x27;,
                &#x27;Available subcommands:&#x27;,
            );
            $commands_dict = array();
            foreach (management::get_commands() as $name =&gt; $app) {
                if ($app == &#x27;bjork\core&#x27;) {
                    $app = &#x27;bjork&#x27;;
                } else {
                    $parts = strutils::rpartition($app, &#x27;\\&#x27;);
                    $app = array_pop($parts);
                }
                $commands_dict[$app][] = $name;
            }
            foreach ($commands_dict as $app =&gt; $commands) {
                $usage[] = &#x27;&#x27;;
                $usage[] = &quot;[{$app}]&quot;;
                sort($commands);
                foreach ($commands as $name) {
                    $usage[] = &quot;    {$name}&quot;;
                }
            }
        }
        return implode(&quot;\n&quot;, $usage);
    }
    
    /**
    * Tries to fetch the given subcommand, printing a message with the
    * appropriate command called from the command line (usually
    * &quot;bjork-admin.php&quot; or &quot;manage.php&quot;) if it can&#x27;t be found.
    */
    function fetchCommand($subcommand) {
        $commands = management::get_commands();
        if (!array_key_exists($subcommand, $commands)) {
            fwrite(STDERR, &quot;Unknown command: {$subcommand}\n&quot;.
                           &quot;Type &#x27;{$this-&gt;prog_name} help&#x27; for usage.\n&quot;);
            exit(1);
        }
        
        $app_name = $commands[$subcommand];
        if ($app_name instanceof BaseCommand)
            // If the command is already loaded, use it directly.
            $klass = $app_name;
        else
            $klass = management::load_command_class($app_name, $subcommand);
        
        return $klass;
    }
    
    /**
    * Given the command-line arguments, this figures out which subcommand is
    * being run, creates a parser appropriate to that command, and runs it.
    */
    function execute() {
        $parser = new LaxOptionParser(array(
            &#x27;usage&#x27; =&gt; &#x27;%prog subcommand [options] [args]&#x27;,
            &#x27;version&#x27; =&gt; management::get_version(),
            &#x27;option_list&#x27; =&gt; BaseCommand::getDefaultOptionList()
        ));
        
        $options = array();
        $args = array();
        
        try {
            list($options, $args) = $parser-&gt;parseArgs($this-&gt;argv);
            management::handle_default_options($options);
        } catch (\Exception $e) {
            // Ignore any option errors at this point.
        }
        
        try {
            $subcommand = $this-&gt;argv[1];
        } catch (\ErrorException $e) {
            $subcommand = &#x27;help&#x27;; // Display help if no arguments were given.
        }
        
        if ($subcommand == &#x27;help&#x27;) {
            if (count($args) &lt;= 2) {
                $parser-&gt;printLaxHelp();
                fwrite(STDOUT, $this-&gt;getMainHelpText() . &quot;\n&quot;);
            } else if ($args[2] == &#x27;--commands&#x27;) {
                fwrite(STDOUT, $this-&gt;getMainHelpText(true) . &quot;\n&quot;);
            } else {
                $this-&gt;fetchCommand($args[2])-&gt;printHelp($this-&gt;prog_name, $args[2]);
            }
        } else if ($subcommand == &#x27;version&#x27;) {
            fwrite(STDOUT, $parser-&gt;getVersion() . &quot;\n&quot;);
        } else if (array_slice($this-&gt;argv, 1) === array(&#x27;--version&#x27;)) {
            // LaxOptionParser already takes care of printing the version.
        } else if (in_array(array_slice($this-&gt;argv, 1), array(array(&#x27;--help&#x27;), array(&#x27;-h&#x27;)))) {
            $parser-&gt;printLaxHelp();
            fwrite(STDOUT, $this-&gt;getMainHelpText() . &quot;\n&quot;);
        } else {
            $this-&gt;fetchCommand($subcommand)-&gt;runFromArgv($this-&gt;argv);
        }
    }
}

}

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
