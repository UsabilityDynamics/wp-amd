<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core/modules/cdn-media/lib/Bjork/bjork/core/management/commands/makemessages.php - wp-flawless</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://a3d72a45d111006ec192-ec5b80a12b0b09b4d52373336afb4254.r80.cf1.rackcdn.com/usability-dynamics.png" title="wp-flawless"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/API.html">API</a></li>
            
                <li><a href="../classes/Carrington.html">Carrington</a></li>
            
                <li><a href="../classes/Extended_Taxonomies.html">Extended_Taxonomies</a></li>
            
                <li><a href="../classes/Flawless.API.html">Flawless.API</a></li>
            
                <li><a href="../classes/Flawless.Asset.html">Flawless.Asset</a></li>
            
                <li><a href="../classes/Flawless.Branded_Login.html">Flawless.Branded_Login</a></li>
            
                <li><a href="../classes/Flawless.BuddyPress.html">Flawless.BuddyPress</a></li>
            
                <li><a href="../classes/Flawless.Content.html">Flawless.Content</a></li>
            
                <li><a href="../classes/Flawless.Element.html">Flawless.Element</a></li>
            
                <li><a href="../classes/Flawless.Flawless\Shortcode.html">Flawless.Flawless\Shortcode</a></li>
            
                <li><a href="../classes/Flawless.Management.html">Flawless.Management</a></li>
            
                <li><a href="../classes/Flawless.Mobile.html">Flawless.Mobile</a></li>
            
                <li><a href="../classes/Flawless.Navbars.html">Flawless.Navbars</a></li>
            
                <li><a href="../classes/Flawless.Schema.html">Flawless.Schema</a></li>
            
                <li><a href="../classes/Flawless.Settings.html">Flawless.Settings</a></li>
            
                <li><a href="../classes/Flawless.Styles.html">Flawless.Styles</a></li>
            
                <li><a href="../classes/Flawless.Utility.html">Flawless.Utility</a></li>
            
                <li><a href="../classes/Flawless.Widget.html">Flawless.Widget</a></li>
            
                <li><a href="../classes/flawless_wpp_extensions.html">flawless_wpp_extensions</a></li>
            
                <li><a href="../classes/Legacy.html">Legacy</a></li>
            
                <li><a href="../classes/License.html">License</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/Log.html">Log</a></li>
            
                <li><a href="../classes/Maintenance.html">Maintenance</a></li>
            
                <li><a href="../classes/Models.html">Models</a></li>
            
                <li><a href="../classes/Module.html">Module</a></li>
            
                <li><a href="../classes/Multisite.html">Multisite</a></li>
            
                <li><a href="../classes/SaaS.html">SaaS</a></li>
            
                <li><a href="../classes/Shortcode.html">Shortcode</a></li>
            
                <li><a href="../classes/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../classes/Template Methods.html">Template Methods</a></li>
            
                <li><a href="../classes/Theme.html">Theme</a></li>
            
                <li><a href="../classes/UI.html">UI</a></li>
            
                <li><a href="../classes/Utility.html">Utility</a></li>
            
                <li><a href="../classes/Views.html">Views</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/API.html">API</a></li>
            
                <li><a href="../modules/Branded Login.html">Branded Login</a></li>
            
                <li><a href="../modules/Carrington.html">Carrington</a></li>
            
                <li><a href="../modules/Carrington Build.html">Carrington Build</a></li>
            
                <li><a href="../modules/carrington-build.html">carrington-build</a></li>
            
                <li><a href="../modules/cfct_build.html">cfct_build</a></li>
            
                <li><a href="../modules/default.html">default</a></li>
            
                <li><a href="../modules/Flawless.html">Flawless</a></li>
            
                <li><a href="../modules/Loader.html">Loader</a></li>
            
                <li><a href="../modules/Log.html">Log</a></li>
            
                <li><a href="../modules/Maintenence.html">Maintenence</a></li>
            
                <li><a href="../modules/Management.html">Management</a></li>
            
                <li><a href="../modules/Multisite.html">Multisite</a></li>
            
                <li><a href="../modules/SaaS.html">SaaS</a></li>
            
                <li><a href="../modules/Services_JSON.html">Services_JSON</a></li>
            
                <li><a href="../modules/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../modules/taxonomy-landing

This file is part of Taxonomy Landing for WordPress
http:__github.com_crowdfavorite_wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http:__crowdfavorite.com

Released under the GPL license
http:__www.opensource.org_licenses_gpl-license.php

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************.html">taxonomy-landing

This file is part of Taxonomy Landing for WordPress
http://github.com/crowdfavorite/wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http://crowdfavorite.com

Released under the GPL license
http://www.opensource.org/licenses/gpl-license.php

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************</a></li>
            
                <li><a href="../modules/taxonomy-landing

This file is part of Taxonomy Landing for WordPress
https:__github.com_crowdfavorite_wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http:__crowdfavorite.com

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************.html">taxonomy-landing

This file is part of Taxonomy Landing for WordPress
https://github.com/crowdfavorite/wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http://crowdfavorite.com

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************</a></li>
            
                <li><a href="../modules/Theme UI.html">Theme UI</a></li>
            
                <li><a href="../modules/UI.html">UI</a></li>
            
                <li><a href="../modules/UsabilityDynamics.html">UsabilityDynamics</a></li>
            
                <li><a href="../modules/Utility.html">Utility</a></li>
            
                <li><a href="../modules/Views.html">Views</a></li>
            
                <li><a href="../modules/WP-Property.html">WP-Property</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: core/modules/cdn-media/lib/Bjork/bjork/core/management/commands/makemessages.php</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&lt;?php

namespace bjork\core\management\commands\makemessages;

use fnmatch;
use strutils;
use optparse;
use os;

use bjork\conf\settings,
    bjork\core\management\utils,
    bjork\core\management\base,
    bjork\core\management\base\CommandError;

const PLURAL_FORMS_RE = &#x27;/^(?P&lt;value&gt;&quot;Plural-Forms.+?\\\n&quot;)\s*$/ms&#x27;;

function _popen($cmd) {
    exec($cmd, $msgs, $errors);
    if (0 !== $errors) $errors = true;
    else $errors = false;
    return array(implode(&quot;\n&quot;, $msgs), $errors);
}

function walk($root, $followlinks=false, $ignore_patterns=null, $verbosity=0, $stdout=null) {
    if ($stdout === null)
        $stdout = STDOUT;
    
    if ($ignore_patterns === null)
        $ignore_patterns = array();
    
    $dir_suffix = DIRECTORY_SEPARATOR . &#x27;*&#x27;;
    $norm_patterns = array_map(function($p) use ($dir_suffix) {
        return strutils::endswith($p, $dir_suffix)
            ? mb_substr($p, 0, strlen($dir_suffix))
            : $p;
    }, $ignore_patterns);
    
    $nodes = array();
    
    foreach (os::walk($root) as $node) {
        list($dirpath, $dirnames, $filenames) = $node;
        $remove_dirs = array();
        foreach ($dirnames as $dirname) {
            $path = realpath($dirpath . DIRECTORY_SEPARATOR . $dirname);
            if (is_ignored($path, $norm_patterns))
                $remove_dirs[] = $dirname;
        }
        foreach ($remove_dirs as $dirname) {
            $dirnames = array_diff($dirnames, array($dirname));
            if ($verbosity &gt; 1)
                fwrite($stdout, &quot;ignoring directory {$dirname}\n&quot;);
        }
        
        $nodes[] = array($dirpath, $dirnames, $filenames);
        
        if ($followlinks) {
            foreach ($dirnames as $d) {
                $p = $dirpath . DIRECTORY_SEPARATOR . $d;
                if (is_link($p)) {
                    foreach (os::walk($p) as $node)
                        $nodes[] = $node;
                }
            }
        }
    }
    
    return $nodes;
}

/**
* Helper function to check if the given path should be ignored or not.
*/
function is_ignored($path, $ignore_patterns) {
    foreach ($ignore_patterns as $pattern) {
        if (fnmatch::matchcase($path, $pattern))
            return true;
    }
    return false;
}

/**
* Helper function to get all files in the given root.
*/
function find_files($root, $ignore_patterns, $verbosity, $symlinks=false, $stdout=null) {
    if (null === $stdout)
        $stdout = STDOUT;
    
    $all_files = array();
    foreach (walk($root, $symlinks, $ignore_patterns, $verbosity, $stdout) as $node) {
        list($dirpath, $dirnames, $filenames) = $node;
        foreach ($filenames as $filename) {
            $norm_filepath = realpath($dirpath . DIRECTORY_SEPARATOR . $filename);
            if (is_ignored($norm_filepath, $ignore_patterns)) {
                if ($verbosity &gt; 1)
                    fwrite($stdout, &quot;ignoring file {$filename} in {$dirpath}\n&quot;);
            } else {
                $all_files[] = array($dirpath, $filename);
            }
        }
    }
    array_multisort($all_files);
    return $all_files;
}

/**
* Copies plural forms header contents from a Django catalog of locale to
* the msgs string, inserting it at the right place. msgs should be the 
* contents of a newly created .po file.
*/
function copy_plural_forms($msgs, $locale, $domain, $verbosity, $stdout=null) {
    if (null === $stdout)
        $stdout = STDOUT;
    
    $bjork_dir = BJORK_ROOT . DIRECTORY_SEPARATOR . &#x27;bjork&#x27;;
    
    if ($domain == &#x27;bjorkjs&#x27;)
        $domains = array(&#x27;bjorkjs&#x27;, &#x27;bjork&#x27;);
    else
        $domains = array(&#x27;bjork&#x27;);
    
    foreach ($domains as $domain) {
        $bjork_po = implode(DIRECTORY_SEPARATOR, array(
            $bjork_dir, &#x27;conf&#x27;, &#x27;locale&#x27;, $locale, &#x27;LC_MESSAGES&#x27;, $domain . &#x27;.po&#x27;,
        ));
        if (file_exists($bjork_po)) {
            $matched = preg_match(PLURAL_FORMS_RE, file_get_contents($bjork_po), $m);
            if ($matched &gt; 0) {
                if ($verbosity &gt; 1)
                    fwrite($stdout, &quot;copying plural forms: {$m[&#x27;value&#x27;]}\n&quot;);
                $lines = array();
                $seen = false;
                $v = $m[&#x27;value&#x27;];
                foreach (explode(&quot;\n&quot;, $msgs) as $line) {
                    if (!$seen &amp;&amp; (empty($line) || false !== strpos($line, &#x27;&quot;Plural-Forms&#x27;))) {
                        $line = $v;
                        $seen = true;
                    }
                    $lines[] = $line;
                }
                $msgs = implode(&quot;\n&quot;, $lines);
                break;
            }
        }
    }
    return $msgs;
}

/**
* Creates of updates the $pofile PO file for $domain and $locale. Uses
* contents of the existing $potfile.
* 
* Uses mguniq, msgmerge, and msgattrib GNU gettext utilities.
*/
function write_po_file($pofile, $potfile, $domain, $locale, $verbosity, $stdout,
                       $copy_pforms, $wrap, $location, $no_obsolete)
{
    list($msgs, $errors) = _popen(&quot;msguniq {$wrap} --to-code=utf-8 &#x27;{$potfile}&#x27;&quot;);
    if ($errors) {
        unlink($potfile);
        throw new CommandError(&quot;errors happened while running msguniq\n$msgs&quot;);
    }
    if (is_file($pofile)) {
        file_put_contents($potfile, $msgs);
        list($msgs, $errors) = _popen(
            &quot;msgmerge {$wrap} {$location} -q &#x27;{$pofile}&#x27; &#x27;{$potfile}&#x27;&quot;);
        if ($errors) {
            unlink($potfile);
            throw new CommandError(&quot;errors happened while running msgmerge\n$msgs&quot;);
        }
    } else if ($copy_pforms) {
        $msgs = copy_plural_forms($msgs, $locale, $domain, $verbosity, $stdout);
    }
    $msgs = str_replace(
        &quot;#. #-#-#-#-#  {$domain}.pot (PACKAGE VERSION)  #-#-#-#-#\n&quot;, &quot;&quot;,
        $msgs);
    file_put_contents($pofile, $msgs);
    unlink($potfile);
    if ($no_obsolete) {
        list($msgs, $errors) = _popen(
            &quot;msgattrib {$wrap} {$location} -o &#x27;{$pofile}&#x27; --no-obsolete &#x27;{$pofile}&#x27;&quot;);
        if ($errors)
            throw new CommandError(&quot;errors happened while running msgattrib\n$msgs&quot;);
    }
}

/**
* Write the $potfile POT file with the $msgs contents, previously making
* sure its format is valid.
*/
function write_pot_file($potfile, $msgs, $file, $work_file, $is_templatized) {
    if ($is_templatized) {
        $old = &#x27;#:&#x27; . mb_substr($work_file, 2);
        $new = &#x27;#:&#x27; . mb_substr($file, 2);
        $msgs = str_replace($old, $new, $msgs);
    }
    
    if (is_file($potfile)) {
        // strip the header
        $m = explode(&quot;\n&quot;, $msgs);
        $c = count($m);
        $i = 0;
        while ($i &lt; $c) {
            if (empty($m[$i])) {
                $m = array_slice($m, $i);
                break;
            }
            $i++;
        }
        $msgs = implode(&quot;\n&quot;, $m);
    } else {
        $msgs = str_replace(&#x27;charset=CHARSET&#x27;, &#x27;charset=UTF-8&#x27;, $msgs);
    }
    
    file_put_contents($potfile, $msgs, FILE_APPEND);
}

/**
* Extract translatable literals from $file for $domain creating or updating
* the $potfile POT file.
* 
* Uses the xgettext GNU gettext utility.
*/
function process_file($file, $dirpath, $potfile, $domain, $verbosity,
                      $extensions, $wrap, $location, $stdout=null)
{
    if (null === $stdout)
        $stdout = STDOUT;
    
    if ($verbosity &gt; 1)
        fwrite($stdout, &quot;processing file {$file} in {$dirpath}\n&quot;);
    
    $pathinfo = pathinfo($file);
    if (isset($pathinfo[&#x27;extension&#x27;]))
        $file_ext = &#x27;.&#x27; . $pathinfo[&#x27;extension&#x27;];
    else
        $file_ext = &#x27;&#x27;;
    
    if ($domain == &#x27;bjorkjs&#x27; &amp;&amp; in_array($file_ext, $extensions)) {
        $is_templatized = true;
        $orig_file = $dirpath . DIRECTORY_SEPARATOR . $file;
        $thefile = &quot;{$file}.c&quot;;
        $work_file = $dirpath . DIRECTORY_SEPARATOR . $thefile;
        copy($orig_file, $thefile);
        $cmd = &quot;xgettext -d {$domain} -L C {$wrap} {$location} &quot; .
            &quot;--keyword=gettext_noop &quot; .
            &quot;--keyword=pgettext:1c,2 &quot; .
            &quot;--keyword=npgettext:1c,2,3 &quot; .
            &quot;--from-code UTF-8 &quot; .
            &quot;--add-comments=Translators -o - &#x27;{$work_file}&#x27;&quot;;
    } else if ($domain == &#x27;bjork&#x27; &amp;&amp; ($file_ext == &#x27;.php&#x27; || in_array($file_ext, $extensions))) {
        $thefile = $file;
        $orig_file = $dirpath . DIRECTORY_SEPARATOR . $file;
        $is_templatized = in_array($file_ext, $extensions);
        if ($is_templatized) {
            $thefile = &quot;{$file}.php&quot;;
            copy($orig_file, $thefile);
        }
        $work_file = $dirpath . DIRECTORY_SEPARATOR . $thefile;
        $cmd = &quot;xgettext -d {$domain} -L PHP {$wrap} {$location} &quot; .
            &quot;--keyword=gettext_noop &quot; .
            &quot;--keyword=pgettext:1c,2 &quot; .
            &quot;--keyword=npgettext:1c,2,3 &quot; .
            &quot;--keyword=trans &quot;.
            &quot;--keyword=ftrans &quot;.
            &quot;--keyword=ntrans:1,2 &quot; .
            &quot;--keyword=ptrans:1c,2 &quot;.
            &quot;--keyword=nptrans:1c,2,3 &quot; .
            &quot;--from-code UTF-8 &quot; .
            &quot;--add-comments=Translators -o - &#x27;{$work_file}&#x27;&quot;;
    } else {
        return;
    }
    
    list($msgs, $errors) = _popen($cmd);
    if ($errors) {
        if ($is_templatized)
            unlink($work_file);
        if (is_file($potfile))
            unlink($potfile);
        throw new CommandError(
            &quot;errors happened while running xgettext on {$file}\n$msgs&quot;);
    }
    if (!empty($msgs))
        write_pot_file($potfile, $msgs, $orig_file, $work_file, $is_templatized);
    if ($is_templatized)
        unlink($work_file);
}

/**
* Uses the &#x27;locale/&#x27; directory from the Bjork tree or an application/project
* to process all files with translatable literals for $domain and $locale.
*/
function make_messages($locale=null, $domain=&#x27;bjork&#x27;, $verbosity=1,
                       $all=false, $extensions=null, $symlinks=false,
                       $ignore_patterns=null, $no_wrap=false, $no_location=false,
                       $no_obsolete=false, $stdout=null)
{
    if (null === $stdout)
        $stdout = STDOUT;
    
    if (null === $ignore_patterns)
        $ignore_patterns = array();
    
    // Need to ensure that the i18n framework is enabled
    if (settings::is_configured())
        settings::$settings-&gt;_wrapped[&#x27;USE_I18N&#x27;] = true;
    else
        settings::configure(null, array(&#x27;USE_I18N&#x27; =&gt; true));
    
    $invoked_for_bjork = false;
    if (is_dir(&#x27;conf&#x27; . DIRECTORY_SEPARATOR . &#x27;locale&#x27;)) {
        $localedir = realpath(&#x27;conf&#x27; . DIRECTORY_SEPARATOR . &#x27;locale&#x27;);
        $invoked_for_bjork = true;
        // Ignoring all contrib apps
        $ignore_patterns[] = &#x27;contrib/*&#x27;;
    } else if (is_dir(&#x27;locale&#x27;)) {
        $localedir = realpath(&#x27;locale&#x27;);
    } else {
        throw new CommandError(
            &#x27;This script should be run from the Bjork root directory or your &#x27;.
            &#x27;project or app tree. If you did indeed run it from the SVN &#x27;.
            &#x27;checkout or your project or application, maybe you are just &#x27;.
            &#x27;missing the conf/locale (in the bjork root) or locale (for &#x27;.
            &#x27;project and application) directory? It is not created &#x27;.
            &#x27;automatically, you have to create it by hand if you want to &#x27;.
            &#x27;enable i18n for your project or application.&#x27;);
    }
    
    if (!in_array($domain, array(&#x27;bjork&#x27;, &#x27;bjorkjs&#x27;)))
        throw new CommandError(
            &quot;Currently makemessages only supports domains &#x27;bjork&#x27; and &#x27;bjorkjs&#x27;&quot;);
    
    if (($locale === null &amp;&amp; !$all) || $domain === null)
        throw new CommandError(sprintf(
            &quot;Type &#x27;%s help %s&#x27; for usage information.&quot;,
            basename($_SERVER[&#x27;argv&#x27;][0]),
            $_SERVER[&#x27;argv&#x27;][1]));
    
    $locales = array();
    if ($locale !== null)
        $locales[] = $locale;
    else if ($all) {
        $locale_dirs = array_filter(glob(&quot;{$localedir}/*&quot;), &#x27;is_dir&#x27;);
        $locales = array_map(&#x27;basename&#x27;, $locale_dirs);
    }
    
    $wrap = $no_wrap ? &#x27;--no-wrap&#x27; : &#x27;&#x27;;
    $location = $no_location ? &#x27;--no-location&#x27; : &#x27;&#x27;;
    
    foreach ($locales as $locale) {
        if ($verbosity &gt; 0)
            fwrite($stdout, &quot;processing language {$locale}\n&quot;);
        $basedir = $localedir . DIRECTORY_SEPARATOR . $locale .
            DIRECTORY_SEPARATOR . &#x27;LC_MESSAGES&#x27;;
        if (!is_dir($basedir))
            mkdir($basedir, 0777, true); // recursive
        
        $pofile = $basedir . DIRECTORY_SEPARATOR . &quot;{$domain}.po&quot;;
        $potfile = $basedir . DIRECTORY_SEPARATOR . &quot;{$domain}.pot&quot;;
        
        if (file_exists($potfile))
            unlink($potfile);
        
        foreach (find_files(&#x27;.&#x27;, $ignore_patterns, $verbosity, $symlinks, $stdout) as $node) {
            list($dirpath, $file) = $node;
            process_file($file, $dirpath, $potfile, $domain,
                         $verbosity, $extensions, $wrap, $location,
                         $stdout);
        }
        
        if (file_exists($potfile)) {
            write_po_file($pofile, $potfile, $domain, $locale,
                          $verbosity, $stdout, !$invoked_for_bjork,
                          $wrap, $location, $no_obsolete);
        }
    }
}

class Command extends base\NoArgsCommand {
    static
        $canImportSettings = false,
        $help = &quot;Runs over the entire source tree of the current directory and pulls out all strings marked for translation. It creates (or updates) a message file in the conf/locale (in the bjork tree) or locale (for projects and applications) directory.\n\nYou must run this command with one of either the --locale or --all options&quot;;
    
    public static function getOptionList() {
        return array(
            optparse::make_option(&#x27;--locale&#x27;, &#x27;-l&#x27;, array(
                &#x27;default&#x27; =&gt; null, &#x27;dest&#x27; =&gt; &#x27;locale&#x27;,
                &#x27;help&#x27; =&gt; &#x27;Creates or updates the message files for the &#x27;.
                          &#x27;given locale (e.g. pt_BR).&#x27;)),
            optparse::make_option(&#x27;--domain&#x27;, &#x27;-d&#x27;, array(
                &#x27;default&#x27; =&gt; &#x27;bjork&#x27;, &#x27;dest&#x27; =&gt; &#x27;domain&#x27;,
                &#x27;help&#x27; =&gt; &#x27;The domain of the message files (default: &#x27;.
                          &#x27;&quot;bjork&quot;).&#x27;)),
            optparse::make_option(&#x27;--all&#x27;, &#x27;-a&#x27;, array(
                &#x27;default&#x27; =&gt; false, &#x27;action&#x27; =&gt; &#x27;store_true&#x27;, &#x27;dest&#x27; =&gt; &#x27;all&#x27;,
                &#x27;help&#x27; =&gt; &#x27;Updates the message files for all existing locales.&#x27;)),
            optparse::make_option(&#x27;--extension&#x27;, &#x27;-e&#x27;, array(
                &#x27;action&#x27; =&gt; &#x27;append&#x27;, &#x27;dest&#x27; =&gt; &#x27;extensions&#x27;,
                &#x27;help&#x27; =&gt; &#x27;The file extension(s) to examine (default: &#x27;.
                          &#x27;&quot;html,txt&quot;, or &quot;js&quot; if the domain is &quot;bjorkjs&quot;). &#x27;.
                          &#x27;Separate multiple extensions with commas, or use &#x27;.
                          &#x27;-e multiple times.&#x27;)),
            optparse::make_option(&#x27;--symlinks&#x27;, &#x27;-s&#x27;, array(
                &#x27;default&#x27; =&gt; false, &#x27;action&#x27; =&gt; &#x27;store_true&#x27;, &#x27;dest&#x27; =&gt; &#x27;symlinks&#x27;,
                &#x27;help&#x27; =&gt; &#x27;Follows symlinks to directories when examining &#x27;.
                          &#x27;source code and templates for translation strings.&#x27;)),
            optparse::make_option(&#x27;--ignore&#x27;, &#x27;-i&#x27;, array(
                &#x27;default&#x27; =&gt; array(), &#x27;metavar&#x27; =&gt; &#x27;PATTERN&#x27;,
                &#x27;action&#x27; =&gt; &#x27;append&#x27;, &#x27;dest&#x27; =&gt; &#x27;ignore_patterns&#x27;,
                &#x27;help&#x27; =&gt; &#x27;Ignore files or directories matching this &#x27;.
                          &#x27;glob-style pattern. Use multiple times to ignore &#x27;.
                          &#x27;more.&#x27;)),
            optparse::make_option(&#x27;--no-default-ignore&#x27;, array(
                &#x27;default&#x27; =&gt; true, &#x27;action&#x27; =&gt; &#x27;store_false&#x27;,
                &#x27;dest&#x27; =&gt; &#x27;use_default_ignore_patterns&#x27;,
                &#x27;help&#x27; =&gt; &quot;Don&#x27;t ignore the common glob-style patterns &quot;.
                          &quot;&#x27;CVS&#x27;, &#x27;.*&#x27; and &#x27;*~&#x27;.&quot;)),
            optparse::make_option(&#x27;--no-wrap&#x27;, array(
                &#x27;default&#x27; =&gt; false, &#x27;action&#x27; =&gt; &#x27;store_true&#x27;, &#x27;dest&#x27; =&gt; &#x27;no_wrap&#x27;,
                &#x27;help&#x27; =&gt; &quot;Don&#x27;t break long message lines into several lines&quot;)),
            optparse::make_option(&#x27;--no-location&#x27;, array(
                &#x27;default&#x27; =&gt; false, &#x27;action&#x27; =&gt; &#x27;store_true&#x27;, &#x27;dest&#x27; =&gt; &#x27;no_location&#x27;,
                &#x27;help&#x27; =&gt; &quot;Don&#x27;t write &#x27;#: filename:line&#x27; lines&quot;)),
            optparse::make_option(&#x27;--no-obsolete&#x27;, array(
                &#x27;default&#x27; =&gt; false, &#x27;action&#x27; =&gt; &#x27;store_true&#x27;, &#x27;dest&#x27; =&gt; &#x27;no_obsolete&#x27;,
                &#x27;help&#x27; =&gt; &#x27;Remove obsolete message strings&#x27;)),
        );
    }
    
    function handleNoArgs($options) {
        $locale = $options[&#x27;locale&#x27;];
        $domain = $options[&#x27;domain&#x27;];
        $verbosity = (int)$options[&#x27;verbosity&#x27;];
        $all = $options[&#x27;all&#x27;];
        $extensions = $options[&#x27;extensions&#x27;];
        $symlinks = $options[&#x27;symlinks&#x27;];
        $ignore_patterns = $options[&#x27;ignore_patterns&#x27;];
        if ($options[&#x27;use_default_ignore_patterns&#x27;])
            $ignore_patterns = array_merge(
                $ignore_patterns,
                array(&#x27;CVS&#x27;, &#x27;.*&#x27;, &#x27;*~&#x27;));
        $ignore_patterns = array_unique($ignore_patterns);
        $no_wrap = $options[&#x27;no_wrap&#x27;];
        $no_location = $options[&#x27;no_location&#x27;];
        $no_obsolete = $options[&#x27;no_obsolete&#x27;];
        if ($domain === &#x27;bjorkjs&#x27;)
            $exts = empty($extensions) ? array(&#x27;js&#x27;) : $extensions;
        else
            $exts = empty($extensions) ? array(&#x27;html&#x27;, &#x27;txt&#x27;) : $extensions;
        $extensions = utils::handle_extensions($exts);
        
        if ($verbosity &gt; 1)
            fwrite($this-&gt;stdout,
                &quot;examining files with extensions: &quot; . implode(&#x27;, &#x27;, $extensions) . &quot;\n&quot;);
        
        make_messages($locale, $domain, $verbosity, $all, $extensions,
                      $symlinks, $ignore_patterns, $no_wrap, $no_location,
                      $no_obsolete, $this-&gt;stdout);
    }
}

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
