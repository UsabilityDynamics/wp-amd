<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core/modules/extended-taxonomies/extended-taxonomies.php - wp-flawless</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://a3d72a45d111006ec192-ec5b80a12b0b09b4d52373336afb4254.r80.cf1.rackcdn.com/usability-dynamics.png" title="wp-flawless"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/API.html">API</a></li>
            
                <li><a href="../classes/Carrington.html">Carrington</a></li>
            
                <li><a href="../classes/Extended_Taxonomies.html">Extended_Taxonomies</a></li>
            
                <li><a href="../classes/Flawless.API.html">Flawless.API</a></li>
            
                <li><a href="../classes/Flawless.Asset.html">Flawless.Asset</a></li>
            
                <li><a href="../classes/Flawless.Branded_Login.html">Flawless.Branded_Login</a></li>
            
                <li><a href="../classes/Flawless.BuddyPress.html">Flawless.BuddyPress</a></li>
            
                <li><a href="../classes/Flawless.Content.html">Flawless.Content</a></li>
            
                <li><a href="../classes/Flawless.Element.html">Flawless.Element</a></li>
            
                <li><a href="../classes/Flawless.Flawless\Shortcode.html">Flawless.Flawless\Shortcode</a></li>
            
                <li><a href="../classes/Flawless.Management.html">Flawless.Management</a></li>
            
                <li><a href="../classes/Flawless.Mobile.html">Flawless.Mobile</a></li>
            
                <li><a href="../classes/Flawless.Navbars.html">Flawless.Navbars</a></li>
            
                <li><a href="../classes/Flawless.Schema.html">Flawless.Schema</a></li>
            
                <li><a href="../classes/Flawless.Settings.html">Flawless.Settings</a></li>
            
                <li><a href="../classes/Flawless.Styles.html">Flawless.Styles</a></li>
            
                <li><a href="../classes/Flawless.Utility.html">Flawless.Utility</a></li>
            
                <li><a href="../classes/Flawless.Widget.html">Flawless.Widget</a></li>
            
                <li><a href="../classes/flawless_wpp_extensions.html">flawless_wpp_extensions</a></li>
            
                <li><a href="../classes/Legacy.html">Legacy</a></li>
            
                <li><a href="../classes/License.html">License</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/Log.html">Log</a></li>
            
                <li><a href="../classes/Maintenance.html">Maintenance</a></li>
            
                <li><a href="../classes/Models.html">Models</a></li>
            
                <li><a href="../classes/Module.html">Module</a></li>
            
                <li><a href="../classes/Multisite.html">Multisite</a></li>
            
                <li><a href="../classes/SaaS.html">SaaS</a></li>
            
                <li><a href="../classes/Shortcode.html">Shortcode</a></li>
            
                <li><a href="../classes/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../classes/Template Methods.html">Template Methods</a></li>
            
                <li><a href="../classes/Theme.html">Theme</a></li>
            
                <li><a href="../classes/UI.html">UI</a></li>
            
                <li><a href="../classes/Utility.html">Utility</a></li>
            
                <li><a href="../classes/Views.html">Views</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/API.html">API</a></li>
            
                <li><a href="../modules/Branded Login.html">Branded Login</a></li>
            
                <li><a href="../modules/Carrington.html">Carrington</a></li>
            
                <li><a href="../modules/Carrington Build.html">Carrington Build</a></li>
            
                <li><a href="../modules/carrington-build.html">carrington-build</a></li>
            
                <li><a href="../modules/cfct_build.html">cfct_build</a></li>
            
                <li><a href="../modules/default.html">default</a></li>
            
                <li><a href="../modules/Flawless.html">Flawless</a></li>
            
                <li><a href="../modules/Loader.html">Loader</a></li>
            
                <li><a href="../modules/Log.html">Log</a></li>
            
                <li><a href="../modules/Maintenence.html">Maintenence</a></li>
            
                <li><a href="../modules/Management.html">Management</a></li>
            
                <li><a href="../modules/Multisite.html">Multisite</a></li>
            
                <li><a href="../modules/SaaS.html">SaaS</a></li>
            
                <li><a href="../modules/Services_JSON.html">Services_JSON</a></li>
            
                <li><a href="../modules/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../modules/taxonomy-landing

This file is part of Taxonomy Landing for WordPress
http:__github.com_crowdfavorite_wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http:__crowdfavorite.com

Released under the GPL license
http:__www.opensource.org_licenses_gpl-license.php

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************.html">taxonomy-landing

This file is part of Taxonomy Landing for WordPress
http://github.com/crowdfavorite/wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http://crowdfavorite.com

Released under the GPL license
http://www.opensource.org/licenses/gpl-license.php

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************</a></li>
            
                <li><a href="../modules/taxonomy-landing

This file is part of Taxonomy Landing for WordPress
https:__github.com_crowdfavorite_wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http:__crowdfavorite.com

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************.html">taxonomy-landing

This file is part of Taxonomy Landing for WordPress
https://github.com/crowdfavorite/wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http://crowdfavorite.com

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************</a></li>
            
                <li><a href="../modules/Theme UI.html">Theme UI</a></li>
            
                <li><a href="../modules/UI.html">UI</a></li>
            
                <li><a href="../modules/UsabilityDynamics.html">UsabilityDynamics</a></li>
            
                <li><a href="../modules/Utility.html">Utility</a></li>
            
                <li><a href="../modules/Views.html">Views</a></li>
            
                <li><a href="../modules/WP-Property.html">WP-Property</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: core/modules/extended-taxonomies/extended-taxonomies.php</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&lt;?php
  /**
   * Name: Extended Taxonomies
   * Version: 1.0
   * Description: Adds meta attributes to terms.
   * Author: Usability Dynamics, Inc.
   * Theme Feature: extended-taxonomies
   *
   * @name Maintenence
   * @description Widgets for the Flawless theme.
   * @author Usability Dynamics, Inc.
   * @version 1.0
   * @namespace Flawless
   * @module Maintenence
   */
  namespace Flawless {

    /**
     * Class Extended_Taxonomies
     *
     * @package Flawless
     */
    class Extended_Taxonomies {

      /**
       * Constructor for the Extended Taxonomies.
       *
       * @author potanin@UD
       * @version 0.0.1
       * @method __construct
       *
       * @constructor
       * @for Extended_Taxonomies
       *
       * @param array $options
       */
      public function __construct( $options = array() ) {

        add_filter( &#x27;flawless::init_lower&#x27;, array( $this, &#x27;init_lower&#x27;, 2, 10 ) );
        add_filter( &#x27;flawless::setup_theme_features::after&#x27;, array( $this, &#x27;setup_theme_features&#x27;, 2, 10 ) );

        add_filter( &#x27;flawless::generate_taxonomies&#x27;, array( $this, &#x27;generate_taxonomies&#x27;, 2, 10 ) );
        add_action( &#x27;flawless::setup_taxonomy&#x27;, array( $this, &#x27;setup_taxonomy&#x27;, 2, 10 ) );

        add_filter( &#x27;flawless::install&#x27;, array( $this, &#x27;install&#x27;, 2, 10 ) );
        add_filter( &#x27;flawless::update&#x27;, array( $this, &#x27;install&#x27;, 2, 10 ) );

      }

      /**
       * Primary Initializer
       *
       * @method init_lower
       * @for Extended_Taxonomies
       */
      public function init_lower() {

        if ( current_theme_supports( &#x27;extended-taxonomies&#x27; ) ) {
          add_action( &#x27;wp_insert_post&#x27;, array( __CLASS__, &#x27;term_updated&#x27; ), 9, 2 );
          add_action( &#x27;created_term&#x27;, array( __CLASS__, &#x27;term_updated&#x27; ), 9 );
          add_action( &#x27;edit_term&#x27;, array( __CLASS__, &#x27;term_updated&#x27; ), 9 );
          add_action( &#x27;delete_term&#x27;, array( __CLASS__, &#x27;delete_term&#x27; ), 9, 3 );
          add_action( &#x27;load-edit-tags.php&#x27;, array( __CLASS__, &#x27;term_editor_loader&#x27; ) );
          add_action( &#x27;load-post.php&#x27;, array( __CLASS__, &#x27;post_editor_loader&#x27; ) );
        }

      }

      /**
       * If Term Meta is supported, add callback function to render any UI we want to show on the taxonomy pages
       *
       * @param $type String Taxonomy slug.
       * @param $data Object Taxonomy settings.
       */
      public function setup_taxonomy( $type, $data ) {

        if( current_theme_supports( &#x27;extended-taxonomies&#x27; ) ) {
          add_action( $type . &#x27;_edit_form_fields&#x27;,  array( __CLASS__, &#x27;taxonomy_edit_form_fields&#x27; ), 5, 2 );
          add_action( $type . &#x27;_pre_add_form&#x27;,      array( __CLASS__, &#x27;taxonomy_pre_add_form&#x27; ), 5 );
        }

      }

      /**
       * Ported from Flawless Core. Needs testing
       *
       * @method generate_taxonomies
       * @for Extended_Taxonomies
       */
      public function generate_taxonomies( $data, $type ) {

        if ( current_theme_supports( &#x27;extended-taxonomies&#x27; ) &amp;&amp; !post_type_exists( $type ) ) {

          register_post_type( &#x27;_tp_&#x27; . $type, array(
            &#x27;label&#x27;    =&gt; $data[ &#x27;label&#x27; ],
            &#x27;public&#x27;   =&gt; false,
            &#x27;rewrite&#x27;  =&gt; false,
            &#x27;labels&#x27;   =&gt; array(
              &#x27;name&#x27;      =&gt; $data[ &#x27;label&#x27; ],
              &#x27;edit_item&#x27; =&gt; &#x27;Edit Term: &#x27; . $data[ &#x27;label&#x27; ]
            ),
            &#x27;supports&#x27; =&gt; array( &#x27;title&#x27;, &#x27;editor&#x27; )
          ) );

          if ( $data[ &#x27;allow_term_thumbnail&#x27; ] ) {
            add_post_type_support( &#x27;_tp_&#x27; . $type, &#x27;thumbnail&#x27; );
            add_filter( &#x27;manage_edit-&#x27; . $type . &#x27;_columns&#x27;, create_function( &#x27;$c&#x27;, &#x27; return Flawless::array_insert_after( $c, &quot;cb&quot;, array( &quot;term_thumbnail&quot; =&gt; &quot;&quot; )); &#x27; ) );
            add_filter( &#x27;manage_&#x27; . $type . &#x27;_custom_column&#x27;, function ( $null, $column, $term_id ) {
              if ( $column == &#x27;term_thumbnail&#x27; ) {
                echo wp_get_attachment_image( get_post_thumbnail_id( get_post_for_extended_term( $term_id )-&gt;ID ), array( 75, 75 ) );
              };
            }, 10, 3 );
          }

        }

        return $data;

      }

      /**
       * Enable Extended Taxonomy DB Storage
       *
       * @method setup_theme_features
       * @for Extended_Taxonomies
       */
      public function setup_theme_features() {
        global $wpdb;

        if ( current_theme_supports( &#x27;extended-taxonomies&#x27; ) ) {
          $wpdb-&gt;taxonomymeta = $wpdb-&gt;prefix . &#x27;taxonomymeta&#x27;;
        }

      }

      /**
       * Install Module on Flawless Version Change
       *
       * @method install
       * @for Extended_Taxonomies
       *
       * @param $query_arg
       * @param $flawless
       */
      public function install( $query_arg, $flawless ) {
        global $wpdb;

        if ( current_theme_supports( &#x27;extended-taxonomies&#x27; ) &amp;&amp; $wpdb-&gt;taxonomymeta ) {

          $sql = &quot;CREATE TABLE {$wpdb-&gt;taxonomymeta} (
          meta_id bigint(20) unsigned NOT NULL auto_increment,
          taxonomy_id bigint(20) unsigned NOT NULL default &#x27;0&#x27;,
          meta_key varchar(255) default NULL,
          meta_value longtext,
          PRIMARY KEY  (meta_id),
          KEY taxonomy_id (taxonomy_id),
          KEY meta_key (meta_key)
        ) $charset_collate;&quot;;

          dbDelta( $sql );

        }

      }

      /**
       * Renders extra fields on term editing pages.
       *
       * @todo fix issue w/ content submitted by the_editor being overwritten by description field by filter.
       * @author potanin@UD
       */
      static function taxonomy_edit_form_fields( $tag, $taxonomy ) {
        global $post_ID;

        $_post_ID = $post_ID;

        $post = get_post_for_extended_term( $tag, $tag-&gt;taxonomy );

        if ( !$post ) {
          return;
        }

        $post_ID = $post-&gt;ID;

        do_action( &#x27;flawless::extended_term_form_fields&#x27;, $tag, $post );

        if ( !$post-&gt;ID ) {
          return;
        }

        ?&gt;

        &lt;tr class=&quot;form-field hidden&quot;&gt;
        &lt;th scope=&quot;row&quot; valign=&quot;top&quot;&gt;&lt;/th&gt;
        &lt;td&gt;
          &lt;input type=&quot;hidden&quot; name=&quot;extended_post_id&quot; value=&quot;&lt;?php echo esc_attr( $post-&gt;ID ) ?&gt;&quot;/&gt;
          &lt;input type=&quot;hidden&quot; name=&quot;post_data[ID]&quot; value=&quot;&lt;?php echo esc_attr( $post-&gt;ID ) ?&gt;&quot;/&gt;
          &lt;a class=&quot;button&quot; target=&quot;_blank&quot;
            href=&quot;&lt;?php echo get_edit_post_link( $post-&gt;ID ); ?&gt;&quot;&gt;&lt;?php _e( &#x27;Open Advanced Editor&#x27;, &#x27;flawless&#x27; ); ?&gt;&lt;/a&gt;
        &lt;/td&gt;
      &lt;/tr&gt;

        &lt;?php if ( current_user_can( &#x27;upload_files&#x27; ) ) { ?&gt;
          &lt;tr class=&quot;form-field&quot;&gt;
          &lt;th scope=&quot;row&quot; valign=&quot;top&quot;&gt;&lt;?php _e( &#x27;Images&#x27;, &#x27;flawless&#x27; ); ?&gt;&lt;/th&gt;
          &lt;td&gt;
            &lt;iframe style=&quot;width: 100%;height: 400px&quot; src=&quot;&lt;?php echo get_upload_iframe_src(); ?&gt;&quot;&gt;&lt;/iframe&gt;
          &lt;/td&gt;
        &lt;/tr&gt;
        &lt;?php } ?&gt;

        &lt;?php

        $post_ID = $_post_ID;

      }

      /**
       * When Term Meta is enabled, this is Management displayed on Taxonomy Edit pages before the Add New form.
       *
       * @todo Implement a dynamic table for addition of meta keys and selection of input types. - potanin@UD
       * @author potanin@UD
       */
      static function taxonomy_pre_add_form( $taxonomy ) {
        global $flawless;

        if ( !current_user_can( &#x27;manage_options&#x27; ) ) {
          return;
        }

        $tax = get_taxonomy( $taxonomy );

        return;

        ?&gt;

        &lt;div class=&quot;form-wrap&quot;&gt;
      &lt;h3&gt;&lt;?php _e( &#x27;Taxonomy Meta&#x27; ); ?&gt;&lt;/h3&gt;

      &lt;form id=&quot;addtag&quot; method=&quot;post&quot; action=&quot;#&quot; class=&quot;validate&quot;&gt;

        &lt;table class=&quot;widefat wpp_something_advanced_wrapper ud_ui_dynamic_table&quot; sortable_table=&quot;true&quot;
          allow_random_slug=&quot;false&quot;&gt;
          &lt;tbody&gt;
          &lt;?php foreach ( (array) $flawless[ &#x27;business_card&#x27; ][ &#x27;data&#x27; ] as $slug =&gt; $data ) { ?&gt;
            &lt;tr
              class=&quot;flawless_dynamic_table_row &lt;?php echo( $data[ &#x27;locked&#x27; ] == &#x27;true&#x27; ? &#x27;flawless_locked_row&#x27; : &#x27;&#x27; ); ?&gt;&quot;
              slug=&quot;&lt;?php echo $slug; ?&gt;&quot; new_row=&quot;false&quot;
              lock_row=&quot;&lt;?php echo( $data[ &#x27;locked&#x27; ] == &#x27;true&#x27; ? &#x27;true&#x27; : &#x27;false&#x27; ); ?&gt;&quot;&gt;
              &lt;th&gt;
                &lt;div class=&quot;delete_icon flawless_delete_row&quot; verify_action=&quot;true&quot;&gt;&lt;/div&gt;
                &lt;input type=&quot;text&quot; id=&quot;flawless_card_&lt;?php echo $slug; ?&gt;&quot; class=&quot;slug_setter&quot;
                  name=&quot;flawless_settings[business_card][data][&lt;?php echo $slug; ?&gt;][label]&quot;
                  value=&quot;&lt;?php echo $data[ &#x27;label&#x27; ]; ?&gt;&quot;/&gt;
              &lt;/th&gt;
              &lt;td class=&quot;draggable_col&quot;&gt;
                &lt;input type=&quot;text&quot; id=&quot;flawless_card_&lt;?php echo $slug; ?&gt;&quot;
                  name=&quot;flawless_settings[business_card][data][&lt;?php echo $slug; ?&gt;][label]&quot;
                  value=&quot;&lt;?php echo $data[ &#x27;label&#x27; ]; ?&gt;&quot;/&gt;
              &lt;/td&gt;
            &lt;/tr&gt;
          &lt;?php } ?&gt;
          &lt;/tbody&gt;
          &lt;tfoot&gt;
          &lt;tr&gt;
            &lt;td colspan=&#x27;2&#x27;&gt;&lt;input type=&quot;button&quot; class=&quot;flawless_add_row button-secondary&quot;
                value=&quot;&lt;?php _e( &#x27;Add Row&#x27;, &#x27;flawless&#x27; ) ?&gt;&quot;/&gt;&lt;/td&gt;
          &lt;/tr&gt;
          &lt;/tfoot&gt;
        &lt;/table&gt;

        &lt;?php submit_button( &#x27;Save&#x27;, &#x27;button&#x27; ); ?&gt;
      &lt;/form&gt;
    &lt;/div&gt;

      &lt;?php

      }

      /**
       * Prevents direct editing of Extended Term post pages by redirecting user to term page.
       *
       * @since 0.5.0
       */
      static function post_editor_loader() {

        if ( !is_numeric( $_GET[ &#x27;post&#x27; ] ) ) {
          return;
        }

        $extended_term_id       = get_post_meta( $_GET[ &#x27;post&#x27; ], &#x27;extended_term_id&#x27;, true );
        $extended_term_taxonomy = get_post_meta( $_GET[ &#x27;post&#x27; ], &#x27;extended_term_taxonomy&#x27;, true );

        if ( $extended_term_id &amp;&amp; $extended_term_taxonomy ) {
          die( wp_redirect( get_edit_term_link( $extended_term_id, $extended_term_taxonomy ) ) );
        }

      }

      /**
       * Pre-header loader for Term Editor, when Extended Taxonomies are enabled.
       *
       * @since 0.5.0
       */
      static function term_editor_loader() {
        global $taxnow, $wpdb;

        $tax    = get_taxonomy( $taxnow );
        $tag_ID = (int) $_REQUEST[ &#x27;tag_ID&#x27; ];

        if ( $_GET[ &#x27;action&#x27; ] == &#x27;edit&#x27; &amp;&amp; is_numeric( $tag_ID ) ) {
          Flawless::term_updated( $tag_ID );
        }

        if ( $_POST[ &#x27;action&#x27; ] == &#x27;editedtag&#x27; &amp;&amp; $_POST[ &#x27;extended_post_id&#x27; ] ) {

          check_admin_referer( &#x27;update-tag_&#x27; . $tag_ID );

          if ( !current_user_can( $tax-&gt;cap-&gt;edit_terms ) ) {
            wp_die( __( &#x27;Cheatin&amp;#8217; uh?&#x27; ) );
          }

          $post_id = $_POST[ &#x27;extended_post_id&#x27; ];

          if ( current_user_can( &#x27;edit_post&#x27;, $post_id ) ) {
            foreach ( (array) $_POST[ &#x27;post_data&#x27; ] as $meta_key =&gt; $meta_value ) {
              $wpdb-&gt;update( $wpdb-&gt;posts, array( $meta_key =&gt; $meta_value ), array( &#x27;ID&#x27; =&gt; $post_id ) );
            }
          }

          foreach ( (array) $_POST[ &#x27;post_meta&#x27; ] as $meta_key =&gt; $meta_value ) {
            if ( !empty( $meta_value ) ) {
              update_term_meta( $tag_ID, $meta_key, $meta_value );
            } else {
              delete_term_meta( $tag_ID, $meta_key );
            }

          }

        }

      }

      /**
       * Triggered on term update and creation when Extended Taxonomies are supported.
       *
       * Hooked into: wp_insert_post, edit_term, created_term, deleted_term.
       *
       * @since 0.5.0
       */
      static function term_updated( $term_id, $maybe_post = false, $maybe_taxonomy = false ) {
        global $wpdb;

        //** Determine if this is an post update */
        if ( is_object( $maybe_post ) &amp;&amp; is_numeric( $maybe_post-&gt;ID ) ) {

          //**  Verify if this is an auto save routine.  */
          if ( ( defined( &#x27;DOING_AUTOSAVE&#x27; ) &amp;&amp; DOING_AUTOSAVE ) || wp_is_post_revision( $maybe_post ) ) {
            return $term_id;
          }

          $post_term_id = get_post_meta( $maybe_post-&gt;ID, &#x27;extended_term_id&#x27;, true );

          if ( !$post_term_id ) {
            return;
          }

          $term_update = wp_update_term( $post_term_id, str_replace( &#x27;_tp_&#x27;, &#x27;&#x27;, $maybe_post-&gt;post_type ), array(
            &#x27;name&#x27;        =&gt; $maybe_post-&gt;post_title,
            &#x27;description&#x27; =&gt; $maybe_post-&gt;post_excerpt
          ) );

          remove_filter( &#x27;created_term&#x27;, array( __CLASS__, &#x27;term_updated&#x27; ), 9 );
          remove_filter( &#x27;edit_term&#x27;, array( __CLASS__, &#x27;term_updated&#x27; ), 9 );

          return;

        }

        //** Must be a term creation / update */
        if ( !$maybe_post &amp;&amp; $_GET[ &#x27;taxonomy&#x27; ] ) {

          $term = $wpdb-&gt;get_row( &quot;SELECT name, taxonomy, tt.description, tt.term_id, slug FROM {$wpdb-&gt;term_taxonomy} tt LEFT JOIN {$wpdb-&gt;terms} t on tt.term_id = t.term_id WHERE tt.term_id = &#x27;{$term_id}&#x27;&quot; );
          $post = get_post_for_extended_term( $term_id, $_GET[ &#x27;taxonomy&#x27; ] );

          //** Prevent the term_updated filter from running again (endless loop */
          remove_filter( &#x27;wp_insert_post&#x27;, array( __CLASS__, &#x27;term_updated&#x27; ), 9 );

          $post_id = wp_insert_post( array(
            &#x27;ID&#x27;           =&gt; $post-&gt;ID,
            &#x27;post_status&#x27;  =&gt; &#x27;publish&#x27;,
            &#x27;post_title&#x27;   =&gt; wp_strip_all_tags( $term-&gt;name ),
            &#x27;post_type&#x27;    =&gt; &#x27;_tp_&#x27; . $term-&gt;taxonomy,
            &#x27;post_excerpt&#x27; =&gt; $term-&gt;description,
            &#x27;post_content&#x27; =&gt; $post-&gt;post_content,
            &#x27;post_name&#x27;    =&gt; $term-&gt;slug
          ), true );

          if ( !is_wp_error( $post_id ) ) {
            update_post_meta( $post_id, &#x27;extended_term_id&#x27;, $term_id );
            update_post_meta( $post_id, &#x27;extended_term_taxonomy&#x27;, $term-&gt;taxonomy );
          }
        }

      }

      /**
       * Delete Extended Taxonomy post.
       *
       * @since 0.5.0
       */
      static function delete_term( $term_id, $tt_id, $taxonomy ) {
        global $wpdb;

        $post_id = $wpdb-&gt;get_var( &quot;SELECT ID FROM {$wpdb-&gt;posts} WHERE post_type = &#x27;{$taxonomy}&#x27; AND post_name = &#x27;{$term_id}&#x27;&quot; );

        if ( $post_id ) {
          wp_delete_post( $post_id, true );
        }

      }

    }

  }

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
