<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core/modules/cdn-media/lib/Bjork/bjork/core/mail/message.php - wp-flawless</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://a3d72a45d111006ec192-ec5b80a12b0b09b4d52373336afb4254.r80.cf1.rackcdn.com/usability-dynamics.png" title="wp-flawless"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/API.html">API</a></li>
            
                <li><a href="../classes/Carrington.html">Carrington</a></li>
            
                <li><a href="../classes/Extended_Taxonomies.html">Extended_Taxonomies</a></li>
            
                <li><a href="../classes/Flawless.API.html">Flawless.API</a></li>
            
                <li><a href="../classes/Flawless.Asset.html">Flawless.Asset</a></li>
            
                <li><a href="../classes/Flawless.Branded_Login.html">Flawless.Branded_Login</a></li>
            
                <li><a href="../classes/Flawless.BuddyPress.html">Flawless.BuddyPress</a></li>
            
                <li><a href="../classes/Flawless.Content.html">Flawless.Content</a></li>
            
                <li><a href="../classes/Flawless.Element.html">Flawless.Element</a></li>
            
                <li><a href="../classes/Flawless.Flawless\Shortcode.html">Flawless.Flawless\Shortcode</a></li>
            
                <li><a href="../classes/Flawless.Management.html">Flawless.Management</a></li>
            
                <li><a href="../classes/Flawless.Mobile.html">Flawless.Mobile</a></li>
            
                <li><a href="../classes/Flawless.Navbars.html">Flawless.Navbars</a></li>
            
                <li><a href="../classes/Flawless.Schema.html">Flawless.Schema</a></li>
            
                <li><a href="../classes/Flawless.Settings.html">Flawless.Settings</a></li>
            
                <li><a href="../classes/Flawless.Styles.html">Flawless.Styles</a></li>
            
                <li><a href="../classes/Flawless.Utility.html">Flawless.Utility</a></li>
            
                <li><a href="../classes/Flawless.Widget.html">Flawless.Widget</a></li>
            
                <li><a href="../classes/flawless_wpp_extensions.html">flawless_wpp_extensions</a></li>
            
                <li><a href="../classes/Legacy.html">Legacy</a></li>
            
                <li><a href="../classes/License.html">License</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/Log.html">Log</a></li>
            
                <li><a href="../classes/Maintenance.html">Maintenance</a></li>
            
                <li><a href="../classes/Models.html">Models</a></li>
            
                <li><a href="../classes/Module.html">Module</a></li>
            
                <li><a href="../classes/Multisite.html">Multisite</a></li>
            
                <li><a href="../classes/SaaS.html">SaaS</a></li>
            
                <li><a href="../classes/Shortcode.html">Shortcode</a></li>
            
                <li><a href="../classes/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../classes/Template Methods.html">Template Methods</a></li>
            
                <li><a href="../classes/Theme.html">Theme</a></li>
            
                <li><a href="../classes/UI.html">UI</a></li>
            
                <li><a href="../classes/Utility.html">Utility</a></li>
            
                <li><a href="../classes/Views.html">Views</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/API.html">API</a></li>
            
                <li><a href="../modules/Branded Login.html">Branded Login</a></li>
            
                <li><a href="../modules/Carrington.html">Carrington</a></li>
            
                <li><a href="../modules/Carrington Build.html">Carrington Build</a></li>
            
                <li><a href="../modules/carrington-build.html">carrington-build</a></li>
            
                <li><a href="../modules/cfct_build.html">cfct_build</a></li>
            
                <li><a href="../modules/default.html">default</a></li>
            
                <li><a href="../modules/Flawless.html">Flawless</a></li>
            
                <li><a href="../modules/Loader.html">Loader</a></li>
            
                <li><a href="../modules/Log.html">Log</a></li>
            
                <li><a href="../modules/Maintenence.html">Maintenence</a></li>
            
                <li><a href="../modules/Management.html">Management</a></li>
            
                <li><a href="../modules/Multisite.html">Multisite</a></li>
            
                <li><a href="../modules/SaaS.html">SaaS</a></li>
            
                <li><a href="../modules/Services_JSON.html">Services_JSON</a></li>
            
                <li><a href="../modules/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../modules/taxonomy-landing

This file is part of Taxonomy Landing for WordPress
http:__github.com_crowdfavorite_wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http:__crowdfavorite.com

Released under the GPL license
http:__www.opensource.org_licenses_gpl-license.php

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************.html">taxonomy-landing

This file is part of Taxonomy Landing for WordPress
http://github.com/crowdfavorite/wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http://crowdfavorite.com

Released under the GPL license
http://www.opensource.org/licenses/gpl-license.php

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************</a></li>
            
                <li><a href="../modules/taxonomy-landing

This file is part of Taxonomy Landing for WordPress
https:__github.com_crowdfavorite_wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http:__crowdfavorite.com

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************.html">taxonomy-landing

This file is part of Taxonomy Landing for WordPress
https://github.com/crowdfavorite/wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http://crowdfavorite.com

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************</a></li>
            
                <li><a href="../modules/Theme UI.html">Theme UI</a></li>
            
                <li><a href="../modules/UI.html">UI</a></li>
            
                <li><a href="../modules/UsabilityDynamics.html">UsabilityDynamics</a></li>
            
                <li><a href="../modules/Utility.html">Utility</a></li>
            
                <li><a href="../modules/Views.html">Views</a></li>
            
                <li><a href="../modules/WP-Property.html">WP-Property</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: core/modules/cdn-media/lib/Bjork/bjork/core/mail/message.php</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&lt;?php

namespace bjork\core\mail\message;

use strutils;
use email\header\Header,
    email\charset,
    email\encoders,
    email\mime,
    email\utils as email_utils;

use bjork\conf\settings,
    bjork\core\mail,
    bjork\core\mail\utils as mail_utils;

// Don&#x27;t BASE64-encode UTF-8 messages so that we avoid
// unwanted attention from some spam filters.
charset::add_charset(&#x27;utf-8&#x27;, charset::SHORTEST, null, &#x27;utf-8&#x27;);

// Default MIME type to use on attachments (if it is not explicitly given)
const DEFAULT_ATTACHMENT_MIME_TYPE = &#x27;application/octet-stream&#x27;;

/**
* A container for email information.
*/
class EmailMessage {
    
    protected
        $content_subtype = &#x27;plain&#x27;,
        $mixed_subtype = &#x27;mixed&#x27;,
        $encoding = null; // use settings default
    
    var $subject, $body,
        $from_email,
        $to, $cc, $bcc,
        $attachments, $headers,
        $connection;
    
    function __construct($subject=&#x27;&#x27;, $body=&#x27;&#x27;, $from_email=null, $to=null,
            array $headers=null, array $options=null, $connection=null)
    {
        extract(get_options_with_defaults($options, array(
            &#x27;cc&#x27; =&gt; array(),
            &#x27;bcc&#x27; =&gt; array(),
            &#x27;attachments&#x27; =&gt; array(),
        )));
        
        if (null === $from_email)
            $from_email = settings::get(&#x27;DEFAULT_FROM_EMAIL&#x27;);
        
        if (is_string($to))
            $to = array($to);
        
        if (!is_array($to)) throw new \Exception(&#x27;&#x60;to&#x60; must be an array&#x27;);
        if (!is_array($cc)) throw new \Exception(&#x27;&#x60;cc&#x60; must be an array&#x27;);
        if (!is_array($bcc)) throw new \Exception(&#x27;&#x60;bcc&#x60; must be an array&#x27;);
        
        if (!$headers) $headers = array();
        if (!$attachments) $attachments = array();
        
        $this-&gt;subject = $subject;
        $this-&gt;body = $body;
        $this-&gt;from_email = $from_email;
        $this-&gt;to = $to;
        $this-&gt;cc = $cc;
        $this-&gt;bcc = $bcc;
        $this-&gt;headers = $headers;
        $this-&gt;attachments = $attachments;
        $this-&gt;connection = $connection;
    }
    
    public function getConnection($fail_silently=false) {
        if (null === $this-&gt;connection)
            $this-&gt;connection = mail::get_connection($fail_silently);
        return $this-&gt;connection;
    }
    
    public function getContentSubtype() {
        return $this-&gt;content_subtype;
    }
    
    public function setContentSubtype($subtype) {
        $this-&gt;content_subtype = $subtype;
    }
    
    public function getEncoding() {
        return $this-&gt;encoding;
    }
    
    public function setEncoding($encoding) {
        $this-&gt;encoding = $encoding;
    }
    
    public function getMessage() {
        $encoding = $this-&gt;encoding ?: settings::get(&#x27;DEFAULT_CHARSET&#x27;);
        $msg = new SafeMIMEText($this-&gt;body, $this-&gt;content_subtype, $encoding);
        $msg = $this-&gt;createMessage($msg);
        $msg[&#x27;Subject&#x27;] = $this-&gt;subject;
        $msg[&#x27;From&#x27;] = array_key_exists(&#x27;From&#x27;, $this-&gt;headers)
            ? $this-&gt;headers[&#x27;From&#x27;]
            : $this-&gt;from_email;
        $msg[&#x27;To&#x27;] = implode(&#x27;, &#x27;, $this-&gt;to);
        if ($this-&gt;cc)
            $msg[&#x27;Cc&#x27;] = implode(&#x27;, &#x27;, $this-&gt;cc);
        
        // Email header names are case-insensitive (RFC 2045), so we have to
        // accommodate that when doing comparisons.
        $header_names = array_map(&#x27;strtolower&#x27;, array_keys($this-&gt;headers));
        if (!in_array(&#x27;date&#x27;, $header_names))
            $msg[&#x27;Date&#x27;] = email_utils::formatdate(null, true);
        if (!in_array(&#x27;message-id&#x27;, $header_names))
            $msg[&#x27;Message-ID&#x27;] = email_utils::make_msgid();
        foreach ($this-&gt;headers as $name =&gt; $value) {
            if (strtolower($name) == &#x27;from&#x27;)
                continue;
            $msg[$name] = $value;
        }
        return $msg;
    }
    
    public function getFromEmail() {
        return $this-&gt;from_email;
    }
    
    public function getRecipients() {
        return array_merge($this-&gt;to, $this-&gt;cc, $this-&gt;bcc);
    }
    
    public function send($fail_silently=false) {
        if (!$this-&gt;getRecipients())
            return 0;
        return $this-&gt;getConnection($fail_silently)-&gt;sendMessages(array($this));
    }
    
    /**
    * Attaches a file with the given filename and content. The filename can
    * be omitted and the mimetype is guessed, if not provided.
    *
    * If the first parameter is a MIMEBase subclass it is inserted directly
    * into the resulting message attachments.
    */
    public function attach($filename=null, $content=null, $mimetype=null) {
        if ($filename instanceof mime\MIMEBase)
            $this-&gt;attachments[] = $filename;
        else
            $this-&gt;attachments[] = array($filename, $content, $mimetype);
    }
    
    /**
    * Attaches a file from the filesystem.
    */
    public function attachFile($path, $mimetype=null) {
        $filename = basename($path);
        $content = file_get_contents($path);
        $this-&gt;attach($filename, $content, $mimetype);
    }
    
    protected function createMessage($msg) {
        return $this-&gt;createAttachments($msg);
    }
    
    protected function createAttachments($msg) {
        if ($this-&gt;attachments) {
            $encoding = $this-&gt;encoding ?: settings::get(&#x27;DEFAULT_CHARSET&#x27;);
            $body_msg = $msg;
            $msg = new SafeMIMEMultipart($this-&gt;mixed_subtype, $encoding);
            if ($this-&gt;body)
                $msg-&gt;attach($body_msg);
            foreach ($this-&gt;attachments as $attachment) {
                if ($attachment instanceof mime\MIMEBase)
                    $msg-&gt;attach($attachment);
                else
                    $msg-&gt;attach($this-&gt;createAttachment(
                        $attachment[0], $attachment[1], $attachment[2]));
            }
        }
        return $msg;
    }
    
    protected function createAttachment($filename, $content, $mimetype=null) {
        if (!$mimetype)
            $mimetype = DEFAULT_ATTACHMENT_MIME_TYPE;
        $attachment = $this-&gt;createMIMEAttachment($content, $mimetype);
        if ($filename)
            $attachment-&gt;addHeader(&#x27;Content-Disposition&#x27;, &#x27;attachment&#x27;, array(
                &#x27;filename&#x27; =&gt; $filename,
            ));
        return $attachment;
    }
    
    protected function createMIMEAttachment($content, $mimetype) {
        list($basetype, $subtype) = strutils::split($mimetype, &#x27;/&#x27;, 1);
        if ($basetype == &#x27;text&#x27;) {
            $encoding = $this-&gt;encoding ?: settings::get(&#x27;DEFAULT_CHARSET&#x27;);
            $attachment = new SafeMIMEText($content, $subtype, $encoding);
        } else {
            $attachment = new mime\MIMEBase($basetype, $subtype);
            $attachment-&gt;setPayload($content);
            encoders::encode_base64($attachment);
        }
        return $attachment;
    }
}

/**
* A version of EmailMessage that makes it easy to send multipart/alternative
* messages. For example, including text and HTML versions of the text is
* made easier.
*/
class EmailMultiAlternatives extends EmailMessage {
    
    protected $alternative_subtype = &#x27;alternative&#x27;;
    
    var $alternatives;
    
    function __construct($subject=&#x27;&#x27;, $body=&#x27;&#x27;, $from_email=null, $to=null,
            array $headers=null, array $options=null, $connection=null)
    {
        if (!$options)
            $options = array();
        
        if (array_key_exists(&#x27;alternatives&#x27;, $options)) {
            $this-&gt;alternatives = $options[&#x27;alternatives&#x27;];
            unset($options[&#x27;alternatives&#x27;]);
        } else {
            $this-&gt;alternatives = array();
        }
        
        parent::__construct($subject, $body, $from_email, $to, $headers,
            $options, $connection);
    }
    
    /**
    * Attach an alternative content representation.
    */
    public function attachAlternative($content, $mimetype) {
        $this-&gt;alternatives[] = array($content, $mimetype);
    }
    
    protected function createMessage($msg) {
        return $this-&gt;createAttachments($this-&gt;createAlternatives($msg));
    }
    
    protected function createAlternatives($msg) {
        $encoding = $this-&gt;encoding ?: settings::get(&#x27;DEFAULT_CHARSET&#x27;);
        if ($this-&gt;alternatives) {
            $body_msg = $msg;
            $msg = new SafeMIMEMultipart($this-&gt;alternative_subtype, $encoding);
            if ($this-&gt;body)
                $msg-&gt;attach($body_msg);
            foreach ($this-&gt;alternatives as $alternative)
                $msg-&gt;attach($this-&gt;createMIMEAttachment($alternative[0], $alternative[1]));
        }
        return $msg;
    }
}

class SafeMIMEText extends mime\MIMEText {
    protected $encoding;
    
    function __construct($text, $subtype, $charset) {
        $this-&gt;encoding = $charset;
        parent::__construct($text, $subtype, $charset);
    }
    
    function offsetSet($name, $val) {
        list($name, $val) = mail_utils::forbid_multi_line_headers(
            $name, $val, $this-&gt;encoding);
        parent::offsetSet($name, $val);
    }
}

class SafeMIMEMultipart extends mime\MIMEMultipart {
    protected $encoding;
    
    function __construct($subtype=&#x27;mixed&#x27;, $encoding=null, $boundary=null,
                         $subparts=null, array $params=null)
    {
        $this-&gt;encoding = $encoding;
        parent::__construct($subtype, $boundary, $subparts, $params);
    }
    
    function offsetSet($name, $val) {
        list($name, $val) = mail_utils::forbid_multi_line_headers(
            $name, $val, $this-&gt;encoding);
        parent::offsetSet($name, $val);
    }
}

function get_options_with_defaults($options, array $defaults) {
    if (null === $options)
        $options = array();
    return array_merge($defaults, $options);
}

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
