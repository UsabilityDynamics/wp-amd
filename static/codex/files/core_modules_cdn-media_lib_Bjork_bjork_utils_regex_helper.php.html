<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core/modules/cdn-media/lib/Bjork/bjork/utils/regex_helper.php - wp-flawless</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://a3d72a45d111006ec192-ec5b80a12b0b09b4d52373336afb4254.r80.cf1.rackcdn.com/usability-dynamics.png" title="wp-flawless"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/API.html">API</a></li>
            
                <li><a href="../classes/Carrington.html">Carrington</a></li>
            
                <li><a href="../classes/Extended_Taxonomies.html">Extended_Taxonomies</a></li>
            
                <li><a href="../classes/Flawless.API.html">Flawless.API</a></li>
            
                <li><a href="../classes/Flawless.Asset.html">Flawless.Asset</a></li>
            
                <li><a href="../classes/Flawless.Branded_Login.html">Flawless.Branded_Login</a></li>
            
                <li><a href="../classes/Flawless.BuddyPress.html">Flawless.BuddyPress</a></li>
            
                <li><a href="../classes/Flawless.Content.html">Flawless.Content</a></li>
            
                <li><a href="../classes/Flawless.Element.html">Flawless.Element</a></li>
            
                <li><a href="../classes/Flawless.Flawless\Shortcode.html">Flawless.Flawless\Shortcode</a></li>
            
                <li><a href="../classes/Flawless.Management.html">Flawless.Management</a></li>
            
                <li><a href="../classes/Flawless.Mobile.html">Flawless.Mobile</a></li>
            
                <li><a href="../classes/Flawless.Navbars.html">Flawless.Navbars</a></li>
            
                <li><a href="../classes/Flawless.Schema.html">Flawless.Schema</a></li>
            
                <li><a href="../classes/Flawless.Settings.html">Flawless.Settings</a></li>
            
                <li><a href="../classes/Flawless.Styles.html">Flawless.Styles</a></li>
            
                <li><a href="../classes/Flawless.Utility.html">Flawless.Utility</a></li>
            
                <li><a href="../classes/Flawless.Widget.html">Flawless.Widget</a></li>
            
                <li><a href="../classes/flawless_wpp_extensions.html">flawless_wpp_extensions</a></li>
            
                <li><a href="../classes/Legacy.html">Legacy</a></li>
            
                <li><a href="../classes/License.html">License</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/Log.html">Log</a></li>
            
                <li><a href="../classes/Maintenance.html">Maintenance</a></li>
            
                <li><a href="../classes/Models.html">Models</a></li>
            
                <li><a href="../classes/Module.html">Module</a></li>
            
                <li><a href="../classes/Multisite.html">Multisite</a></li>
            
                <li><a href="../classes/SaaS.html">SaaS</a></li>
            
                <li><a href="../classes/Shortcode.html">Shortcode</a></li>
            
                <li><a href="../classes/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../classes/Template Methods.html">Template Methods</a></li>
            
                <li><a href="../classes/Theme.html">Theme</a></li>
            
                <li><a href="../classes/UI.html">UI</a></li>
            
                <li><a href="../classes/Utility.html">Utility</a></li>
            
                <li><a href="../classes/Views.html">Views</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/API.html">API</a></li>
            
                <li><a href="../modules/Branded Login.html">Branded Login</a></li>
            
                <li><a href="../modules/Carrington.html">Carrington</a></li>
            
                <li><a href="../modules/Carrington Build.html">Carrington Build</a></li>
            
                <li><a href="../modules/carrington-build.html">carrington-build</a></li>
            
                <li><a href="../modules/cfct_build.html">cfct_build</a></li>
            
                <li><a href="../modules/default.html">default</a></li>
            
                <li><a href="../modules/Flawless.html">Flawless</a></li>
            
                <li><a href="../modules/Loader.html">Loader</a></li>
            
                <li><a href="../modules/Log.html">Log</a></li>
            
                <li><a href="../modules/Maintenence.html">Maintenence</a></li>
            
                <li><a href="../modules/Management.html">Management</a></li>
            
                <li><a href="../modules/Multisite.html">Multisite</a></li>
            
                <li><a href="../modules/SaaS.html">SaaS</a></li>
            
                <li><a href="../modules/Services_JSON.html">Services_JSON</a></li>
            
                <li><a href="../modules/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../modules/taxonomy-landing

This file is part of Taxonomy Landing for WordPress
http:__github.com_crowdfavorite_wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http:__crowdfavorite.com

Released under the GPL license
http:__www.opensource.org_licenses_gpl-license.php

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************.html">taxonomy-landing

This file is part of Taxonomy Landing for WordPress
http://github.com/crowdfavorite/wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http://crowdfavorite.com

Released under the GPL license
http://www.opensource.org/licenses/gpl-license.php

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************</a></li>
            
                <li><a href="../modules/taxonomy-landing

This file is part of Taxonomy Landing for WordPress
https:__github.com_crowdfavorite_wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http:__crowdfavorite.com

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************.html">taxonomy-landing

This file is part of Taxonomy Landing for WordPress
https://github.com/crowdfavorite/wp-taxonomy-landing

Copyright (c) 2009-2012 Crowd Favorite, Ltd. All rights reserved.
http://crowdfavorite.com

**********************************************************************
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
**********************************************************************</a></li>
            
                <li><a href="../modules/Theme UI.html">Theme UI</a></li>
            
                <li><a href="../modules/UI.html">UI</a></li>
            
                <li><a href="../modules/UsabilityDynamics.html">UsabilityDynamics</a></li>
            
                <li><a href="../modules/Utility.html">Utility</a></li>
            
                <li><a href="../modules/Views.html">Views</a></li>
            
                <li><a href="../modules/WP-Property.html">WP-Property</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: core/modules/cdn-media/lib/Bjork/bjork/utils/regex_helper.php</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&lt;?php

/**
* Functions for reversing a regular expression (used in reverse URL resolving).
* Used internally by Django and not intended for external use.
* 
* This is not, and is not intended to be, a complete reg-exp decompiler. It
* should be good enough for a large class of URLS, however.
*/

namespace bjork\utils {

final class regex_helper {
    public static function normalize($pattern) {
        return regex_helper\normalize($pattern);
    }
}

}

namespace bjork\utils\regex_helper {

use strutils;

use bjork\utils\datastructures\List_,
    bjork\utils\datastructures\IndexError;

class NotImplementedError extends \Exception {}
class StopIteration extends IndexError {}

/**
* Used to represent multiple possibilities at this point in a pattern string.
* We use a distinguished type, rather than a list, so that the usage in the
* code is clear.
*/
class Choice extends List_ {}
const ChoiceClass = &#x27;bjork\utils\regex_helper\Choice&#x27;;

/**
* Used to represent a capturing group in the pattern string.
*/
class Group extends List_ {}
const GroupClass = &#x27;bjork\utils\regex_helper\Group&#x27;;

/**
* Used to represent a non-capturing group in the pattern string.
*/
class NonCapture extends List_ {}
const NonCaptureClass = &#x27;bjork\utils\regex_helper\NonCapture&#x27;;

/**
* Given a reg-exp pattern, normalizes it to a list of forms that suffice for
* reverse matching. This does the following:
* 
* (1) For any repeating sections, keeps the minimum number of occurrences
*     permitted (this means zero for optional groups).
* (2) If an optional group includes parameters, include one occurrence of
*     that group (along with the zero occurrence case from step (1)).
* (3) Select the first (essentially an arbitrary) element from any character
*     class. Select an arbitrary character for any unordered class (e.g. &#x27;.&#x27;
*     or &#x27;\w&#x27;) in the pattern.
* (5) Ignore comments and any of the reg-exp flags that won&#x27;t change
*     what we construct (&quot;iLmsu&quot;). &quot;(?x)&quot; is an error, however.
* (6) Raise an error on all other non-capturing (?...) forms (e.g.
*     look-ahead and look-behind matches) and any disjunctive (&#x27;|&#x27;)
*     constructs.
* 
* Django&#x27;s URLs for forward resolving are either all positional arguments or
* all keyword arguments. That is assumed here, as well. Although reverse
* resolving can be done using positional args when keyword args are
* specified, the two cannot be mixed in the same reverse() call.
*/
function normalize($pattern) {
    // Do a linear scan to work out the special features of this pattern.
    // The idea is that we scan once here and collect all the information
    // we need to make future decisions.
    $result = new List_();
    $non_capturing_groups = new List_();
    $consume_next = true;
    $pattern_iter = new RegexWalker(strutils::explode($pattern));
    $num_args = 0;
    
    $__empty_result = array(array(&#x27;&#x27;, array()));
    
    // A &quot;while&quot; loop is used here because later on we need to be able to peek
    // at the next character and possibly go around without consuming another
    // one at the top of the loop.
    try {
        list($ch, $escaped) = $pattern_iter-&gt;next();
    } catch (StopIteration $e) {
        return $__empty_result;
    }
    
    try {
        while (true) {
            if ($escaped) {
                $result-&gt;append($ch);
            } else if ($ch == &#x27;.&#x27;) {
                // Replace &quot;any character&quot; with an arbitrary representative.
                $result-&gt;append(&#x27;.&#x27;);
            } else if ($ch == &#x27;|&#x27;) {
                throw new NotImplementedError();
            } else if ($ch == &#x27;^&#x27;) {
                // pass
            } else if ($ch == &#x27;$&#x27;) {
                break;
            } else if ($ch == &#x27;)&#x27;) {
                // This can only be the end of a non-capturing group, since all
                // other unescaped parentheses are handled by the grouping
                // section later (and the full group is handled there).
                // 
                // We regroup everything inside the capturing group so that it
                // can be quantified, if necessary.
                $start = $non_capturing_groups-&gt;pop();
                $inner = new NonCapture($result-&gt;slice($start));
                $r = $result-&gt;slice(0, $start)-&gt;toArray();
                $r[] = $inner;
                $result = new List_($r);
            } else if ($ch == &#x27;[&#x27;) {
                // Replace ranges with the first character in the range.
                list($ch, $escaped) = $pattern_iter-&gt;next();
                $result-&gt;append($ch);
                list($ch, $escaped) = $pattern_iter-&gt;next();
                while ($escaped || $ch != &#x27;]&#x27;)
                    list($ch, $escaped) = $pattern_iter-&gt;next();
            } else if ($ch == &#x27;(&#x27;) {
                // Some kind of group.
                list($ch, $escaped) = $pattern_iter-&gt;next();
                if ($escaped || $ch != &#x27;?&#x27;) {
                    // A positional group
                    $name = &quot;_{$num_args}&quot;;
                    $num_args++;
                    $result-&gt;append(new Group(array(&quot;%({$name})s&quot;, $name)));
                    walk_to_end($ch, $pattern_iter);
                } else {
                    list($ch, $escaped) = $pattern_iter-&gt;next();
                    if (in_array($ch, strutils::explode(&#x27;imsxUXJ#&#x27;))) {
                        // All of these are ignorable. Walk to the end of the
                        // group.
                        walk_to_end($ch, $pattern_iter);
                    } else if ($ch == &#x27;:&#x27;) {
                        // Non-capturing group
                        $non_capturing_groups-&gt;append(count($result));
                    } else if ($ch != &#x27;P&#x27;) {
                        // Anything else, other than a named group, is something
                        // we cannot reverse.
                        throw new \Exception(&quot;Non-reversible reg-exp portion: &#x27;(?{$ch}&#x27;&quot;);
                    } else {
                        list($ch, $escaped) = $pattern_iter-&gt;next();
                        if ($ch != &#x27;&lt;&#x27;)
                            throw new \Exception(&quot;Non-reversible reg-exp portion: &#x27;(?P{$ch}&#x27;&quot;);
                        // We are in a named capturing group. Extract the name
                        // and then skip to the end.
                        $name = array();
                        list($ch, $escaped) = $pattern_iter-&gt;next();
                        while ($ch != &#x27;&gt;&#x27;) {
                            $name[] = $ch;
                            list($ch, $escaped) = $pattern_iter-&gt;next();
                        }
                        $param = implode(&#x27;&#x27;, $name);
                        $result-&gt;append(new Group(array(&quot;%({$param})s&quot;, $param)));
                        walk_to_end($ch, $pattern_iter);
                    }
                }
            } else if (in_array($ch, strutils::explode(&#x27;*?+{&#x27;))) {
                // Quanitifers affect the previous item in the result list.
                list($count, $ch) = get_quantifier($ch, $pattern_iter);
                if ($ch)
                    // We had to look ahead, but it wasn&#x27;t needed to compute
                    // the quanitifer, so use this character next time around
                    // the main loop.
                    $consume_next = false;
                
                $last_index = count($result) - 1;
                if ($count === 0) {
                    if (contains($result[$last_index], GroupClass)) {
                        // If we are quantifying a capturing group (or
                        // something containing such a group) and the minimum is
                        // zero, we must also handle the case of one occurrence
                        // being present. All the quantifiers (except {0,0},
                        // which we conveniently ignore) that have a 0 minimum
                        // also allow a single occurrence.
                        $result[$last_index] = new Choice(array(null, $result[$last_index]));
                    } else {
                        $result-&gt;pop();
                    }
                } else if ($count &gt; 1) {
                    $item = $result[$last_index];
                    $items = new List_(array_fill(0, $count - 1, $item));
                    $result-&gt;extend($items);
                }
            } else {
                // Anything else is a literal
                $result-&gt;append($ch);
            }
            
            if ($consume_next)
                list($ch, $escaped) = $pattern_iter-&gt;next();
            else
                $consume_next = true;
        }
    } catch (StopIteration $e) {
        // pass
    } catch (NotImplementedError $e) {
        // A case of using the disjunctive form. No results for you!
        return $__empty_result;
    }
    
    list($k, $v) = flatten_result($result);
    $out = array_map(null, $k, $v);
    
    return $out;
}

/**
* An iterator that yields the next character from &quot;pattern_iter&quot;, respecting
* escape sequences. An escaped character is replaced by a representative of
* its class (e.g. \w -&gt; &quot;x&quot;). If the escaped character is one that is
* skipped, it is not returned (the next character is returned instead).
* 
* Yields the next character, along with a boolean indicating whether it is a
* raw (unescaped) character or not.
*/
class RegexWalker {
    /**
    * Mapping of an escape character to a representative of that class. So, e.g.,
    * &quot;\w&quot; is replaced by &quot;x&quot; in a reverse URL. A value of None means to ignore
    * this sequence. Any missing key is mapped to itself.
    */
    static $escapeMappings = array(
        &#x27;A&#x27; =&gt; null,
        &#x27;b&#x27; =&gt; null,
        &#x27;B&#x27; =&gt; null,
        &#x27;d&#x27; =&gt; &#x27;0&#x27;,
        &#x27;D&#x27; =&gt; &#x27;x&#x27;,
        &#x27;s&#x27; =&gt; &#x27; &#x27;,
        &#x27;S&#x27; =&gt; &#x27;x&#x27;,
        &#x27;w&#x27; =&gt; &#x27;x&#x27;,
        &#x27;W&#x27; =&gt; &#x27;!&#x27;,
        &#x27;Z&#x27; =&gt; null,
    );
    
    private $position, $array;  
    
    function __construct(array $input) {
        $this-&gt;position = -1;
        $this-&gt;array = $input;
    }
    
    function next() {
        ++$this-&gt;position;
        if (!isset($this-&gt;array[$this-&gt;position]))
            throw new StopIteration();
        $ch = $this-&gt;array[$this-&gt;position];
        if ($ch != &#x27;\\&#x27;)
            return array($ch, false);
        list($ch, $escaped) = $this-&gt;next();
        $representative = self::getRepresentative($ch, $ch);
        if (is_null($representative))
            return $this-&gt;next();
        return array($representative, true);
    }
    
    static function getRepresentative($ch, $default=null) {
        if (isset(self::$escapeMappings[$ch]))
            return self::$escapeMappings[$ch];
        return $default;
    }
}

/**
* The iterator is currently inside a capturing group. We want to walk to the
* close of this group, skipping over any nested groups and handling escaped
* parentheses correctly.
*/
function walk_to_end($ch, RegexWalker $input_iter) {
    if ($ch == &#x27;(&#x27;)
        $nesting = 1;
    else
        $nesting = 0;
    while (true) {
        list($ch, $escaped) = $input_iter-&gt;next();
        if ($escaped)
            continue;
        else if ($ch == &#x27;(&#x27;)
            $nesting++;
        else if ($ch == &#x27;)&#x27;) {
            if (!$nesting)
                return;
            $nesting--;
        }
    }
}

/**
* Parse a quantifier from the input, where &quot;ch&quot; is the first character in the
* quantifier.
* 
* Returns the minimum number of occurences permitted by the quantifier and
* either None or the next character from the input_iter if the next character
* is not part of the quantifier.
*/
function get_quantifier($ch, RegexWalker $input_iter) {
    if (in_array($ch, strutils::explode(&#x27;*?+&#x27;))) {
        try {
            list($ch2, $escaped) = $input_iter-&gt;next();
        } catch (StopIteration $e) {
            $ch2 = null;
        }
        if ($ch2 === &#x27;?&#x27;)
            $ch2 = null;
        if ($ch === &#x27;+&#x27;)
            return array(1, $ch2);
        return array(0, $ch2);
    }
    
    $quant = array();
    while ($ch !== &#x27;}&#x27;) {
        list($ch, $escaped) = $input_iter-&gt;next();
        $quant[] = $ch;
    }
    array_pop($quant);
    $values = explode(&#x27;,&#x27;, implode(&#x27;&#x27;, $quant));
    
    // Consume the trailing &#x27;?&#x27;, if necessary.
    try {
        list($ch, $escaped) = $input_iter-&gt;next();
    } catch (StopIteration $e) {
        $ch = null;
    }
    if ($ch === &#x27;?&#x27;)
        $ch = null;
    return array(intval($values[0], 10), $ch);
}

/**
* Returns True if the &quot;source&quot; contains an instance of &quot;inst&quot;. False,
* otherwise.
*/
function contains($source, $inst) {
    if (is_a($source, $inst))
        return true;
    if ($source instanceof NonCapture) {
        foreach ($source as $elt) {
            if (contains($elt, $inst))
                return true;
        }
    }
    return false;
}

/**
* Turns the given source sequence into a list of reg-exp possibilities and
* their arguments. Returns a list of strings and a list of argument lists.
* Each of the two lists will be of the same length.
*/
function flatten_result($source) {
    $__empty_result = array(
        array(&#x27;&#x27;),
        array(array()),
    );
    
    if (is_null($source))
        return $__empty_result;
    
    if ($source instanceof Group) {
        if (is_null($source[1]))
            $params = array();
        else
            $params = array($source[1]);
        return array(
            array($source[0]),
            array($params),
        );
    }
    $result = array(&#x27;&#x27;);
    $result_args = array(array());
    $pos = 0;
    $last = 0;
    for ($pos = 0; $pos &lt; count($source); $pos++) {
        $elt = $source[$pos];
        if (is_string($elt))
            continue;
        $piece = implode(&#x27;&#x27;, $source-&gt;slice($last, $pos)-&gt;toArray());
        if ($elt instanceof Group) {
            $piece .= $elt[0];
            $param = $elt[1];
        } else {
            $param = null;
        }
        $last = $pos + 1;
        for ($i = 0; $i &lt; count($result); $i++) {
            $result[$i] .= $piece;
            if ($param)
                $result_args[$i][] = $param;
        }
        if ($elt instanceof Choice || $elt instanceof NonCapture) {
            if ($elt instanceof NonCapture)
                $elt = array($elt);
            $inner_result = array();
            $inner_args = array();
            foreach ($elt as $item) {
                list($res, $args) = flatten_result($item);
                array_splice($inner_result, count($inner_result), 0, $res);
                array_splice($inner_args, count($inner_args), 0, $args);
            }
            $new_result = array();
            $new_args = array();
            foreach (array_combine($result, $result_args) as $item =&gt; $args) {
                foreach (array_combine($inner_result, $inner_args) as $i_item =&gt; $i_args) {
                    $new_result[] = $item . $i_item;
                    $args_ = array_merge(array(), $args);
                    $new_args[] = array_merge($args, $i_args);
                }
            }
            $result = $new_result;
            $result_args = $new_args;
        }
    }
    if ($pos &gt;= $last) {
        $piece = implode(&#x27;&#x27;, $source-&gt;slice($last)-&gt;toArray());
        for ($i = 0; $i &lt; count($result); $i++)
            $result[$i] .= $piece;
    }
    return array($result, $result_args);
}

}

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
