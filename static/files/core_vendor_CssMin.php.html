<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core/vendor/CssMin.php - Flawless</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Flawless"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/flawless_wpp_extensions.html">flawless_wpp_extensions</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../classes/Template Functions.html">Template Functions</a></li>
            
                <li><a href="../classes/Theme UI.html">Theme UI</a></li>
            
                <li><a href="../classes/UD_API.html">UD_API</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Core Assets.html">Core Assets</a></li>
            
                <li><a href="../modules/Flawless.html">Flawless</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: core/vendor/CssMin.php</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&lt;?php
/**
 * CssMin - A (simple) css minifier with benefits
 * 
 * --
 * Copyright (c) 2011 Joe Scylla &lt;joe.scylla@gmail.com&gt;
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the &quot;Software&quot;), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * --
 * 
 * @package    CssMin
 * @link    http://code.google.com/p/cssmin/
 * @author    Joe Scylla &lt;joe.scylla@gmail.com&gt;
 * @copyright  2008 - 2011 Joe Scylla &lt;joe.scylla@gmail.com&gt;
 * @license    http://opensource.org/licenses/mit-license.php MIT License
 * @version    3.0.1
 */
 abstract class aCssToken { abstract public function __toString(); } abstract class aCssRulesetStartToken extends aCssToken { } abstract class aCssRulesetEndToken extends aCssToken { public function __toString() { return &quot;}&quot;; } } abstract class aCssParserPlugin { protected $configuration = array(); protected $parser = null; protected $buffer = &quot;&quot;; public function __construct(CssParser $parser, array $configuration = null) { $this-&gt;configuration = $configuration; $this-&gt;parser = $parser; } abstract public function getTriggerChars(); abstract public function getTriggerStates(); abstract public function parse($index, $char, $previousChar, $state); } abstract class aCssMinifierPlugin { protected $configuration = array(); protected $minifier = null; public function __construct(CssMinifier $minifier, array $configuration = array()) { $this-&gt;configuration = $configuration; $this-&gt;minifier = $minifier; } abstract public function apply(aCssToken &amp;$token); abstract public function getTriggerTokens(); } abstract class aCssMinifierFilter { protected $configuration = array(); protected $minifier = null; public function __construct(CssMinifier $minifier, array $configuration = array()) { $this-&gt;configuration = $configuration; $this-&gt;minifier = $minifier; } abstract public function apply(array &amp;$tokens); } abstract class aCssFormatter { protected $indent = &quot;    &quot;; protected $padding = 0; protected $tokens = array(); public function __construct(array $tokens, $indent = null, $padding = null) { $this-&gt;tokens = $tokens; $this-&gt;indent = !is_null($indent) ? $indent : $this-&gt;indent; $this-&gt;padding = !is_null($padding) ? $padding : $this-&gt;padding; } abstract public function __toString(); } abstract class aCssDeclarationToken extends aCssToken { public $IsImportant = false; public $IsLast = false; public $Property = &quot;&quot;; public $Value = &quot;&quot;; public function __construct($property, $value, $isImportant = false, $isLast = false) { $this-&gt;Property = $property; $this-&gt;Value = $value; $this-&gt;IsImportant = $isImportant; $this-&gt;IsLast = $isLast; } public function __toString() { return $this-&gt;Property . &quot;:&quot; . $this-&gt;Value . ($this-&gt;IsImportant ? &quot; !important&quot; : &quot;&quot;) . ($this-&gt;IsLast ? &quot;&quot; : &quot;;&quot;); } } abstract class aCssAtBlockStartToken extends aCssToken { } abstract class aCssAtBlockEndToken extends aCssToken { public function __toString() { return &quot;}&quot;; } } class CssWhitesmithsFormatter extends aCssFormatter { public function __toString() { $r = array(); $level = 0; for ($i = 0, $l = count($this-&gt;tokens); $i &lt; $l; $i++) { $token = $this-&gt;tokens[$i]; $class = get_class($token); $indent = str_repeat($this-&gt;indent, $level); if ($class === &quot;CssCommentToken&quot;) { $lines = array_map(&quot;trim&quot;, explode(&quot;\n&quot;, $token-&gt;Comment)); for ($ii = 0, $ll = count($lines); $ii &lt; $ll; $ii++) { $r[] = $indent . (substr($lines[$ii], 0, 1) == &quot;*&quot; ? &quot; &quot; : &quot;&quot;) . $lines[$ii]; } } elseif ($class === &quot;CssAtCharsetToken&quot;) { $r[] = $indent . &quot;@charset &quot; . $token-&gt;Charset . &quot;;&quot;; } elseif ($class === &quot;CssAtFontFaceStartToken&quot;) { $r[] = $indent . &quot;@font-face&quot;; $r[] = $this-&gt;indent . $indent . &quot;{&quot;; $level++; } elseif ($class === &quot;CssAtImportToken&quot;) { $r[] = $indent . &quot;@import &quot; . $token-&gt;Import . &quot; &quot; . implode(&quot;, &quot;, $token-&gt;MediaTypes) . &quot;;&quot;; } elseif ($class === &quot;CssAtKeyframesStartToken&quot;) { $r[] = $indent . &quot;@keyframes \&quot;&quot; . $token-&gt;Name . &quot;\&quot;&quot;; $r[] = $this-&gt;indent . $indent . &quot;{&quot;; $level++; } elseif ($class === &quot;CssAtMediaStartToken&quot;) { $r[] = $indent . &quot;@media &quot; . implode(&quot;, &quot;, $token-&gt;MediaTypes); $r[] = $this-&gt;indent . $indent . &quot;{&quot;; $level++; } elseif ($class === &quot;CssAtPageStartToken&quot;) { $r[] = $indent . &quot;@page&quot;; $r[] = $this-&gt;indent . $indent . &quot;{&quot;; $level++; } elseif ($class === &quot;CssAtVariablesStartToken&quot;) { $r[] = $indent . &quot;@variables &quot; . implode(&quot;, &quot;, $token-&gt;MediaTypes); $r[] = $this-&gt;indent . $indent . &quot;{&quot;; $level++; } elseif ($class === &quot;CssRulesetStartToken&quot; || $class === &quot;CssAtKeyframesRulesetStartToken&quot;) { $r[] = $indent . implode(&quot;, &quot;, $token-&gt;Selectors); $r[] = $this-&gt;indent . $indent . &quot;{&quot;; $level++; } elseif ($class == &quot;CssAtFontFaceDeclarationToken&quot; || $class === &quot;CssAtKeyframesRulesetDeclarationToken&quot; || $class === &quot;CssAtPageDeclarationToken&quot; || $class == &quot;CssAtVariablesDeclarationToken&quot; || $class === &quot;CssRulesetDeclarationToken&quot; ) { $declaration = $indent . $token-&gt;Property . &quot;: &quot;; if ($this-&gt;padding) { $declaration = str_pad($declaration, $this-&gt;padding, &quot; &quot;, STR_PAD_RIGHT); } $r[] = $declaration . $token-&gt;Value . ($token-&gt;IsImportant ? &quot; !important&quot; : &quot;&quot;) . &quot;;&quot;; } elseif ($class === &quot;CssAtFontFaceEndToken&quot; || $class === &quot;CssAtMediaEndToken&quot; || $class === &quot;CssAtKeyframesEndToken&quot; || $class === &quot;CssAtKeyframesRulesetEndToken&quot; || $class === &quot;CssAtPageEndToken&quot; || $class === &quot;CssAtVariablesEndToken&quot; || $class === &quot;CssRulesetEndToken&quot; ) { $r[] = $indent . &quot;}&quot;; $level--; } } return implode(&quot;\n&quot;, $r); } } class CssVariablesMinifierPlugin extends aCssMinifierPlugin { private $reMatch = &quot;/var\((.+)\)/iSU&quot;; private $variables = null; public function getVariables() { return $this-&gt;variables; } public function apply(aCssToken &amp;$token) { if (stripos($token-&gt;Value, &quot;var&quot;) !== false &amp;&amp; preg_match_all($this-&gt;reMatch, $token-&gt;Value, $m)) { $mediaTypes = $token-&gt;MediaTypes; if (!in_array(&quot;all&quot;, $mediaTypes)) { $mediaTypes[] = &quot;all&quot;; } for ($i = 0, $l = count($m[0]); $i &lt; $l; $i++) { $variable = trim($m[1][$i]); foreach ($mediaTypes as $mediaType) { if (isset($this-&gt;variables[$mediaType], $this-&gt;variables[$mediaType][$variable])) { $token-&gt;Value = str_replace($m[0][$i], $this-&gt;variables[$mediaType][$variable], $token-&gt;Value); continue 2; } } CssMin::triggerError(new CssError(__FILE__, __LINE__, __METHOD__ . &quot;: No value found for variable &lt;code&gt;&quot; . $variable . &quot;&lt;/code&gt; in media types &lt;code&gt;&quot; . implode(&quot;, &quot;, $mediaTypes) . &quot;&lt;/code&gt;&quot;, (string) $token)); $token = new CssNullToken(); return true; } } return false; } public function getTriggerTokens() { return array ( &quot;CssAtFontFaceDeclarationToken&quot;, &quot;CssAtPageDeclarationToken&quot;, &quot;CssRulesetDeclarationToken&quot; ); } public function setVariables(array $variables) { $this-&gt;variables = $variables; } } class CssVariablesMinifierFilter extends aCssMinifierFilter { public function apply(array &amp;$tokens) { $variables = array(); $defaultMediaTypes = array(&quot;all&quot;); $mediaTypes = array(); $remove = array(); for($i = 0, $l = count($tokens); $i &lt; $l; $i++) { if (get_class($tokens[$i]) === &quot;CssAtVariablesStartToken&quot;) { $remove[] = $i; $mediaTypes = (count($tokens[$i]-&gt;MediaTypes) == 0 ? $defaultMediaTypes : $tokens[$i]-&gt;MediaTypes); foreach ($mediaTypes as $mediaType) { if (!isset($variables[$mediaType])) { $variables[$mediaType] = array(); } } for($i = $i; $i &lt; $l; $i++) { if (get_class($tokens[$i]) === &quot;CssAtVariablesDeclarationToken&quot;) { foreach ($mediaTypes as $mediaType) { $variables[$mediaType][$tokens[$i]-&gt;Property] = $tokens[$i]-&gt;Value; } $remove[] = $i; } elseif (get_class($tokens[$i]) === &quot;CssAtVariablesEndToken&quot;) { $remove[] = $i; break; } } } } foreach($variables as $mediaType =&gt; $null) { foreach($variables[$mediaType] as $variable =&gt; $value) { if (stripos($value, &quot;var&quot;) !== false &amp;&amp; preg_match_all(&quot;/var\((.+)\)/iSU&quot;, $value, $m)) { for ($i = 0, $l = count($m[0]); $i &lt; $l; $i++) { $variables[$mediaType][$variable] = str_replace($m[0][$i], (isset($variables[$mediaType][$m[1][$i]]) ? $variables[$mediaType][$m[1][$i]] : &quot;&quot;), $variables[$mediaType][$variable]); } } } } foreach ($remove as $i) { $tokens[$i] = null; } if (!($plugin = $this-&gt;minifier-&gt;getPlugin(&quot;CssVariablesMinifierPlugin&quot;))) { CssMin::triggerError(new CssError(__FILE__, __LINE__, __METHOD__ . &quot;: The plugin &lt;code&gt;CssVariablesMinifierPlugin&lt;/code&gt; was not found but is required for &lt;code&gt;&quot; . __CLASS__ . &quot;&lt;/code&gt;&quot;)); } else { $plugin-&gt;setVariables($variables); } return count($remove); } } class CssUrlParserPlugin extends aCssParserPlugin { public function getTriggerChars() { return array(&quot;(&quot;, &quot;)&quot;); } public function getTriggerStates() { return false; } public function parse($index, $char, $previousChar, $state) { if ($char === &quot;(&quot; &amp;&amp; strtolower(substr($this-&gt;parser-&gt;getSource(), $index - 3, 4)) === &quot;url(&quot; &amp;&amp; $state !== &quot;T_URL&quot;) { $this-&gt;parser-&gt;pushState(&quot;T_URL&quot;); $this-&gt;parser-&gt;setExclusive(__CLASS__); } elseif ($char === &quot;\n&quot; &amp;&amp; $previousChar === &quot;\\&quot; &amp;&amp; $state === &quot;T_URL&quot;) { $this-&gt;parser-&gt;setBuffer(substr($this-&gt;parser-&gt;getBuffer(), 0, -2)); } elseif ($char === &quot;\n&quot; &amp;&amp; $previousChar !== &quot;\\&quot; &amp;&amp; $state === &quot;T_URL&quot;) { $line = $this-&gt;parser-&gt;getBuffer(); $this-&gt;parser-&gt;setBuffer(substr($this-&gt;parser-&gt;getBuffer(), 0, -1) . &quot;)&quot;); $this-&gt;parser-&gt;popState(); $this-&gt;parser-&gt;unsetExclusive(); CssMin::triggerError(new CssError(__FILE__, __LINE__, __METHOD__ . &quot;: Unterminated string literal&quot;, $line . &quot;_&quot;)); } elseif ($char === &quot;)&quot; &amp;&amp; $state === &quot;T_URL&quot;) { $this-&gt;parser-&gt;popState(); $this-&gt;parser-&gt;unsetExclusive(); } else { return false; } return true; } } class CssStringParserPlugin extends aCssParserPlugin { private $delimiterChar = null; public function getTriggerChars() { return array(&quot;\&quot;&quot;, &quot;&#x27;&quot;, &quot;\n&quot;); } public function getTriggerStates() { return false; } public function parse($index, $char, $previousChar, $state) { if (($char === &quot;\&quot;&quot; || $char === &quot;&#x27;&quot;) &amp;&amp; $state !== &quot;T_STRING&quot;) { $this-&gt;delimiterChar = $char; $this-&gt;parser-&gt;pushState(&quot;T_STRING&quot;); $this-&gt;parser-&gt;setExclusive(__CLASS__); } elseif ($char === &quot;\n&quot; &amp;&amp; $previousChar === &quot;\\&quot; &amp;&amp; $state === &quot;T_STRING&quot;) { $this-&gt;parser-&gt;setBuffer(substr($this-&gt;parser-&gt;getBuffer(), 0, -2)); } elseif ($char === &quot;\n&quot; &amp;&amp; $previousChar !== &quot;\\&quot; &amp;&amp; $state === &quot;T_STRING&quot;) { $line = $this-&gt;parser-&gt;getBuffer(); $this-&gt;parser-&gt;popState(); $this-&gt;parser-&gt;unsetExclusive(); $this-&gt;parser-&gt;setBuffer(substr($this-&gt;parser-&gt;getBuffer(), 0, -1) . $this-&gt;delimiterChar); CssMin::triggerError(new CssError(__FILE__, __LINE__, __METHOD__ . &quot;: Unterminated string literal&quot;, $line . &quot;_&quot;)); $this-&gt;delimiterChar = null; } elseif ($char === $this-&gt;delimiterChar &amp;&amp; $state === &quot;T_STRING&quot;) { if ($previousChar == &quot;\\&quot;) { $source = $this-&gt;parser-&gt;getSource(); $c = 1; $i = $index - 2; while (substr($source, $i, 1) === &quot;\\&quot;) { $c++; $i--; } if ($c % 2) { return false; } } $this-&gt;parser-&gt;popState(); $this-&gt;parser-&gt;unsetExclusive(); $this-&gt;delimiterChar = null; } else { return false; } return true; } } class CssSortRulesetPropertiesMinifierFilter extends aCssMinifierFilter { public function apply(array &amp;$tokens) { $r = 0; for ($i = 0, $l = count($tokens); $i &lt; $l; $i++) { if (get_class($tokens[$i]) !== &quot;CssRulesetStartToken&quot;) { continue; } $endIndex = false; for ($ii = $i + 1; $ii &lt; $l; $ii++) { if (get_class($tokens[$ii]) !== &quot;CssRulesetEndToken&quot;) { continue; } $endIndex = $ii; break; } if (!$endIndex) { break; } $startIndex = $i; $i = $endIndex; if ($endIndex - $startIndex &lt;= 2) { continue; } for ($ii = $startIndex + 1; $ii &lt; $endIndex; $ii++) { if (get_class($tokens[$ii]) !== &quot;CssRulesetDeclarationToken&quot;) { continue(2); } } $declarations = array_slice($tokens, $startIndex + 1, $endIndex - $startIndex - 1); $sortRequired = $lastPropertyName = false; foreach ($declarations as $declaration) { if ($lastPropertyName) { if (strcmp($lastPropertyName, $declaration-&gt;Property) &gt; 0) { $sortRequired = true; break; } } $lastPropertyName = $declaration-&gt;Property; } if (!$sortRequired) { continue; } usort($declarations, array(__CLASS__, &quot;userDefinedSort1&quot;)); for ($ii = 0, $ll = count($declarations) - 1; $ii &lt;= $ll; $ii++) { if ($ii == $ll) { $declarations[$ii]-&gt;IsLast = true; } else { $declarations[$ii]-&gt;IsLast = false; } } array_splice($tokens, $startIndex + 1, $endIndex - $startIndex - 1, $declarations); $r += $endIndex - $startIndex - 1; } return $r; } public static function userDefinedSort1($a, $b) { return strcmp($a-&gt;Property, $b-&gt;Property); } } class CssRulesetStartToken extends aCssRulesetStartToken { public $Selectors = array(); public function __construct(array $selectors = array()) { $this-&gt;Selectors = $selectors; } public function __toString() { return implode(&quot;,&quot;, $this-&gt;Selectors) . &quot;{&quot;; } } class CssRulesetParserPlugin extends aCssParserPlugin { public function getTriggerChars() { return array(&quot;,&quot;, &quot;{&quot;, &quot;}&quot;, &quot;:&quot;, &quot;;&quot;); } public function getTriggerStates() { return array(&quot;T_DOCUMENT&quot;, &quot;T_AT_MEDIA&quot;, &quot;T_RULESET::SELECTORS&quot;, &quot;T_RULESET&quot;, &quot;T_RULESET_DECLARATION&quot;); } private $selectors = array(); public function parse($index, $char, $previousChar, $state) { if ($char === &quot;,&quot; &amp;&amp; ($state === &quot;T_DOCUMENT&quot; || $state === &quot;T_AT_MEDIA&quot; || $state === &quot;T_RULESET::SELECTORS&quot;)) { if ($state !== &quot;T_RULESET::SELECTORS&quot;) { $this-&gt;parser-&gt;pushState(&quot;T_RULESET::SELECTORS&quot;); } $this-&gt;selectors[] = $this-&gt;parser-&gt;getAndClearBuffer(&quot;,{&quot;); } elseif ($char === &quot;{&quot; &amp;&amp; ($state === &quot;T_DOCUMENT&quot; || $state === &quot;T_AT_MEDIA&quot; || $state === &quot;T_RULESET::SELECTORS&quot;)) { if ($this-&gt;parser-&gt;getBuffer() !== &quot;&quot;) { $this-&gt;selectors[] = $this-&gt;parser-&gt;getAndClearBuffer(&quot;,{&quot;); if ($state == &quot;T_RULESET::SELECTORS&quot;) { $this-&gt;parser-&gt;popState(); } $this-&gt;parser-&gt;pushState(&quot;T_RULESET&quot;); $this-&gt;parser-&gt;appendToken(new CssRulesetStartToken($this-&gt;selectors)); $this-&gt;selectors = array(); } } elseif ($char === &quot;:&quot; &amp;&amp; $state === &quot;T_RULESET&quot;) { $this-&gt;parser-&gt;pushState(&quot;T_RULESET_DECLARATION&quot;); $this-&gt;buffer = $this-&gt;parser-&gt;getAndClearBuffer(&quot;:;&quot;, true); } elseif ($char === &quot;:&quot; &amp;&amp; $state === &quot;T_RULESET_DECLARATION&quot;) { if ($this-&gt;buffer === &quot;filter&quot;) { return false; } CssMin::triggerError(new CssError(__FILE__, __LINE__, __METHOD__ . &quot;: Unterminated declaration&quot;, $this-&gt;buffer . &quot;:&quot; . $this-&gt;parser-&gt;getBuffer() . &quot;_&quot;)); } elseif (($char === &quot;;&quot; || $char === &quot;}&quot;) &amp;&amp; $state === &quot;T_RULESET_DECLARATION&quot;) { $value = $this-&gt;parser-&gt;getAndClearBuffer(&quot;;}&quot;); if (strtolower(substr($value, -10, 10)) === &quot;!important&quot;) { $value = trim(substr($value, 0, -10)); $isImportant = true; } else { $isImportant = false; } $this-&gt;parser-&gt;popState(); $this-&gt;parser-&gt;appendToken(new CssRulesetDeclarationToken($this-&gt;buffer, $value, $this-&gt;parser-&gt;getMediaTypes(), $isImportant)); if ($char === &quot;}&quot;) { $this-&gt;parser-&gt;appendToken(new CssRulesetEndToken()); $this-&gt;parser-&gt;popState(); } $this-&gt;buffer = &quot;&quot;; } elseif ($char === &quot;}&quot; &amp;&amp; $state === &quot;T_RULESET&quot;) { $this-&gt;parser-&gt;popState(); $this-&gt;parser-&gt;clearBuffer(); $this-&gt;parser-&gt;appendToken(new CssRulesetEndToken()); $this-&gt;buffer = &quot;&quot;; $this-&gt;selectors = array(); } else { return false; } return true; } } class CssRulesetEndToken extends aCssRulesetEndToken { } class CssRulesetDeclarationToken extends aCssDeclarationToken { public $MediaTypes = array(&quot;all&quot;); public function __construct($property, $value, $mediaTypes = null, $isImportant = false, $isLast = false) { parent::__construct($property, $value, $isImportant, $isLast); $this-&gt;MediaTypes = $mediaTypes ? $mediaTypes : array(&quot;all&quot;); } } class CssRemoveLastDelarationSemiColonMinifierFilter extends aCssMinifierFilter { public function apply(array &amp;$tokens) { for ($i = 0, $l = count($tokens); $i &lt; $l; $i++) { $current = get_class($tokens[$i]); $next = isset($tokens[$i+1]) ? get_class($tokens[$i+1]) : false; if (($current === &quot;CssRulesetDeclarationToken&quot; &amp;&amp; $next === &quot;CssRulesetEndToken&quot;) || ($current === &quot;CssAtFontFaceDeclarationToken&quot; &amp;&amp; $next === &quot;CssAtFontFaceEndToken&quot;) || ($current === &quot;CssAtPageDeclarationToken&quot; &amp;&amp; $next === &quot;CssAtPageEndToken&quot;)) { $tokens[$i]-&gt;IsLast = true; } } return 0; } } class CssRemoveEmptyRulesetsMinifierFilter extends aCssMinifierFilter { public function apply(array &amp;$tokens) { $r = 0; for ($i = 0, $l = count($tokens); $i &lt; $l; $i++) { $current = get_class($tokens[$i]); $next = isset($tokens[$i + 1]) ? get_class($tokens[$i + 1]) : false; if (($current === &quot;CssRulesetStartToken&quot; &amp;&amp; $next === &quot;CssRulesetEndToken&quot;) || ($current === &quot;CssAtKeyframesRulesetStartToken&quot; &amp;&amp; $next === &quot;CssAtKeyframesRulesetEndToken&quot; &amp;&amp; !array_intersect(array(&quot;from&quot;, &quot;0%&quot;, &quot;to&quot;, &quot;100%&quot;), array_map(&quot;strtolower&quot;, $tokens[$i]-&gt;Selectors))) ) { $tokens[$i] = null; $tokens[$i + 1] = null; $i++; $r = $r + 2; } } return $r; } } class CssRemoveEmptyAtBlocksMinifierFilter extends aCssMinifierFilter { public function apply(array &amp;$tokens) { $r = 0; for ($i = 0, $l = count($tokens); $i &lt; $l; $i++) { $current = get_class($tokens[$i]); $next = isset($tokens[$i + 1]) ? get_class($tokens[$i + 1]) : false; if (($current === &quot;CssAtFontFaceStartToken&quot; &amp;&amp; $next === &quot;CssAtFontFaceEndToken&quot;) || ($current === &quot;CssAtKeyframesStartToken&quot; &amp;&amp; $next === &quot;CssAtKeyframesEndToken&quot;) || ($current === &quot;CssAtPageStartToken&quot; &amp;&amp; $next === &quot;CssAtPageEndToken&quot;) || ($current === &quot;CssAtMediaStartToken&quot; &amp;&amp; $next === &quot;CssAtMediaEndToken&quot;)) { $tokens[$i] = null; $tokens[$i + 1] = null; $i++; $r = $r + 2; } } return $r; } } class CssRemoveCommentsMinifierFilter extends aCssMinifierFilter { public function apply(array &amp;$tokens) { $r = 0; for ($i = 0, $l = count($tokens); $i &lt; $l; $i++) { if (get_class($tokens[$i]) === &quot;CssCommentToken&quot;) { $tokens[$i] = null; $r++; } } return $r; } } class CssParser { private $buffer = &quot;&quot;; private $plugins = array(); private $source = &quot;&quot;; private $state = &quot;T_DOCUMENT&quot;; private $stateExclusive = false; private $stateMediaTypes = false; private $states = array(&quot;T_DOCUMENT&quot;); private $tokens = array(); public function __construct($source = null, array $plugins = null) { $plugins = array_merge(array ( &quot;Comment&quot; =&gt; true, &quot;String&quot; =&gt; true, &quot;Url&quot; =&gt; true, &quot;Expression&quot; =&gt; true, &quot;Ruleset&quot; =&gt; true, &quot;AtCharset&quot; =&gt; true, &quot;AtFontFace&quot; =&gt; true, &quot;AtImport&quot; =&gt; true, &quot;AtKeyframes&quot; =&gt; true, &quot;AtMedia&quot; =&gt; true, &quot;AtPage&quot; =&gt; true, &quot;AtVariables&quot; =&gt; true ), is_array($plugins) ? $plugins : array()); foreach ($plugins as $name =&gt; $config) { if ($config !== false) { $class = &quot;Css&quot; . $name . &quot;ParserPlugin&quot;; $config = is_array($config) ? $config : array(); if (class_exists($class)) { $this-&gt;plugins[] = new $class($this, $config); } else { CssMin::triggerError(new CssError(__FILE__, __LINE__, __METHOD__ . &quot;: The plugin &lt;code&gt;&quot; . $name . &quot;&lt;/code&gt; with the class name &lt;code&gt;&quot; . $class . &quot;&lt;/code&gt; was not found&quot;)); } } } if (!is_null($source)) { $this-&gt;parse($source); } } public function appendToken(aCssToken $token) { $this-&gt;tokens[] = $token; } public function clearBuffer() { $this-&gt;buffer = &quot;&quot;; } public function getAndClearBuffer($trim = &quot;&quot;, $tolower = false) { $r = $this-&gt;getBuffer($trim, $tolower); $this-&gt;buffer = &quot;&quot;; return $r; } public function getBuffer($trim = &quot;&quot;, $tolower = false) { $r = $this-&gt;buffer; if ($trim) { $r = trim($r, &quot; \t\n\r\0\x0B&quot; . $trim); } if ($tolower) { $r = strtolower($r); } return $r; } public function getMediaTypes() { return $this-&gt;stateMediaTypes; } public function getSource() { return $this-&gt;source; } public function getState() { return $this-&gt;state; } public function getPlugin($class) { static $index = null; if (is_null($index)) { $index = array(); for ($i = 0, $l = count($this-&gt;plugins); $i &lt; $l; $i++) { $index[get_class($this-&gt;plugins[$i])] = $i; } } return isset($index[$class]) ? $this-&gt;plugins[$index[$class]] : false; } public function getTokens() { return $this-&gt;tokens; } public function isState($state) { return ($this-&gt;state == $state); } public function parse($source) { $this-&gt;source = &quot;&quot;; $this-&gt;tokens = array(); $globalTriggerChars = &quot;&quot;; $plugins = $this-&gt;plugins; $pluginCount = count($plugins); $pluginIndex = array(); $pluginTriggerStates = array(); $pluginTriggerChars = array(); for ($i = 0, $l = count($plugins); $i &lt; $l; $i++) { $tPluginClassName = get_class($plugins[$i]); $pluginTriggerChars[$i] = implode(&quot;&quot;, $plugins[$i]-&gt;getTriggerChars()); $tPluginTriggerStates = $plugins[$i]-&gt;getTriggerStates(); $pluginTriggerStates[$i] = $tPluginTriggerStates === false ? false : &quot;|&quot; . implode(&quot;|&quot;, $tPluginTriggerStates) . &quot;|&quot;; $pluginIndex[$tPluginClassName] = $i; for ($ii = 0, $ll = strlen($pluginTriggerChars[$i]); $ii &lt; $ll; $ii++) { $c = substr($pluginTriggerChars[$i], $ii, 1); if (strpos($globalTriggerChars, $c) === false) { $globalTriggerChars .= $c; } } } $source = str_replace(&quot;\r\n&quot;, &quot;\n&quot;, $source); $source = str_replace(&quot;\r&quot;, &quot;\n&quot;, $source); $this-&gt;source = $source; $buffer = &amp;$this-&gt;buffer; $exclusive = &amp;$this-&gt;stateExclusive; $state = &amp;$this-&gt;state; $c = $p = null; for ($i = 0, $l = strlen($source); $i &lt; $l; $i++) { $c = $source[$i]; if ($exclusive === false) { if ($c === &quot;\n&quot; || $c === &quot;\t&quot;) { $c = &quot; &quot;; } if ($c === &quot; &quot; &amp;&amp; $p === &quot; &quot;) { continue; } } $buffer .= $c; if (strpos($globalTriggerChars, $c) !== false) { if ($exclusive) { $tPluginIndex = $pluginIndex[$exclusive]; if (strpos($pluginTriggerChars[$tPluginIndex], $c) !== false &amp;&amp; ($pluginTriggerStates[$tPluginIndex] === false || strpos($pluginTriggerStates[$tPluginIndex], $state) !== false)) { $r = $plugins[$tPluginIndex]-&gt;parse($i, $c, $p, $state); if ($r === true) { continue; } elseif ($r !== false &amp;&amp; $r != $i) { $i = $r; continue; } } } else { $triggerState = &quot;|&quot; . $state . &quot;|&quot;; for ($ii = 0, $ll = $pluginCount; $ii &lt; $ll; $ii++) { if (strpos($pluginTriggerChars[$ii], $c) !== false &amp;&amp; ($pluginTriggerStates[$ii] === false || strpos($pluginTriggerStates[$ii], $triggerState) !== false)) { $r = $plugins[$ii]-&gt;parse($i, $c, $p, $state); if ($r === true) { break; } elseif ($r !== false &amp;&amp; $r != $i) { $i = $r; break; } } } } } $p = $c; } return $this-&gt;tokens; } public function popState() { $r = array_pop($this-&gt;states); $this-&gt;state = $this-&gt;states[count($this-&gt;states) - 1]; return $r; } public function pushState($state) { $r = array_push($this-&gt;states, $state); $this-&gt;state = $this-&gt;states[count($this-&gt;states) - 1]; return $r; } public function setBuffer($buffer) { $this-&gt;buffer = $buffer; } public function setExclusive($exclusive) { $this-&gt;stateExclusive = $exclusive; } public function setMediaTypes(array $mediaTypes) { $this-&gt;stateMediaTypes = $mediaTypes; } public function setState($state) { $r = array_pop($this-&gt;states); array_push($this-&gt;states, $state); $this-&gt;state = $this-&gt;states[count($this-&gt;states) - 1]; return $r; } public function unsetExclusive() { $this-&gt;stateExclusive = false; } public function unsetMediaTypes() { $this-&gt;stateMediaTypes = false; } } class CssOtbsFormatter extends aCssFormatter { public function __toString() { $r = array(); $level = 0; for ($i = 0, $l = count($this-&gt;tokens); $i &lt; $l; $i++) { $token = $this-&gt;tokens[$i]; $class = get_class($token); $indent = str_repeat($this-&gt;indent, $level); if ($class === &quot;CssCommentToken&quot;) { $lines = array_map(&quot;trim&quot;, explode(&quot;\n&quot;, $token-&gt;Comment)); for ($ii = 0, $ll = count($lines); $ii &lt; $ll; $ii++) { $r[] = $indent . (substr($lines[$ii], 0, 1) == &quot;*&quot; ? &quot; &quot; : &quot;&quot;) . $lines[$ii]; } } elseif ($class === &quot;CssAtCharsetToken&quot;) { $r[] = $indent . &quot;@charset &quot; . $token-&gt;Charset . &quot;;&quot;; } elseif ($class === &quot;CssAtFontFaceStartToken&quot;) { $r[] = $indent . &quot;@font-face {&quot;; $level++; } elseif ($class === &quot;CssAtImportToken&quot;) { $r[] = $indent . &quot;@import &quot; . $token-&gt;Import . &quot; &quot; . implode(&quot;, &quot;, $token-&gt;MediaTypes) . &quot;;&quot;; } elseif ($class === &quot;CssAtKeyframesStartToken&quot;) { $r[] = $indent . &quot;@keyframes \&quot;&quot; . $token-&gt;Name . &quot;\&quot; {&quot;; $level++; } elseif ($class === &quot;CssAtMediaStartToken&quot;) { $r[] = $indent . &quot;@media &quot; . implode(&quot;, &quot;, $token-&gt;MediaTypes) . &quot; {&quot;; $level++; } elseif ($class === &quot;CssAtPageStartToken&quot;) { $r[] = $indent . &quot;@page {&quot;; $level++; } elseif ($class === &quot;CssAtVariablesStartToken&quot;) { $r[] = $indent . &quot;@variables &quot; . implode(&quot;, &quot;, $token-&gt;MediaTypes) . &quot; {&quot;; $level++; } elseif ($class === &quot;CssRulesetStartToken&quot; || $class === &quot;CssAtKeyframesRulesetStartToken&quot;) { $r[] = $indent . implode(&quot;, &quot;, $token-&gt;Selectors) . &quot; {&quot;; $level++; } elseif ($class == &quot;CssAtFontFaceDeclarationToken&quot; || $class === &quot;CssAtKeyframesRulesetDeclarationToken&quot; || $class === &quot;CssAtPageDeclarationToken&quot; || $class == &quot;CssAtVariablesDeclarationToken&quot; || $class === &quot;CssRulesetDeclarationToken&quot; ) { $declaration = $indent . $token-&gt;Property . &quot;: &quot;; if ($this-&gt;padding) { $declaration = str_pad($declaration, $this-&gt;padding, &quot; &quot;, STR_PAD_RIGHT); } $r[] = $declaration . $token-&gt;Value . ($token-&gt;IsImportant ? &quot; !important&quot; : &quot;&quot;) . &quot;;&quot;; } elseif ($class === &quot;CssAtFontFaceEndToken&quot; || $class === &quot;CssAtMediaEndToken&quot; || $class === &quot;CssAtKeyframesEndToken&quot; || $class === &quot;CssAtKeyframesRulesetEndToken&quot; || $class === &quot;CssAtPageEndToken&quot; || $class === &quot;CssAtVariablesEndToken&quot; || $class === &quot;CssRulesetEndToken&quot; ) { $level--; $r[] = str_repeat($indent, $level) . &quot;}&quot;; } } return implode(&quot;\n&quot;, $r); } } class CssNullToken extends aCssToken { public function __toString() { return &quot;&quot;; } } class CssMinifier { private $filters = array(); private $plugins = array(); private $minified = &quot;&quot;; public function __construct($source = null, array $filters = null, array $plugins = null) { $filters = array_merge(array ( &quot;ImportImports&quot; =&gt; false, &quot;RemoveComments&quot; =&gt; true, &quot;RemoveEmptyRulesets&quot; =&gt; true, &quot;RemoveEmptyAtBlocks&quot; =&gt; true, &quot;ConvertLevel3Properties&quot; =&gt; false, &quot;ConvertLevel3AtKeyframes&quot; =&gt; false, &quot;Variables&quot; =&gt; true, &quot;RemoveLastDelarationSemiColon&quot; =&gt; true ), is_array($filters) ? $filters : array()); $plugins = array_merge(array ( &quot;Variables&quot; =&gt; true, &quot;ConvertFontWeight&quot; =&gt; false, &quot;ConvertHslColors&quot; =&gt; false, &quot;ConvertRgbColors&quot; =&gt; false, &quot;ConvertNamedColors&quot; =&gt; false, &quot;CompressColorValues&quot; =&gt; false, &quot;CompressUnitValues&quot; =&gt; false, &quot;CompressExpressionValues&quot; =&gt; false ), is_array($plugins) ? $plugins : array()); foreach ($filters as $name =&gt; $config) { if ($config !== false) { $class = &quot;Css&quot; . $name . &quot;MinifierFilter&quot;; $config = is_array($config) ? $config : array(); if (class_exists($class)) { $this-&gt;filters[] = new $class($this, $config); } else { CssMin::triggerError(new CssError(__FILE__, __LINE__, __METHOD__ . &quot;: The filter &lt;code&gt;&quot; . $name . &quot;&lt;/code&gt; with the class name &lt;code&gt;&quot; . $class . &quot;&lt;/code&gt; was not found&quot;)); } } } foreach ($plugins as $name =&gt; $config) { if ($config !== false) { $class = &quot;Css&quot; . $name . &quot;MinifierPlugin&quot;; $config = is_array($config) ? $config : array(); if (class_exists($class)) { $this-&gt;plugins[] = new $class($this, $config); } else { CssMin::triggerError(new CssError(__FILE__, __LINE__, __METHOD__ . &quot;: The plugin &lt;code&gt;&quot; . $name . &quot;&lt;/code&gt; with the class name &lt;code&gt;&quot; . $class . &quot;&lt;/code&gt; was not found&quot;)); } } } if (!is_null($source)) { $this-&gt;minify($source); } } public function getMinified() { return $this-&gt;minified; } public function getPlugin($class) { static $index = null; if (is_null($index)) { $index = array(); for ($i = 0, $l = count($this-&gt;plugins); $i &lt; $l; $i++) { $index[get_class($this-&gt;plugins[$i])] = $i; } } return isset($index[$class]) ? $this-&gt;plugins[$index[$class]] : false; } public function minify($source) { $r = &quot;&quot;; $parser = new CssParser($source); $tokens = $parser-&gt;getTokens(); $filters = $this-&gt;filters; $filterCount = count($this-&gt;filters); $plugins = $this-&gt;plugins; $pluginCount = count($plugins); $pluginIndex = array(); $pluginTriggerTokens = array(); $globalTriggerTokens = array(); for ($i = 0, $l = count($plugins); $i &lt; $l; $i++) { $tPluginClassName = get_class($plugins[$i]); $pluginTriggerTokens[$i] = $plugins[$i]-&gt;getTriggerTokens(); foreach ($pluginTriggerTokens[$i] as $v) { if (!in_array($v, $globalTriggerTokens)) { $globalTriggerTokens[] = $v; } } $pluginTriggerTokens[$i] = &quot;|&quot; . implode(&quot;|&quot;, $pluginTriggerTokens[$i]) . &quot;|&quot;; $pluginIndex[$tPluginClassName] = $i; } $globalTriggerTokens = &quot;|&quot; . implode(&quot;|&quot;, $globalTriggerTokens) . &quot;|&quot;; for($i = 0; $i &lt; $filterCount; $i++) { if ($filters[$i]-&gt;apply($tokens) &gt; 0) { $tokens = array_values(array_filter($tokens)); } } $tokenCount = count($tokens); for($i = 0; $i &lt; $tokenCount; $i++) { $triggerToken = &quot;|&quot; . get_class($tokens[$i]) . &quot;|&quot;; if (strpos($globalTriggerTokens, $triggerToken) !== false) { for($ii = 0; $ii &lt; $pluginCount; $ii++) { if (strpos($pluginTriggerTokens[$ii], $triggerToken) !== false || $pluginTriggerTokens[$ii] === false) { if ($plugins[$ii]-&gt;apply($tokens[$i]) === true) { continue 2; } } } } } for($i = 0; $i &lt; $tokenCount; $i++) { $r .= (string) $tokens[$i]; } $this-&gt;minified = $r; return $r; } } class CssMin { private static $classIndex = array(); private static $errors = array(); private static $isVerbose = false; public static function autoload($class) { if (isset(self::$classIndex[$class])) { require(self::$classIndex[$class]); } } public static function getErrors() { return self::$errors; } public static function hasErrors() { return count(self::$errors) &gt; 0; } public static function initialise() { $paths = array(dirname(__FILE__)); while (list($i, $path) = each($paths)) { $subDirectorys = glob($path . &quot;*&quot;, GLOB_MARK | GLOB_ONLYDIR | GLOB_NOSORT); if (is_array($subDirectorys)) { foreach ($subDirectorys as $subDirectory) { $paths[] = $subDirectory; } } $files = glob($path . &quot;*.php&quot;, 0); if (is_array($files)) { foreach ($files as $file) { $class = substr(basename($file), 0, -4); self::$classIndex[$class] = $file; } } } krsort(self::$classIndex); if (function_exists(&quot;spl_autoload_register&quot;) &amp;&amp; !is_callable(&quot;__autoload&quot;)) { spl_autoload_register(array(__CLASS__, &quot;autoload&quot;)); } else { foreach (self::$classIndex as $class =&gt; $file) { if (!class_exists($class)) { require_once($file); } } } } public static function minify($source, array $filters = null, array $plugins = null) { self::$errors = array(); $minifier = new CssMinifier($source, $filters, $plugins); return $minifier-&gt;getMinified(); } public static function parse($source, array $plugins = null) { self::$errors = array(); $parser = new CssParser($source, $plugins); return $parser-&gt;getTokens(); } public static function setVerbose($to) { self::$isVerbose = (boolean) $to; return self::$isVerbose; } public static function triggerError(CssError $error) { self::$errors[] = $error; if (self::$isVerbose) { trigger_error((string) $error, E_USER_WARNING); } } } CssMin::initialise(); class CssImportImportsMinifierFilter extends aCssMinifierFilter { private $imported = array(); public function apply(array &amp;$tokens) { if (!isset($this-&gt;configuration[&quot;BasePath&quot;]) || !is_dir($this-&gt;configuration[&quot;BasePath&quot;])) { CssMin::triggerError(new CssError(__FILE__, __LINE__, __METHOD__ . &quot;: Base path &lt;code&gt;&quot; . ($this-&gt;configuration[&quot;BasePath&quot;] ? $this-&gt;configuration[&quot;BasePath&quot;] : &quot;null&quot;). &quot;&lt;/code&gt; is not a directory&quot;)); return 0; } for ($i = 0, $l = count($tokens); $i &lt; $l; $i++) { if (get_class($tokens[$i]) === &quot;CssAtImportToken&quot;) { $import = $this-&gt;configuration[&quot;BasePath&quot;] . &quot;/&quot; . $tokens[$i]-&gt;Import; if (!is_file($import)) { CssMin::triggerError(new CssError(__FILE__, __LINE__, __METHOD__ . &quot;: Import file &lt;code&gt;&quot; . $import. &quot;&lt;/code&gt; was not found.&quot;, (string) $tokens[$i])); } elseif (in_array($import, $this-&gt;imported)) { CssMin::triggerError(new CssError(__FILE__, __LINE__, __METHOD__ . &quot;: Import file &lt;code&gt;&quot; . $import. &quot;&lt;/code&gt; was already imported.&quot;, (string) $tokens[$i])); $tokens[$i] = null; } else { $this-&gt;imported[] = $import; $parser = new CssParser(file_get_contents($import)); $import = $parser-&gt;getTokens(); if (count($tokens[$i]-&gt;MediaTypes) &gt; 0 &amp;&amp; !(count($tokens[$i]-&gt;MediaTypes) == 1 &amp;&amp; $tokens[$i]-&gt;MediaTypes[0] == &quot;all&quot;)) { $blocks = array(); for($ii = 0, $ll = count($import); $ii &lt; $ll; $ii++) { if (get_class($import[$ii]) === &quot;CssAtImportToken&quot;) { if (count($import[$ii]-&gt;MediaTypes) == 0 || (count($import[$ii]-&gt;MediaTypes) == 1 &amp;&amp; $import[$ii]-&gt;MediaTypes[0] == &quot;all&quot;)) { $import[$ii]-&gt;MediaTypes = $tokens[$i]-&gt;MediaTypes; } elseif (count($import[$ii]-&gt;MediaTypes &gt; 0)) { foreach ($import[$ii]-&gt;MediaTypes as $index =&gt; $mediaType) { if (!in_array($mediaType, $tokens[$i]-&gt;MediaTypes)) { unset($import[$ii]-&gt;MediaTypes[$index]); } } $import[$ii]-&gt;MediaTypes = array_values($import[$ii]-&gt;MediaTypes); if (count($import[$ii]-&gt;MediaTypes) == 0) { $import[$ii] = null; } } } } for($ii = 0, $ll = count($import); $ii &lt; $ll; $ii++) { if (get_class($import[$ii]) === &quot;CssAtMediaStartToken&quot;) { foreach ($import[$ii]-&gt;MediaTypes as $index =&gt; $mediaType) { if (!in_array($mediaType, $tokens[$i]-&gt;MediaTypes)) { unset($import[$ii]-&gt;MediaTypes[$index]); } $import[$ii]-&gt;MediaTypes = array_values($import[$ii]-&gt;MediaTypes); } } } for($ii = 0, $ll = count($import); $ii &lt; $ll; $ii++) { if (get_class($import[$ii]) === &quot;CssAtMediaStartToken&quot;) { if (count($import[$ii]-&gt;MediaTypes) === 0) { for ($iii = $ii; $iii &lt; $ll; $iii++) { if (get_class($import[$iii]) === &quot;CssAtMediaEndToken&quot;) { break; } } if (get_class($import[$iii]) === &quot;CssAtMediaEndToken&quot;) { array_splice($import, $ii, $iii - $ii + 1, array()); $ll = count($import); } } } } for($ii = 0, $ll = count($import); $ii &lt; $ll; $ii++) { if (get_class($import[$ii]) === &quot;CssAtMediaStartToken&quot; &amp;&amp; count(array_diff($tokens[$i]-&gt;MediaTypes, $import[$ii]-&gt;MediaTypes)) === 0) { for ($iii = $ii; $iii &lt; $ll; $iii++) { if (get_class($import[$iii]) == &quot;CssAtMediaEndToken&quot;) { break; } } if (get_class($import[$iii]) == &quot;CssAtMediaEndToken&quot;) { unset($import[$ii]); unset($import[$iii]); $import = array_values($import); $ll = count($import); } } } for($ii = 0, $ll = count($import); $ii &lt; $ll; $ii++) { $class = get_class($import[$ii]); if ($class === &quot;CssAtImportToken&quot; || $class === &quot;CssAtCharsetToken&quot;) { $blocks = array_merge($blocks, array_splice($import, $ii, 1, array())); $ll = count($import); } } for($ii = 0, $ll = count($import); $ii &lt; $ll; $ii++) { $class = get_class($import[$ii]); if ($class === &quot;CssAtFontFaceStartToken&quot; || $class === &quot;CssAtMediaStartToken&quot; || $class === &quot;CssAtPageStartToken&quot; || $class === &quot;CssAtVariablesStartToken&quot;) { for ($iii = $ii; $iii &lt; $ll; $iii++) { $class = get_class($import[$iii]); if ($class === &quot;CssAtFontFaceEndToken&quot; || $class === &quot;CssAtMediaEndToken&quot; || $class === &quot;CssAtPageEndToken&quot; || $class === &quot;CssAtVariablesEndToken&quot;) { break; } } $class = get_class($import[$iii]); if (isset($import[$iii]) &amp;&amp; ($class === &quot;CssAtFontFaceEndToken&quot; || $class === &quot;CssAtMediaEndToken&quot; || $class === &quot;CssAtPageEndToken&quot; || $class === &quot;CssAtVariablesEndToken&quot;)) { $blocks = array_merge($blocks, array_splice($import, $ii, $iii - $ii + 1, array())); $ll = count($import); } } } $import = array_merge($blocks, array(new CssAtMediaStartToken($tokens[$i]-&gt;MediaTypes)), $import, array(new CssAtMediaEndToken())); } array_splice($tokens, $i, 1, $import); $i--; $l = count($tokens); } } } } } class CssExpressionParserPlugin extends aCssParserPlugin { private $leftBraces = 0; private $rightBraces = 0; public function getTriggerChars() { return array(&quot;(&quot;, &quot;)&quot;, &quot;;&quot;, &quot;}&quot;); } public function getTriggerStates() { return false; } public function parse($index, $char, $previousChar, $state) { if ($char === &quot;(&quot; &amp;&amp; strtolower(substr($this-&gt;parser-&gt;getSource(), $index - 10, 11)) === &quot;expression(&quot; &amp;&amp; $state !== &quot;T_EXPRESSION&quot;) { $this-&gt;parser-&gt;pushState(&quot;T_EXPRESSION&quot;); $this-&gt;leftBraces++; } elseif ($char === &quot;(&quot; &amp;&amp; $state === &quot;T_EXPRESSION&quot;) { $this-&gt;leftBraces++; } elseif ($char === &quot;)&quot; &amp;&amp; $state === &quot;T_EXPRESSION&quot;) { $this-&gt;rightBraces++; } elseif (($char === &quot;;&quot; || $char === &quot;}&quot;) &amp;&amp; $state === &quot;T_EXPRESSION&quot; &amp;&amp; $this-&gt;leftBraces === $this-&gt;rightBraces) { $this-&gt;leftBraces = $this-&gt;rightBraces = 0; $this-&gt;parser-&gt;popState(); return $index - 1; } else { return false; } return true; } } class CssError { public $File = &quot;&quot;; public $Line = 0; public $Message = &quot;&quot;; public $Source = &quot;&quot;; public function __construct($file, $line, $message, $source = &quot;&quot;) { $this-&gt;File = $file; $this-&gt;Line = $line; $this-&gt;Message = $message; $this-&gt;Source = $source; } public function __toString() { return $this-&gt;Message . ($this-&gt;Source ? &quot;: &lt;br /&gt;&lt;code&gt;&quot; . $this-&gt;Source . &quot;&lt;/code&gt;&quot;: &quot;&quot;) . &quot;&lt;br /&gt;in file &quot; . $this-&gt;File . &quot; at line &quot; . $this-&gt;Line; } } class CssConvertRgbColorsMinifierPlugin extends aCssMinifierPlugin { private $reMatch = &quot;/rgb\s*\(\s*([0-9%]+)\s*,\s*([0-9%]+)\s*,\s*([0-9%]+)\s*\)/iS&quot;; public function apply(aCssToken &amp;$token) { if (stripos($token-&gt;Value, &quot;rgb&quot;) !== false &amp;&amp; preg_match($this-&gt;reMatch, $token-&gt;Value, $m)) { for ($i = 1, $l = count($m); $i &lt; $l; $i++) { if (strpos(&quot;%&quot;, $m[$i]) !== false) { $m[$i] = substr($m[$i], 0, -1); $m[$i] = (int) (256 * ($m[$i] / 100)); } $m[$i] = str_pad(dechex($m[$i]), 2, &quot;0&quot;, STR_PAD_LEFT); } $token-&gt;Value = str_replace($m[0], &quot;#&quot; . $m[1] . $m[2] . $m[3], $token-&gt;Value); } return false; } public function getTriggerTokens() { return array ( &quot;CssAtFontFaceDeclarationToken&quot;, &quot;CssAtPageDeclarationToken&quot;, &quot;CssRulesetDeclarationToken&quot; ); } } class CssConvertNamedColorsMinifierPlugin extends aCssMinifierPlugin { private $reMatch = null; private $reReplace = &quot;\&quot;\${1}\&quot; . \$this-&gt;transformation[strtolower(\&quot;\${2}\&quot;)] . \&quot;\${3}\&quot;&quot;; private $transformation = array ( &quot;aliceblue&quot; =&gt; &quot;#f0f8ff&quot;, &quot;antiquewhite&quot; =&gt; &quot;#faebd7&quot;, &quot;aqua&quot; =&gt; &quot;#0ff&quot;, &quot;aquamarine&quot; =&gt; &quot;#7fffd4&quot;, &quot;azure&quot; =&gt; &quot;#f0ffff&quot;, &quot;beige&quot; =&gt; &quot;#f5f5dc&quot;, &quot;black&quot; =&gt; &quot;#000&quot;, &quot;blue&quot; =&gt; &quot;#00f&quot;, &quot;blueviolet&quot; =&gt; &quot;#8a2be2&quot;, &quot;brown&quot; =&gt; &quot;#a52a2a&quot;, &quot;burlywood&quot; =&gt; &quot;#deb887&quot;, &quot;cadetblue&quot; =&gt; &quot;#5f9ea0&quot;, &quot;chartreuse&quot; =&gt; &quot;#7fff00&quot;, &quot;chocolate&quot; =&gt; &quot;#d2691e&quot;, &quot;coral&quot; =&gt; &quot;#ff7f50&quot;, &quot;cornflowerblue&quot; =&gt; &quot;#6495ed&quot;, &quot;cornsilk&quot; =&gt; &quot;#fff8dc&quot;, &quot;crimson&quot; =&gt; &quot;#dc143c&quot;, &quot;darkblue&quot; =&gt; &quot;#00008b&quot;, &quot;darkcyan&quot; =&gt; &quot;#008b8b&quot;, &quot;darkgoldenrod&quot; =&gt; &quot;#b8860b&quot;, &quot;darkgray&quot; =&gt; &quot;#a9a9a9&quot;, &quot;darkgreen&quot; =&gt; &quot;#006400&quot;, &quot;darkkhaki&quot; =&gt; &quot;#bdb76b&quot;, &quot;darkmagenta&quot; =&gt; &quot;#8b008b&quot;, &quot;darkolivegreen&quot; =&gt; &quot;#556b2f&quot;, &quot;darkorange&quot; =&gt; &quot;#ff8c00&quot;, &quot;darkorchid&quot; =&gt; &quot;#9932cc&quot;, &quot;darkred&quot; =&gt; &quot;#8b0000&quot;, &quot;darksalmon&quot; =&gt; &quot;#e9967a&quot;, &quot;darkseagreen&quot; =&gt; &quot;#8fbc8f&quot;, &quot;darkslateblue&quot; =&gt; &quot;#483d8b&quot;, &quot;darkslategray&quot; =&gt; &quot;#2f4f4f&quot;, &quot;darkturquoise&quot; =&gt; &quot;#00ced1&quot;, &quot;darkviolet&quot; =&gt; &quot;#9400d3&quot;, &quot;deeppink&quot; =&gt; &quot;#ff1493&quot;, &quot;deepskyblue&quot; =&gt; &quot;#00bfff&quot;, &quot;dimgray&quot; =&gt; &quot;#696969&quot;, &quot;dodgerblue&quot; =&gt; &quot;#1e90ff&quot;, &quot;firebrick&quot; =&gt; &quot;#b22222&quot;, &quot;floralwhite&quot; =&gt; &quot;#fffaf0&quot;, &quot;forestgreen&quot; =&gt; &quot;#228b22&quot;, &quot;fuchsia&quot; =&gt; &quot;#f0f&quot;, &quot;gainsboro&quot; =&gt; &quot;#dcdcdc&quot;, &quot;ghostwhite&quot; =&gt; &quot;#f8f8ff&quot;, &quot;gold&quot; =&gt; &quot;#ffd700&quot;, &quot;goldenrod&quot; =&gt; &quot;#daa520&quot;, &quot;gray&quot; =&gt; &quot;#808080&quot;, &quot;green&quot; =&gt; &quot;#008000&quot;, &quot;greenyellow&quot; =&gt; &quot;#adff2f&quot;, &quot;honeydew&quot; =&gt; &quot;#f0fff0&quot;, &quot;hotpink&quot; =&gt; &quot;#ff69b4&quot;, &quot;indianred&quot; =&gt; &quot;#cd5c5c&quot;, &quot;indigo&quot; =&gt; &quot;#4b0082&quot;, &quot;ivory&quot; =&gt; &quot;#fffff0&quot;, &quot;khaki&quot; =&gt; &quot;#f0e68c&quot;, &quot;lavender&quot; =&gt; &quot;#e6e6fa&quot;, &quot;lavenderblush&quot; =&gt; &quot;#fff0f5&quot;, &quot;lawngreen&quot; =&gt; &quot;#7cfc00&quot;, &quot;lemonchiffon&quot; =&gt; &quot;#fffacd&quot;, &quot;lightblue&quot; =&gt; &quot;#add8e6&quot;, &quot;lightcoral&quot; =&gt; &quot;#f08080&quot;, &quot;lightcyan&quot; =&gt; &quot;#e0ffff&quot;, &quot;lightgoldenrodyellow&quot; =&gt; &quot;#fafad2&quot;, &quot;lightgreen&quot; =&gt; &quot;#90ee90&quot;, &quot;lightgrey&quot; =&gt; &quot;#d3d3d3&quot;, &quot;lightpink&quot; =&gt; &quot;#ffb6c1&quot;, &quot;lightsalmon&quot; =&gt; &quot;#ffa07a&quot;, &quot;lightseagreen&quot; =&gt; &quot;#20b2aa&quot;, &quot;lightskyblue&quot; =&gt; &quot;#87cefa&quot;, &quot;lightslategray&quot; =&gt; &quot;#789&quot;, &quot;lightsteelblue&quot; =&gt; &quot;#b0c4de&quot;, &quot;lightyellow&quot; =&gt; &quot;#ffffe0&quot;, &quot;lime&quot; =&gt; &quot;#0f0&quot;, &quot;limegreen&quot; =&gt; &quot;#32cd32&quot;, &quot;linen&quot; =&gt; &quot;#faf0e6&quot;, &quot;maroon&quot; =&gt; &quot;#800000&quot;, &quot;mediumaquamarine&quot; =&gt; &quot;#66cdaa&quot;, &quot;mediumblue&quot; =&gt; &quot;#0000cd&quot;, &quot;mediumorchid&quot; =&gt; &quot;#ba55d3&quot;, &quot;mediumpurple&quot; =&gt; &quot;#9370db&quot;, &quot;mediumseagreen&quot; =&gt; &quot;#3cb371&quot;, &quot;mediumslateblue&quot; =&gt; &quot;#7b68ee&quot;, &quot;mediumspringgreen&quot; =&gt; &quot;#00fa9a&quot;, &quot;mediumturquoise&quot; =&gt; &quot;#48d1cc&quot;, &quot;mediumvioletred&quot; =&gt; &quot;#c71585&quot;, &quot;midnightblue&quot; =&gt; &quot;#191970&quot;, &quot;mintcream&quot; =&gt; &quot;#f5fffa&quot;, &quot;mistyrose&quot; =&gt; &quot;#ffe4e1&quot;, &quot;moccasin&quot; =&gt; &quot;#ffe4b5&quot;, &quot;navajowhite&quot; =&gt; &quot;#ffdead&quot;, &quot;navy&quot; =&gt; &quot;#000080&quot;, &quot;oldlace&quot; =&gt; &quot;#fdf5e6&quot;, &quot;olive&quot; =&gt; &quot;#808000&quot;, &quot;olivedrab&quot; =&gt; &quot;#6b8e23&quot;, &quot;orange&quot; =&gt; &quot;#ffa500&quot;, &quot;orangered&quot; =&gt; &quot;#ff4500&quot;, &quot;orchid&quot; =&gt; &quot;#da70d6&quot;, &quot;palegoldenrod&quot; =&gt; &quot;#eee8aa&quot;, &quot;palegreen&quot; =&gt; &quot;#98fb98&quot;, &quot;paleturquoise&quot; =&gt; &quot;#afeeee&quot;, &quot;palevioletred&quot; =&gt; &quot;#db7093&quot;, &quot;papayawhip&quot; =&gt; &quot;#ffefd5&quot;, &quot;peachpuff&quot; =&gt; &quot;#ffdab9&quot;, &quot;peru&quot; =&gt; &quot;#cd853f&quot;, &quot;pink&quot; =&gt; &quot;#ffc0cb&quot;, &quot;plum&quot; =&gt; &quot;#dda0dd&quot;, &quot;powderblue&quot; =&gt; &quot;#b0e0e6&quot;, &quot;purple&quot; =&gt; &quot;#800080&quot;, &quot;red&quot; =&gt; &quot;#f00&quot;, &quot;rosybrown&quot; =&gt; &quot;#bc8f8f&quot;, &quot;royalblue&quot; =&gt; &quot;#4169e1&quot;, &quot;saddlebrown&quot; =&gt; &quot;#8b4513&quot;, &quot;salmon&quot; =&gt; &quot;#fa8072&quot;, &quot;sandybrown&quot; =&gt; &quot;#f4a460&quot;, &quot;seagreen&quot; =&gt; &quot;#2e8b57&quot;, &quot;seashell&quot; =&gt; &quot;#fff5ee&quot;, &quot;sienna&quot; =&gt; &quot;#a0522d&quot;, &quot;silver&quot; =&gt; &quot;#c0c0c0&quot;, &quot;skyblue&quot; =&gt; &quot;#87ceeb&quot;, &quot;slateblue&quot; =&gt; &quot;#6a5acd&quot;, &quot;slategray&quot; =&gt; &quot;#708090&quot;, &quot;snow&quot; =&gt; &quot;#fffafa&quot;, &quot;springgreen&quot; =&gt; &quot;#00ff7f&quot;, &quot;steelblue&quot; =&gt; &quot;#4682b4&quot;, &quot;tan&quot; =&gt; &quot;#d2b48c&quot;, &quot;teal&quot; =&gt; &quot;#008080&quot;, &quot;thistle&quot; =&gt; &quot;#d8bfd8&quot;, &quot;tomato&quot; =&gt; &quot;#ff6347&quot;, &quot;turquoise&quot; =&gt; &quot;#40e0d0&quot;, &quot;violet&quot; =&gt; &quot;#ee82ee&quot;, &quot;wheat&quot; =&gt; &quot;#f5deb3&quot;, &quot;white&quot; =&gt; &quot;#fff&quot;, &quot;whitesmoke&quot; =&gt; &quot;#f5f5f5&quot;, &quot;yellow&quot; =&gt; &quot;#ff0&quot;, &quot;yellowgreen&quot; =&gt; &quot;#9acd32&quot; ); public function __construct(CssMinifier $minifier, array $configuration = array()) { $this-&gt;reMatch = &quot;/(^|\s)+(&quot; . implode(&quot;|&quot;, array_keys($this-&gt;transformation)) . &quot;)(\s|$)+/eiS&quot;; parent::__construct($minifier, $configuration); } public function apply(aCssToken &amp;$token) { $lcValue = strtolower($token-&gt;Value); if (isset($this-&gt;transformation[$lcValue])) { $token-&gt;Value = $this-&gt;transformation[$lcValue]; } elseif (preg_match($this-&gt;reMatch, $token-&gt;Value)) { $token-&gt;Value = preg_replace($this-&gt;reMatch, $this-&gt;reReplace, $token-&gt;Value); } return false; } public function getTriggerTokens() { return array ( &quot;CssAtFontFaceDeclarationToken&quot;, &quot;CssAtPageDeclarationToken&quot;, &quot;CssRulesetDeclarationToken&quot; ); } } class CssConvertLevel3PropertiesMinifierFilter extends aCssMinifierFilter { private $transformations = array ( &quot;animation&quot; =&gt; array(null, &quot;-webkit-animation&quot;, null, null), &quot;animation-delay&quot; =&gt; array(null, &quot;-webkit-animation-delay&quot;, null, null), &quot;animation-direction&quot; =&gt; array(null, &quot;-webkit-animation-direction&quot;, null, null), &quot;animation-duration&quot; =&gt; array(null, &quot;-webkit-animation-duration&quot;, null, null), &quot;animation-fill-mode&quot; =&gt; array(null, &quot;-webkit-animation-fill-mode&quot;, null, null), &quot;animation-iteration-count&quot; =&gt; array(null, &quot;-webkit-animation-iteration-count&quot;, null, null), &quot;animation-name&quot; =&gt; array(null, &quot;-webkit-animation-name&quot;, null, null), &quot;animation-play-state&quot; =&gt; array(null, &quot;-webkit-animation-play-state&quot;, null, null), &quot;animation-timing-function&quot; =&gt; array(null, &quot;-webkit-animation-timing-function&quot;, null, null), &quot;appearance&quot; =&gt; array(&quot;-moz-appearance&quot;, &quot;-webkit-appearance&quot;, null, null), &quot;backface-visibility&quot; =&gt; array(null, &quot;-webkit-backface-visibility&quot;, null, null), &quot;background-clip&quot; =&gt; array(null, &quot;-webkit-background-clip&quot;, null, null), &quot;background-composite&quot; =&gt; array(null, &quot;-webkit-background-composite&quot;, null, null), &quot;background-inline-policy&quot; =&gt; array(&quot;-moz-background-inline-policy&quot;, null, null, null), &quot;background-origin&quot; =&gt; array(null, &quot;-webkit-background-origin&quot;, null, null), &quot;background-position-x&quot; =&gt; array(null, null, null, &quot;-ms-background-position-x&quot;), &quot;background-position-y&quot; =&gt; array(null, null, null, &quot;-ms-background-position-y&quot;), &quot;background-size&quot; =&gt; array(null, &quot;-webkit-background-size&quot;, null, null), &quot;behavior&quot; =&gt; array(null, null, null, &quot;-ms-behavior&quot;), &quot;binding&quot; =&gt; array(&quot;-moz-binding&quot;, null, null, null), &quot;border-after&quot; =&gt; array(null, &quot;-webkit-border-after&quot;, null, null), &quot;border-after-color&quot; =&gt; array(null, &quot;-webkit-border-after-color&quot;, null, null), &quot;border-after-style&quot; =&gt; array(null, &quot;-webkit-border-after-style&quot;, null, null), &quot;border-after-width&quot; =&gt; array(null, &quot;-webkit-border-after-width&quot;, null, null), &quot;border-before&quot; =&gt; array(null, &quot;-webkit-border-before&quot;, null, null), &quot;border-before-color&quot; =&gt; array(null, &quot;-webkit-border-before-color&quot;, null, null), &quot;border-before-style&quot; =&gt; array(null, &quot;-webkit-border-before-style&quot;, null, null), &quot;border-before-width&quot; =&gt; array(null, &quot;-webkit-border-before-width&quot;, null, null), &quot;border-border-bottom-colors&quot; =&gt; array(&quot;-moz-border-bottom-colors&quot;, null, null, null), &quot;border-bottom-left-radius&quot; =&gt; array(&quot;-moz-border-radius-bottomleft&quot;, &quot;-webkit-border-bottom-left-radius&quot;, null, null), &quot;border-bottom-right-radius&quot; =&gt; array(&quot;-moz-border-radius-bottomright&quot;, &quot;-webkit-border-bottom-right-radius&quot;, null, null), &quot;border-end&quot; =&gt; array(&quot;-moz-border-end&quot;, &quot;-webkit-border-end&quot;, null, null), &quot;border-end-color&quot; =&gt; array(&quot;-moz-border-end-color&quot;, &quot;-webkit-border-end-color&quot;, null, null), &quot;border-end-style&quot; =&gt; array(&quot;-moz-border-end-style&quot;, &quot;-webkit-border-end-style&quot;, null, null), &quot;border-end-width&quot; =&gt; array(&quot;-moz-border-end-width&quot;, &quot;-webkit-border-end-width&quot;, null, null), &quot;border-fit&quot; =&gt; array(null, &quot;-webkit-border-fit&quot;, null, null), &quot;border-horizontal-spacing&quot; =&gt; array(null, &quot;-webkit-border-horizontal-spacing&quot;, null, null), &quot;border-image&quot; =&gt; array(&quot;-moz-border-image&quot;, &quot;-webkit-border-image&quot;, null, null), &quot;border-left-colors&quot; =&gt; array(&quot;-moz-border-left-colors&quot;, null, null, null), &quot;border-radius&quot; =&gt; array(&quot;-moz-border-radius&quot;, &quot;-webkit-border-radius&quot;, null, null), &quot;border-border-right-colors&quot; =&gt; array(&quot;-moz-border-right-colors&quot;, null, null, null), &quot;border-start&quot; =&gt; array(&quot;-moz-border-start&quot;, &quot;-webkit-border-start&quot;, null, null), &quot;border-start-color&quot; =&gt; array(&quot;-moz-border-start-color&quot;, &quot;-webkit-border-start-color&quot;, null, null), &quot;border-start-style&quot; =&gt; array(&quot;-moz-border-start-style&quot;, &quot;-webkit-border-start-style&quot;, null, null), &quot;border-start-width&quot; =&gt; array(&quot;-moz-border-start-width&quot;, &quot;-webkit-border-start-width&quot;, null, null), &quot;border-top-colors&quot; =&gt; array(&quot;-moz-border-top-colors&quot;, null, null, null), &quot;border-top-left-radius&quot; =&gt; array(&quot;-moz-border-radius-topleft&quot;, &quot;-webkit-border-top-left-radius&quot;, null, null), &quot;border-top-right-radius&quot; =&gt; array(&quot;-moz-border-radius-topright&quot;, &quot;-webkit-border-top-right-radius&quot;, null, null), &quot;border-vertical-spacing&quot; =&gt; array(null, &quot;-webkit-border-vertical-spacing&quot;, null, null), &quot;box-align&quot; =&gt; array(&quot;-moz-box-align&quot;, &quot;-webkit-box-align&quot;, null, null), &quot;box-direction&quot; =&gt; array(&quot;-moz-box-direction&quot;, &quot;-webkit-box-direction&quot;, null, null), &quot;box-flex&quot; =&gt; array(&quot;-moz-box-flex&quot;, &quot;-webkit-box-flex&quot;, null, null), &quot;box-flex-group&quot; =&gt; array(null, &quot;-webkit-box-flex-group&quot;, null, null), &quot;box-flex-lines&quot; =&gt; array(null, &quot;-webkit-box-flex-lines&quot;, null, null), &quot;box-ordinal-group&quot; =&gt; array(&quot;-moz-box-ordinal-group&quot;, &quot;-webkit-box-ordinal-group&quot;, null, null), &quot;box-orient&quot; =&gt; array(&quot;-moz-box-orient&quot;, &quot;-webkit-box-orient&quot;, null, null), &quot;box-pack&quot; =&gt; array(&quot;-moz-box-pack&quot;, &quot;-webkit-box-pack&quot;, null, null), &quot;box-reflect&quot; =&gt; array(null, &quot;-webkit-box-reflect&quot;, null, null), &quot;box-shadow&quot; =&gt; array(&quot;-moz-box-shadow&quot;, &quot;-webkit-box-shadow&quot;, null, null), &quot;box-sizing&quot; =&gt; array(&quot;-moz-box-sizing&quot;, null, null, null), &quot;color-correction&quot; =&gt; array(null, &quot;-webkit-color-correction&quot;, null, null), &quot;column-break-after&quot; =&gt; array(null, &quot;-webkit-column-break-after&quot;, null, null), &quot;column-break-before&quot; =&gt; array(null, &quot;-webkit-column-break-before&quot;, null, null), &quot;column-break-inside&quot; =&gt; array(null, &quot;-webkit-column-break-inside&quot;, null, null), &quot;column-count&quot; =&gt; array(&quot;-moz-column-count&quot;, &quot;-webkit-column-count&quot;, null, null), &quot;column-gap&quot; =&gt; array(&quot;-moz-column-gap&quot;, &quot;-webkit-column-gap&quot;, null, null), &quot;column-rule&quot; =&gt; array(&quot;-moz-column-rule&quot;, &quot;-webkit-column-rule&quot;, null, null), &quot;column-rule-color&quot; =&gt; array(&quot;-moz-column-rule-color&quot;, &quot;-webkit-column-rule-color&quot;, null, null), &quot;column-rule-style&quot; =&gt; array(&quot;-moz-column-rule-style&quot;, &quot;-webkit-column-rule-style&quot;, null, null), &quot;column-rule-width&quot; =&gt; array(&quot;-moz-column-rule-width&quot;, &quot;-webkit-column-rule-width&quot;, null, null), &quot;column-span&quot; =&gt; array(null, &quot;-webkit-column-span&quot;, null, null), &quot;column-width&quot; =&gt; array(&quot;-moz-column-width&quot;, &quot;-webkit-column-width&quot;, null, null), &quot;columns&quot; =&gt; array(null, &quot;-webkit-columns&quot;, null, null), &quot;filter&quot; =&gt; array(__CLASS__, &quot;filter&quot;), &quot;float-edge&quot; =&gt; array(&quot;-moz-float-edge&quot;, null, null, null), &quot;font-feature-settings&quot; =&gt; array(&quot;-moz-font-feature-settings&quot;, null, null, null), &quot;font-language-override&quot; =&gt; array(&quot;-moz-font-language-override&quot;, null, null, null), &quot;font-size-delta&quot; =&gt; array(null, &quot;-webkit-font-size-delta&quot;, null, null), &quot;font-smoothing&quot; =&gt; array(null, &quot;-webkit-font-smoothing&quot;, null, null), &quot;force-broken-image-icon&quot; =&gt; array(&quot;-moz-force-broken-image-icon&quot;, null, null, null), &quot;highlight&quot; =&gt; array(null, &quot;-webkit-highlight&quot;, null, null), &quot;hyphenate-character&quot; =&gt; array(null, &quot;-webkit-hyphenate-character&quot;, null, null), &quot;hyphenate-locale&quot; =&gt; array(null, &quot;-webkit-hyphenate-locale&quot;, null, null), &quot;hyphens&quot; =&gt; array(null, &quot;-webkit-hyphens&quot;, null, null), &quot;force-broken-image-icon&quot; =&gt; array(&quot;-moz-image-region&quot;, null, null, null), &quot;ime-mode&quot; =&gt; array(null, null, null, &quot;-ms-ime-mode&quot;), &quot;interpolation-mode&quot; =&gt; array(null, null, null, &quot;-ms-interpolation-mode&quot;), &quot;layout-flow&quot; =&gt; array(null, null, null, &quot;-ms-layout-flow&quot;), &quot;layout-grid&quot; =&gt; array(null, null, null, &quot;-ms-layout-grid&quot;), &quot;layout-grid-char&quot; =&gt; array(null, null, null, &quot;-ms-layout-grid-char&quot;), &quot;layout-grid-line&quot; =&gt; array(null, null, null, &quot;-ms-layout-grid-line&quot;), &quot;layout-grid-mode&quot; =&gt; array(null, null, null, &quot;-ms-layout-grid-mode&quot;), &quot;layout-grid-type&quot; =&gt; array(null, null, null, &quot;-ms-layout-grid-type&quot;), &quot;line-break&quot; =&gt; array(null, &quot;-webkit-line-break&quot;, null, &quot;-ms-line-break&quot;), &quot;line-clamp&quot; =&gt; array(null, &quot;-webkit-line-clamp&quot;, null, null), &quot;line-grid-mode&quot; =&gt; array(null, null, null, &quot;-ms-line-grid-mode&quot;), &quot;logical-height&quot; =&gt; array(null, &quot;-webkit-logical-height&quot;, null, null), &quot;logical-width&quot; =&gt; array(null, &quot;-webkit-logical-width&quot;, null, null), &quot;margin-after&quot; =&gt; array(null, &quot;-webkit-margin-after&quot;, null, null), &quot;margin-after-collapse&quot; =&gt; array(null, &quot;-webkit-margin-after-collapse&quot;, null, null), &quot;margin-before&quot; =&gt; array(null, &quot;-webkit-margin-before&quot;, null, null), &quot;margin-before-collapse&quot; =&gt; array(null, &quot;-webkit-margin-before-collapse&quot;, null, null), &quot;margin-bottom-collapse&quot; =&gt; array(null, &quot;-webkit-margin-bottom-collapse&quot;, null, null), &quot;margin-collapse&quot; =&gt; array(null, &quot;-webkit-margin-collapse&quot;, null, null), &quot;margin-end&quot; =&gt; array(&quot;-moz-margin-end&quot;, &quot;-webkit-margin-end&quot;, null, null), &quot;margin-start&quot; =&gt; array(&quot;-moz-margin-start&quot;, &quot;-webkit-margin-start&quot;, null, null), &quot;margin-top-collapse&quot; =&gt; array(null, &quot;-webkit-margin-top-collapse&quot;, null, null), &quot;marquee &quot; =&gt; array(null, &quot;-webkit-marquee&quot;, null, null), &quot;marquee-direction&quot; =&gt; array(null, &quot;-webkit-marquee-direction&quot;, null, null), &quot;marquee-increment&quot; =&gt; array(null, &quot;-webkit-marquee-increment&quot;, null, null), &quot;marquee-repetition&quot; =&gt; array(null, &quot;-webkit-marquee-repetition&quot;, null, null), &quot;marquee-speed&quot; =&gt; array(null, &quot;-webkit-marquee-speed&quot;, null, null), &quot;marquee-style&quot; =&gt; array(null, &quot;-webkit-marquee-style&quot;, null, null), &quot;mask&quot; =&gt; array(null, &quot;-webkit-mask&quot;, null, null), &quot;mask-attachment&quot; =&gt; array(null, &quot;-webkit-mask-attachment&quot;, null, null), &quot;mask-box-image&quot; =&gt; array(null, &quot;-webkit-mask-box-image&quot;, null, null), &quot;mask-clip&quot; =&gt; array(null, &quot;-webkit-mask-clip&quot;, null, null), &quot;mask-composite&quot; =&gt; array(null, &quot;-webkit-mask-composite&quot;, null, null), &quot;mask-image&quot; =&gt; array(null, &quot;-webkit-mask-image&quot;, null, null), &quot;mask-origin&quot; =&gt; array(null, &quot;-webkit-mask-origin&quot;, null, null), &quot;mask-position&quot; =&gt; array(null, &quot;-webkit-mask-position&quot;, null, null), &quot;mask-position-x&quot; =&gt; array(null, &quot;-webkit-mask-position-x&quot;, null, null), &quot;mask-position-y&quot; =&gt; array(null, &quot;-webkit-mask-position-y&quot;, null, null), &quot;mask-repeat&quot; =&gt; array(null, &quot;-webkit-mask-repeat&quot;, null, null), &quot;mask-repeat-x&quot; =&gt; array(null, &quot;-webkit-mask-repeat-x&quot;, null, null), &quot;mask-repeat-y&quot; =&gt; array(null, &quot;-webkit-mask-repeat-y&quot;, null, null), &quot;mask-size&quot; =&gt; array(null, &quot;-webkit-mask-size&quot;, null, null), &quot;match-nearest-mail-blockquote-color&quot; =&gt; array(null, &quot;-webkit-match-nearest-mail-blockquote-color&quot;, null, null), &quot;max-logical-height&quot; =&gt; array(null, &quot;-webkit-max-logical-height&quot;, null, null), &quot;max-logical-width&quot; =&gt; array(null, &quot;-webkit-max-logical-width&quot;, null, null), &quot;min-logical-height&quot; =&gt; array(null, &quot;-webkit-min-logical-height&quot;, null, null), &quot;min-logical-width&quot; =&gt; array(null, &quot;-webkit-min-logical-width&quot;, null, null), &quot;object-fit&quot; =&gt; array(null, null, &quot;-o-object-fit&quot;, null), &quot;object-position&quot; =&gt; array(null, null, &quot;-o-object-position&quot;, null), &quot;opacity&quot; =&gt; array(__CLASS__, &quot;opacity&quot;), &quot;outline-radius&quot; =&gt; array(&quot;-moz-outline-radius&quot;, null, null, null), &quot;outline-bottom-left-radius&quot; =&gt; array(&quot;-moz-outline-radius-bottomleft&quot;, null, null, null), &quot;outline-bottom-right-radius&quot; =&gt; array(&quot;-moz-outline-radius-bottomright&quot;, null, null, null), &quot;outline-top-left-radius&quot; =&gt; array(&quot;-moz-outline-radius-topleft&quot;, null, null, null), &quot;outline-top-right-radius&quot; =&gt; array(&quot;-moz-outline-radius-topright&quot;, null, null, null), &quot;padding-after&quot; =&gt; array(null, &quot;-webkit-padding-after&quot;, null, null), &quot;padding-before&quot; =&gt; array(null, &quot;-webkit-padding-before&quot;, null, null), &quot;padding-end&quot; =&gt; array(&quot;-moz-padding-end&quot;, &quot;-webkit-padding-end&quot;, null, null), &quot;padding-start&quot; =&gt; array(&quot;-moz-padding-start&quot;, &quot;-webkit-padding-start&quot;, null, null), &quot;perspective&quot; =&gt; array(null, &quot;-webkit-perspective&quot;, null, null), &quot;perspective-origin&quot; =&gt; array(null, &quot;-webkit-perspective-origin&quot;, null, null), &quot;perspective-origin-x&quot; =&gt; array(null, &quot;-webkit-perspective-origin-x&quot;, null, null), &quot;perspective-origin-y&quot; =&gt; array(null, &quot;-webkit-perspective-origin-y&quot;, null, null), &quot;rtl-ordering&quot; =&gt; array(null, &quot;-webkit-rtl-ordering&quot;, null, null), &quot;scrollbar-3dlight-color&quot; =&gt; array(null, null, null, &quot;-ms-scrollbar-3dlight-color&quot;), &quot;scrollbar-arrow-color&quot; =&gt; array(null, null, null, &quot;-ms-scrollbar-arrow-color&quot;), &quot;scrollbar-base-color&quot; =&gt; array(null, null, null, &quot;-ms-scrollbar-base-color&quot;), &quot;scrollbar-darkshadow-color&quot; =&gt; array(null, null, null, &quot;-ms-scrollbar-darkshadow-color&quot;), &quot;scrollbar-face-color&quot; =&gt; array(null, null, null, &quot;-ms-scrollbar-face-color&quot;), &quot;scrollbar-highlight-color&quot; =&gt; array(null, null, null, &quot;-ms-scrollbar-highlight-color&quot;), &quot;scrollbar-shadow-color&quot; =&gt; array(null, null, null, &quot;-ms-scrollbar-shadow-color&quot;), &quot;scrollbar-track-color&quot; =&gt; array(null, null, null, &quot;-ms-scrollbar-track-color&quot;), &quot;stack-sizing&quot; =&gt; array(&quot;-moz-stack-sizing&quot;, null, null, null), &quot;svg-shadow&quot; =&gt; array(null, &quot;-webkit-svg-shadow&quot;, null, null), &quot;tab-size&quot; =&gt; array(&quot;-moz-tab-size&quot;, null, &quot;-o-tab-size&quot;, null), &quot;table-baseline&quot; =&gt; array(null, null, &quot;-o-table-baseline&quot;, null), &quot;text-align-last&quot; =&gt; array(null, null, null, &quot;-ms-text-align-last&quot;), &quot;text-autospace&quot; =&gt; array(null, null, null, &quot;-ms-text-autospace&quot;), &quot;text-combine&quot; =&gt; array(null, &quot;-webkit-text-combine&quot;, null, null), &quot;text-decorations-in-effect&quot; =&gt; array(null, &quot;-webkit-text-decorations-in-effect&quot;, null, null), &quot;text-emphasis&quot; =&gt; array(null, &quot;-webkit-text-emphasis&quot;, null, null), &quot;text-emphasis-color&quot; =&gt; array(null, &quot;-webkit-text-emphasis-color&quot;, null, null), &quot;text-emphasis-position&quot; =&gt; array(null, &quot;-webkit-text-emphasis-position&quot;, null, null), &quot;text-emphasis-style&quot; =&gt; array(null, &quot;-webkit-text-emphasis-style&quot;, null, null), &quot;text-fill-color&quot; =&gt; array(null, &quot;-webkit-text-fill-color&quot;, null, null), &quot;text-justify&quot; =&gt; array(null, null, null, &quot;-ms-text-justify&quot;), &quot;text-kashida-space&quot; =&gt; array(null, null, null, &quot;-ms-text-kashida-space&quot;), &quot;text-overflow&quot; =&gt; array(null, null, &quot;-o-text-overflow&quot;, &quot;-ms-text-overflow&quot;), &quot;text-security&quot; =&gt; array(null, &quot;-webkit-text-security&quot;, null, null), &quot;text-size-adjust&quot; =&gt; array(null, &quot;-webkit-text-size-adjust&quot;, null, &quot;-ms-text-size-adjust&quot;), &quot;text-stroke&quot; =&gt; array(null, &quot;-webkit-text-stroke&quot;, null, null), &quot;text-stroke-color&quot; =&gt; array(null, &quot;-webkit-text-stroke-color&quot;, null, null), &quot;text-stroke-width&quot; =&gt; array(null, &quot;-webkit-text-stroke-width&quot;, null, null), &quot;text-underline-position&quot; =&gt; array(null, null, null, &quot;-ms-text-underline-position&quot;), &quot;transform&quot; =&gt; array(&quot;-moz-transform&quot;, &quot;-webkit-transform&quot;, &quot;-o-transform&quot;, null), &quot;transform-origin&quot; =&gt; array(&quot;-moz-transform-origin&quot;, &quot;-webkit-transform-origin&quot;, &quot;-o-transform-origin&quot;, null), &quot;transform-origin-x&quot; =&gt; array(null, &quot;-webkit-transform-origin-x&quot;, null, null), &quot;transform-origin-y&quot; =&gt; array(null, &quot;-webkit-transform-origin-y&quot;, null, null), &quot;transform-origin-z&quot; =&gt; array(null, &quot;-webkit-transform-origin-z&quot;, null, null), &quot;transform-style&quot; =&gt; array(null, &quot;-webkit-transform-style&quot;, null, null), &quot;transition&quot; =&gt; array(&quot;-moz-transition&quot;, &quot;-webkit-transition&quot;, &quot;-o-transition&quot;, null), &quot;transition-delay&quot; =&gt; array(&quot;-moz-transition-delay&quot;, &quot;-webkit-transition-delay&quot;, &quot;-o-transition-delay&quot;, null), &quot;transition-duration&quot; =&gt; array(&quot;-moz-transition-duration&quot;, &quot;-webkit-transition-duration&quot;, &quot;-o-transition-duration&quot;, null), &quot;transition-property&quot; =&gt; array(&quot;-moz-transition-property&quot;, &quot;-webkit-transition-property&quot;, &quot;-o-transition-property&quot;, null), &quot;transition-timing-function&quot; =&gt; array(&quot;-moz-transition-timing-function&quot;, &quot;-webkit-transition-timing-function&quot;, &quot;-o-transition-timing-function&quot;, null), &quot;user-drag&quot; =&gt; array(null, &quot;-webkit-user-drag&quot;, null, null), &quot;user-focus&quot; =&gt; array(&quot;-moz-user-focus&quot;, null, null, null), &quot;user-input&quot; =&gt; array(&quot;-moz-user-input&quot;, null, null, null), &quot;user-modify&quot; =&gt; array(&quot;-moz-user-modify&quot;, &quot;-webkit-user-modify&quot;, null, null), &quot;user-select&quot; =&gt; array(&quot;-moz-user-select&quot;, &quot;-webkit-user-select&quot;, null, null), &quot;white-space&quot; =&gt; array(__CLASS__, &quot;whiteSpace&quot;), &quot;window-shadow&quot; =&gt; array(&quot;-moz-window-shadow&quot;, null, null, null), &quot;word-break&quot; =&gt; array(null, null, null, &quot;-ms-word-break&quot;), &quot;word-wrap&quot; =&gt; array(null, null, null, &quot;-ms-word-wrap&quot;), &quot;writing-mode&quot; =&gt; array(null, &quot;-webkit-writing-mode&quot;, null, &quot;-ms-writing-mode&quot;), &quot;zoom&quot; =&gt; array(null, null, null, &quot;-ms-zoom&quot;) ); public function apply(array &amp;$tokens) { $r = 0; $transformations = &amp;$this-&gt;transformations; for ($i = 0, $l = count($tokens); $i &lt; $l; $i++) { if (get_class($tokens[$i]) === &quot;CssRulesetDeclarationToken&quot;) { $tProperty = $tokens[$i]-&gt;Property; if (isset($transformations[$tProperty])) { $result = array(); if (is_callable($transformations[$tProperty])) { $result = call_user_func_array($transformations[$tProperty], array($tokens[$i])); if (!is_array($result) &amp;&amp; is_object($result)) { $result = array($result); } } else { $tValue = $tokens[$i]-&gt;Value; $tMediaTypes = $tokens[$i]-&gt;MediaTypes; foreach ($transformations[$tProperty] as $property) { if ($property !== null) { $result[] = new CssRulesetDeclarationToken($property, $tValue, $tMediaTypes); } } } if (count($result) &gt; 0) { array_splice($tokens, $i + 1, 0, $result); $i += count($result); $l += count($result); } } } } return $r; } private static function filter($token) { $r = array ( new CssRulesetDeclarationToken(&quot;-ms-filter&quot;, &quot;\&quot;&quot; . $token-&gt;Value . &quot;\&quot;&quot;, $token-&gt;MediaTypes), ); return $r; } private static function opacity($token) { $ieValue = (int) ((float) $token-&gt;Value * 100); $r = array ( new CssRulesetDeclarationToken(&quot;-ms-filter&quot;, &quot;\&quot;alpha(opacity=&quot; . $ieValue . &quot;)\&quot;&quot;, $token-&gt;MediaTypes), new CssRulesetDeclarationToken(&quot;filter&quot;, &quot;alpha(opacity=&quot; . $ieValue . &quot;)&quot;, $token-&gt;MediaTypes), new CssRulesetDeclarationToken(&quot;zoom&quot;, &quot;1&quot;, $token-&gt;MediaTypes) ); return $r; } private static function whiteSpace($token) { if (strtolower($token-&gt;Value) === &quot;pre-wrap&quot;) { $r = array ( new CssRulesetDeclarationToken(&quot;white-space&quot;, &quot;-moz-pre-wrap&quot;, $token-&gt;MediaTypes), new CssRulesetDeclarationToken(&quot;white-space&quot;, &quot;-webkit-pre-wrap&quot;, $token-&gt;MediaTypes), new CssRulesetDeclarationToken(&quot;white-space&quot;, &quot;-pre-wrap&quot;, $token-&gt;MediaTypes), new CssRulesetDeclarationToken(&quot;white-space&quot;, &quot;-o-pre-wrap&quot;, $token-&gt;MediaTypes), new CssRulesetDeclarationToken(&quot;word-wrap&quot;, &quot;break-word&quot;, $token-&gt;MediaTypes) ); return $r; } else { return array(); } } } class CssConvertLevel3AtKeyframesMinifierFilter extends aCssMinifierFilter { public function apply(array &amp;$tokens) { $r = 0; $transformations = array(&quot;-moz-keyframes&quot;, &quot;-webkit-keyframes&quot;); for ($i = 0, $l = count($tokens); $i &lt; $l; $i++) { if (get_class($tokens[$i]) === &quot;CssAtKeyframesStartToken&quot;) { for ($ii = $i; $ii &lt; $l; $ii++) { if (get_class($tokens[$ii]) === &quot;CssAtKeyframesEndToken&quot;) { break; } } if (get_class($tokens[$ii]) === &quot;CssAtKeyframesEndToken&quot;) { $add = array(); $source = array(); for ($iii = $i; $iii &lt;= $ii; $iii++) { $source[] = clone($tokens[$iii]); } foreach ($transformations as $transformation) { $t = array(); foreach ($source as $token) { $t[] = clone($token); } $t[0]-&gt;AtRuleName = $transformation; $add = array_merge($add, $t); } if (isset($this-&gt;configuration[&quot;RemoveSource&quot;]) &amp;&amp; $this-&gt;configuration[&quot;RemoveSource&quot;] === true) { array_splice($tokens, $i, $ii - $i + 1, $add); } else { array_splice($tokens, $ii + 1, 0, $add); } $l = count($tokens); $i = $ii + count($add); $r += count($add); } } } return $r; } } class CssConvertHslColorsMinifierPlugin extends aCssMinifierPlugin { private $reMatch = &quot;/^hsl\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*%\s*,\s*([0-9]+)\s*%\s*\)/iS&quot;; public function apply(aCssToken &amp;$token) { if (stripos($token-&gt;Value, &quot;hsl&quot;) !== false &amp;&amp; preg_match($this-&gt;reMatch, $token-&gt;Value, $m)) { $token-&gt;Value = str_replace($m[0], $this-&gt;hsl2hex($m[1], $m[2], $m[3]), $token-&gt;Value); } return false; } public function getTriggerTokens() { return array ( &quot;CssAtFontFaceDeclarationToken&quot;, &quot;CssAtPageDeclarationToken&quot;, &quot;CssRulesetDeclarationToken&quot; ); } private function hsl2hex($hue, $saturation, $lightness) { $hue = $hue / 360; $saturation = $saturation / 100; $lightness = $lightness / 100; if ($saturation == 0) { $red = $lightness * 255; $green = $lightness * 255; $blue = $lightness * 255; } else { if ($lightness &lt; 0.5 ) { $v2 = $lightness * (1 + $saturation); } else { $v2 = ($lightness + $saturation) - ($saturation * $lightness); } $v1 = 2 * $lightness - $v2; $red = 255 * self::hue2rgb($v1, $v2, $hue + (1 / 3)); $green = 255 * self::hue2rgb($v1, $v2, $hue); $blue = 255 * self::hue2rgb($v1, $v2, $hue - (1 / 3)); } return &quot;#&quot; . str_pad(dechex(round($red)), 2, &quot;0&quot;, STR_PAD_LEFT) . str_pad(dechex(round($green)), 2, &quot;0&quot;, STR_PAD_LEFT) . str_pad(dechex(round($blue)), 2, &quot;0&quot;, STR_PAD_LEFT); } private function hue2rgb($v1, $v2, $hue) { if ($hue &lt; 0) { $hue += 1; } if ($hue &gt; 1) { $hue -= 1; } if ((6 * $hue) &lt; 1) { return ($v1 + ($v2 - $v1) * 6 * $hue); } if ((2 * $hue) &lt; 1) { return ($v2); } if ((3 * $hue) &lt; 2) { return ($v1 + ($v2 - $v1) * (( 2 / 3) - $hue) * 6); } return $v1; } } class CssConvertFontWeightMinifierPlugin extends aCssMinifierPlugin { private $include = array ( &quot;font&quot;, &quot;font-weight&quot; ); private $reMatch = null; private $reReplace = &quot;\&quot;\${1}\&quot; . \$this-&gt;transformation[\&quot;\${2}\&quot;] . \&quot;\${3}\&quot;&quot;; private $transformation = array ( &quot;normal&quot; =&gt; &quot;400&quot;, &quot;bold&quot; =&gt; &quot;700&quot; ); public function __construct(CssMinifier $minifier) { $this-&gt;reMatch = &quot;/(^|\s)+(&quot; . implode(&quot;|&quot;, array_keys($this-&gt;transformation)). &quot;)(\s|$)+/eiS&quot;; parent::__construct($minifier); } public function apply(aCssToken &amp;$token) { if (in_array($token-&gt;Property, $this-&gt;include) &amp;&amp; preg_match($this-&gt;reMatch, $token-&gt;Value, $m)) { $token-&gt;Value = preg_replace($this-&gt;reMatch, $this-&gt;reReplace, $token-&gt;Value); } return false; } public function getTriggerTokens() { return array ( &quot;CssAtFontFaceDeclarationToken&quot;, &quot;CssAtPageDeclarationToken&quot;, &quot;CssRulesetDeclarationToken&quot; ); } } class CssCompressUnitValuesMinifierPlugin extends aCssMinifierPlugin { private $re = array ( &quot;/(^| |-)0\.([0-9]+?)(0+)?(%|em|ex|px|in|cm|mm|pt|pc)/iS&quot; =&gt; &quot;\${1}.\${2}\${4}&quot;, &quot;/(^| )-?(\.?)0(%|em|ex|px|in|cm|mm|pt|pc)/iS&quot; =&gt; &quot;\${1}0&quot;, &quot;/(^0\s0\s0\s0)|(^0\s0\s0$)|(^0\s0$)/iS&quot; =&gt; &quot;0&quot; ); private $reMatch = &quot;/(^| |-)0\.([0-9]+?)(0+)?(%|em|ex|px|in|cm|mm|pt|pc)|(^| )-?(\.?)0(%|em|ex|px|in|cm|mm|pt|pc)|(^0\s0\s0\s0$)|(^0\s0\s0$)|(^0\s0$)/iS&quot;; public function apply(aCssToken &amp;$token) { if (preg_match($this-&gt;reMatch, $token-&gt;Value)) { foreach ($this-&gt;re as $reMatch =&gt; $reReplace) { $token-&gt;Value = preg_replace($reMatch, $reReplace, $token-&gt;Value); } } return false; } public function getTriggerTokens() { return array ( &quot;CssAtFontFaceDeclarationToken&quot;, &quot;CssAtPageDeclarationToken&quot;, &quot;CssRulesetDeclarationToken&quot; ); } } class CssCompressExpressionValuesMinifierPlugin extends aCssMinifierPlugin { public function apply(aCssToken &amp;$token) { if (class_exists(&quot;JSMin&quot;) &amp;&amp; stripos($token-&gt;Value, &quot;expression(&quot;) !== false) { $value = $token-&gt;Value; $value = substr($token-&gt;Value, stripos($token-&gt;Value, &quot;expression(&quot;) + 10); $value = trim(JSMin::minify($value)); $token-&gt;Value = &quot;expression(&quot; . $value . &quot;)&quot;; } return false; } public function getTriggerTokens() { return array ( &quot;CssAtFontFaceDeclarationToken&quot;, &quot;CssAtPageDeclarationToken&quot;, &quot;CssRulesetDeclarationToken&quot; ); } } class CssCompressColorValuesMinifierPlugin extends aCssMinifierPlugin { private $reMatch = &quot;/\#([0-9a-f]{6})/iS&quot;; public function apply(aCssToken &amp;$token) { if (strpos($token-&gt;Value, &quot;#&quot;) !== false &amp;&amp; preg_match($this-&gt;reMatch, $token-&gt;Value, $m)) { $value = strtolower($m[1]); if ($value[0] == $value[1] &amp;&amp; $value[2] == $value[3] &amp;&amp; $value[4] == $value[5]) { $token-&gt;Value = str_replace($m[0], &quot;#&quot; . $value[0] . $value[2] . $value[4], $token-&gt;Value); } } return false; } public function getTriggerTokens() { return array ( &quot;CssAtFontFaceDeclarationToken&quot;, &quot;CssAtPageDeclarationToken&quot;, &quot;CssRulesetDeclarationToken&quot; ); } } class CssCommentToken extends aCssToken { public $Comment = &quot;&quot;; public function __construct($comment) { $this-&gt;Comment = $comment; } public function __toString() { return $this-&gt;Comment; } } class CssCommentParserPlugin extends aCssParserPlugin { public function getTriggerChars() { return array(&quot;*&quot;, &quot;/&quot;); } public function getTriggerStates() { return false; } private $restoreBuffer = &quot;&quot;; public function parse($index, $char, $previousChar, $state) { if ($char === &quot;*&quot; &amp;&amp; $previousChar === &quot;/&quot; &amp;&amp; $state !== &quot;T_COMMENT&quot;) { $this-&gt;parser-&gt;pushState(&quot;T_COMMENT&quot;); $this-&gt;parser-&gt;setExclusive(__CLASS__); $this-&gt;restoreBuffer = substr($this-&gt;parser-&gt;getAndClearBuffer(), 0, -2); } elseif ($char === &quot;/&quot; &amp;&amp; $previousChar === &quot;*&quot; &amp;&amp; $state === &quot;T_COMMENT&quot;) { $this-&gt;parser-&gt;popState(); $this-&gt;parser-&gt;unsetExclusive(); $this-&gt;parser-&gt;appendToken(new CssCommentToken(&quot;/*&quot; . $this-&gt;parser-&gt;getAndClearBuffer())); $this-&gt;parser-&gt;setBuffer($this-&gt;restoreBuffer); } else { return false; } return true; } } class CssAtVariablesStartToken extends aCssAtBlockStartToken { public $MediaTypes = array(); public function __construct($mediaTypes = null) { $this-&gt;MediaTypes = $mediaTypes ? $mediaTypes : array(&quot;all&quot;); } public function __toString() { return &quot;&quot;; } } class CssAtVariablesParserPlugin extends aCssParserPlugin { public function getTriggerChars() { return array(&quot;@&quot;, &quot;{&quot;, &quot;}&quot;, &quot;:&quot;, &quot;;&quot;); } public function getTriggerStates() { return array(&quot;T_DOCUMENT&quot;, &quot;T_AT_VARIABLES::PREPARE&quot;, &quot;T_AT_VARIABLES&quot;, &quot;T_AT_VARIABLES_DECLARATION&quot;); } public function parse($index, $char, $previousChar, $state) { if ($char === &quot;@&quot; &amp;&amp; $state === &quot;T_DOCUMENT&quot; &amp;&amp; strtolower(substr($this-&gt;parser-&gt;getSource(), $index, 10)) === &quot;@variables&quot;) { $this-&gt;parser-&gt;pushState(&quot;T_AT_VARIABLES::PREPARE&quot;); $this-&gt;parser-&gt;clearBuffer(); return $index + 10; } elseif ($char === &quot;{&quot; &amp;&amp; $state === &quot;T_AT_VARIABLES::PREPARE&quot;) { $this-&gt;parser-&gt;setState(&quot;T_AT_VARIABLES&quot;); $mediaTypes = array_filter(array_map(&quot;trim&quot;, explode(&quot;,&quot;, $this-&gt;parser-&gt;getAndClearBuffer(&quot;{&quot;)))); $this-&gt;parser-&gt;appendToken(new CssAtVariablesStartToken($mediaTypes)); } if ($char === &quot;:&quot; &amp;&amp; $state === &quot;T_AT_VARIABLES&quot;) { $this-&gt;buffer = $this-&gt;parser-&gt;getAndClearBuffer(&quot;:&quot;); $this-&gt;parser-&gt;pushState(&quot;T_AT_VARIABLES_DECLARATION&quot;); } elseif ($char === &quot;:&quot; &amp;&amp; $state === &quot;T_AT_VARIABLES_DECLARATION&quot;) { if ($this-&gt;buffer === &quot;filter&quot;) { return false; } CssMin::triggerError(new CssError(__FILE__, __LINE__, __METHOD__ . &quot;: Unterminated @variables declaration&quot;, $this-&gt;buffer . &quot;:&quot; . $this-&gt;parser-&gt;getBuffer() . &quot;_&quot;)); } elseif (($char === &quot;;&quot; || $char === &quot;}&quot;) &amp;&amp; $state === &quot;T_AT_VARIABLES_DECLARATION&quot;) { $value = $this-&gt;parser-&gt;getAndClearBuffer(&quot;;}&quot;); if (strtolower(substr($value, -10, 10)) === &quot;!important&quot;) { $value = trim(substr($value, 0, -10)); $isImportant = true; } else { $isImportant = false; } $this-&gt;parser-&gt;popState(); $this-&gt;parser-&gt;appendToken(new CssAtVariablesDeclarationToken($this-&gt;buffer, $value, $isImportant)); $this-&gt;buffer = &quot;&quot;; } elseif ($char === &quot;}&quot; &amp;&amp; $state === &quot;T_AT_VARIABLES&quot;) { $this-&gt;parser-&gt;popState(); $this-&gt;parser-&gt;clearBuffer(); $this-&gt;parser-&gt;appendToken(new CssAtVariablesEndToken()); } else { return false; } return true; } } class CssAtVariablesEndToken extends aCssAtBlockEndToken { public function __toString() { return &quot;&quot;; } } class CssAtVariablesDeclarationToken extends aCssDeclarationToken { public function __toString() { return &quot;&quot;; } } class CssAtPageStartToken extends aCssAtBlockStartToken { public $Selector = &quot;&quot;; public function __construct($selector = &quot;&quot;) { $this-&gt;Selector = $selector; } public function __toString() { return &quot;@page&quot; . ($this-&gt;Selector ? &quot; &quot; . $this-&gt;Selector : &quot;&quot;) . &quot;{&quot;; } } class CssAtPageParserPlugin extends aCssParserPlugin { public function getTriggerChars() { return array(&quot;@&quot;, &quot;{&quot;, &quot;}&quot;, &quot;:&quot;, &quot;;&quot;); } public function getTriggerStates() { return array(&quot;T_DOCUMENT&quot;, &quot;T_AT_PAGE::SELECTOR&quot;, &quot;T_AT_PAGE&quot;, &quot;T_AT_PAGE_DECLARATION&quot;); } public function parse($index, $char, $previousChar, $state) { if ($char === &quot;@&quot; &amp;&amp; $state === &quot;T_DOCUMENT&quot; &amp;&amp; strtolower(substr($this-&gt;parser-&gt;getSource(), $index, 5)) === &quot;@page&quot;) { $this-&gt;parser-&gt;pushState(&quot;T_AT_PAGE::SELECTOR&quot;); $this-&gt;parser-&gt;clearBuffer(); return $index + 5; } elseif ($char === &quot;{&quot; &amp;&amp; $state === &quot;T_AT_PAGE::SELECTOR&quot;) { $selector = $this-&gt;parser-&gt;getAndClearBuffer(&quot;{&quot;); $this-&gt;parser-&gt;setState(&quot;T_AT_PAGE&quot;); $this-&gt;parser-&gt;clearBuffer(); $this-&gt;parser-&gt;appendToken(new CssAtPageStartToken($selector)); } elseif ($char === &quot;:&quot; &amp;&amp; $state === &quot;T_AT_PAGE&quot;) { $this-&gt;parser-&gt;pushState(&quot;T_AT_PAGE_DECLARATION&quot;); $this-&gt;buffer = $this-&gt;parser-&gt;getAndClearBuffer(&quot;:&quot;, true); } elseif ($char === &quot;:&quot; &amp;&amp; $state === &quot;T_AT_PAGE_DECLARATION&quot;) { if ($this-&gt;buffer === &quot;filter&quot;) { return false; } CssMin::triggerError(new CssError(__FILE__, __LINE__, __METHOD__ . &quot;: Unterminated @page declaration&quot;, $this-&gt;buffer . &quot;:&quot; . $this-&gt;parser-&gt;getBuffer() . &quot;_&quot;)); } elseif (($char === &quot;;&quot; || $char === &quot;}&quot;) &amp;&amp; $state == &quot;T_AT_PAGE_DECLARATION&quot;) { $value = $this-&gt;parser-&gt;getAndClearBuffer(&quot;;}&quot;); if (strtolower(substr($value, -10, 10)) == &quot;!important&quot;) { $value = trim(substr($value, 0, -10)); $isImportant = true; } else { $isImportant = false; } $this-&gt;parser-&gt;popState(); $this-&gt;parser-&gt;appendToken(new CssAtPageDeclarationToken($this-&gt;buffer, $value, $isImportant)); if ($char === &quot;}&quot;) { $this-&gt;parser-&gt;popState(); $this-&gt;parser-&gt;appendToken(new CssAtPageEndToken()); } $this-&gt;buffer = &quot;&quot;; } elseif ($char === &quot;}&quot; &amp;&amp; $state === &quot;T_AT_PAGE&quot;) { $this-&gt;parser-&gt;popState(); $this-&gt;parser-&gt;clearBuffer(); $this-&gt;parser-&gt;appendToken(new CssAtPageEndToken()); } else { return false; } return true; } } class CssAtPageEndToken extends aCssAtBlockEndToken { } class CssAtPageDeclarationToken extends aCssDeclarationToken { } class CssAtMediaStartToken extends aCssAtBlockStartToken { public function __construct(array $mediaTypes = array()) { $this-&gt;MediaTypes = $mediaTypes; } public function __toString() { return &quot;@media &quot; . implode(&quot;,&quot;, $this-&gt;MediaTypes) . &quot;{&quot;; } } class CssAtMediaParserPlugin extends aCssParserPlugin { public function getTriggerChars() { return array(&quot;@&quot;, &quot;{&quot;, &quot;}&quot;); } public function getTriggerStates() { return array(&quot;T_DOCUMENT&quot;, &quot;T_AT_MEDIA::PREPARE&quot;, &quot;T_AT_MEDIA&quot;); } public function parse($index, $char, $previousChar, $state) { if ($char === &quot;@&quot; &amp;&amp; $state === &quot;T_DOCUMENT&quot; &amp;&amp; strtolower(substr($this-&gt;parser-&gt;getSource(), $index, 6)) === &quot;@media&quot;) { $this-&gt;parser-&gt;pushState(&quot;T_AT_MEDIA::PREPARE&quot;); $this-&gt;parser-&gt;clearBuffer(); return $index + 6; } elseif ($char === &quot;{&quot; &amp;&amp; $state === &quot;T_AT_MEDIA::PREPARE&quot;) { $mediaTypes = array_filter(array_map(&quot;trim&quot;, explode(&quot;,&quot;, $this-&gt;parser-&gt;getAndClearBuffer(&quot;{&quot;)))); $this-&gt;parser-&gt;setMediaTypes($mediaTypes); $this-&gt;parser-&gt;setState(&quot;T_AT_MEDIA&quot;); $this-&gt;parser-&gt;appendToken(new CssAtMediaStartToken($mediaTypes)); } elseif ($char === &quot;}&quot; &amp;&amp; $state === &quot;T_AT_MEDIA&quot;) { $this-&gt;parser-&gt;appendToken(new CssAtMediaEndToken()); $this-&gt;parser-&gt;clearBuffer(); $this-&gt;parser-&gt;unsetMediaTypes(); $this-&gt;parser-&gt;popState(); } else { return false; } return true; } } class CssAtMediaEndToken extends aCssAtBlockEndToken { } class CssAtKeyframesStartToken extends aCssAtBlockStartToken { public $AtRuleName = &quot;keyframes&quot;; public $Name = &quot;&quot;; public function __construct($name, $atRuleName = null) { $this-&gt;Name = $name; if (!is_null($atRuleName)) { $this-&gt;AtRuleName = $atRuleName; } } public function __toString() { return &quot;@&quot; . $this-&gt;AtRuleName . &quot; \&quot;&quot; . $this-&gt;Name . &quot;\&quot;{&quot;; } } class CssAtKeyframesRulesetStartToken extends aCssRulesetStartToken { public $Selectors = array(); public function __construct(array $selectors = array()) { $this-&gt;Selectors = $selectors; } public function __toString() { return implode(&quot;,&quot;, $this-&gt;Selectors) . &quot;{&quot;; } } class CssAtKeyframesRulesetEndToken extends aCssRulesetEndToken { } class CssAtKeyframesRulesetDeclarationToken extends aCssDeclarationToken { } class CssAtKeyframesParserPlugin extends aCssParserPlugin { private $atRuleName = &quot;&quot;; private $selectors = array(); public function getTriggerChars() { return array(&quot;@&quot;, &quot;{&quot;, &quot;}&quot;, &quot;:&quot;, &quot;,&quot;, &quot;;&quot;); } public function getTriggerStates() { return array(&quot;T_DOCUMENT&quot;, &quot;T_AT_KEYFRAMES::NAME&quot;, &quot;T_AT_KEYFRAMES&quot;, &quot;T_AT_KEYFRAMES_RULESETS&quot;, &quot;T_AT_KEYFRAMES_RULESET&quot;, &quot;T_AT_KEYFRAMES_RULESET_DECLARATION&quot;); } public function parse($index, $char, $previousChar, $state) { if ($char === &quot;@&quot; &amp;&amp; $state === &quot;T_DOCUMENT&quot; &amp;&amp; strtolower(substr($this-&gt;parser-&gt;getSource(), $index, 10)) === &quot;@keyframes&quot;) { $this-&gt;atRuleName = &quot;keyframes&quot;; $this-&gt;parser-&gt;pushState(&quot;T_AT_KEYFRAMES::NAME&quot;); $this-&gt;parser-&gt;clearBuffer(); return $index + 10; } elseif ($char === &quot;@&quot; &amp;&amp; $state === &quot;T_DOCUMENT&quot; &amp;&amp; strtolower(substr($this-&gt;parser-&gt;getSource(), $index, 15)) === &quot;@-moz-keyframes&quot;) { $this-&gt;atRuleName = &quot;-moz-keyframes&quot;; $this-&gt;parser-&gt;pushState(&quot;T_AT_KEYFRAMES::NAME&quot;); $this-&gt;parser-&gt;clearBuffer(); return $index + 15; } elseif ($char === &quot;@&quot; &amp;&amp; $state === &quot;T_DOCUMENT&quot; &amp;&amp; strtolower(substr($this-&gt;parser-&gt;getSource(), $index, 18)) === &quot;@-webkit-keyframes&quot;) { $this-&gt;atRuleName = &quot;-webkit-keyframes&quot;; $this-&gt;parser-&gt;pushState(&quot;T_AT_KEYFRAMES::NAME&quot;); $this-&gt;parser-&gt;clearBuffer(); return $index + 18; } elseif ($char === &quot;{&quot; &amp;&amp; $state === &quot;T_AT_KEYFRAMES::NAME&quot;) { $name = $this-&gt;parser-&gt;getAndClearBuffer(&quot;{\&quot;&#x27;&quot;); $this-&gt;parser-&gt;setState(&quot;T_AT_KEYFRAMES_RULESETS&quot;); $this-&gt;parser-&gt;clearBuffer(); $this-&gt;parser-&gt;appendToken(new CssAtKeyframesStartToken($name, $this-&gt;atRuleName)); } if ($char === &quot;,&quot; &amp;&amp; $state === &quot;T_AT_KEYFRAMES_RULESETS&quot;) { $this-&gt;selectors[] = $this-&gt;parser-&gt;getAndClearBuffer(&quot;,{&quot;); } elseif ($char === &quot;{&quot; &amp;&amp; $state === &quot;T_AT_KEYFRAMES_RULESETS&quot;) { if ($this-&gt;parser-&gt;getBuffer() !== &quot;&quot;) { $this-&gt;selectors[] = $this-&gt;parser-&gt;getAndClearBuffer(&quot;,{&quot;); $this-&gt;parser-&gt;pushState(&quot;T_AT_KEYFRAMES_RULESET&quot;); $this-&gt;parser-&gt;appendToken(new CssAtKeyframesRulesetStartToken($this-&gt;selectors)); $this-&gt;selectors = array(); } } elseif ($char === &quot;:&quot; &amp;&amp; $state === &quot;T_AT_KEYFRAMES_RULESET&quot;) { $this-&gt;parser-&gt;pushState(&quot;T_AT_KEYFRAMES_RULESET_DECLARATION&quot;); $this-&gt;buffer = $this-&gt;parser-&gt;getAndClearBuffer(&quot;:;&quot;, true); } elseif ($char === &quot;:&quot; &amp;&amp; $state === &quot;T_AT_KEYFRAMES_RULESET_DECLARATION&quot;) { if ($this-&gt;buffer === &quot;filter&quot;) { return false; } CssMin::triggerError(new CssError(__FILE__, __LINE__, __METHOD__ . &quot;: Unterminated @keyframes ruleset declaration&quot;, $this-&gt;buffer . &quot;:&quot; . $this-&gt;parser-&gt;getBuffer() . &quot;_&quot;)); } elseif (($char === &quot;;&quot; || $char === &quot;}&quot;) &amp;&amp; $state === &quot;T_AT_KEYFRAMES_RULESET_DECLARATION&quot;) { $value = $this-&gt;parser-&gt;getAndClearBuffer(&quot;;}&quot;); if (strtolower(substr($value, -10, 10)) === &quot;!important&quot;) { $value = trim(substr($value, 0, -10)); $isImportant = true; } else { $isImportant = false; } $this-&gt;parser-&gt;popState(); $this-&gt;parser-&gt;appendToken(new CssAtKeyframesRulesetDeclarationToken($this-&gt;buffer, $value, $isImportant)); if ($char === &quot;}&quot;) { $this-&gt;parser-&gt;appendToken(new CssAtKeyframesRulesetEndToken()); $this-&gt;parser-&gt;popState(); } $this-&gt;buffer = &quot;&quot;; } elseif ($char === &quot;}&quot; &amp;&amp; $state === &quot;T_AT_KEYFRAMES_RULESET&quot;) { $this-&gt;parser-&gt;clearBuffer(); $this-&gt;parser-&gt;popState(); $this-&gt;parser-&gt;appendToken(new CssAtKeyframesRulesetEndToken()); } elseif ($char === &quot;}&quot; &amp;&amp; $state === &quot;T_AT_KEYFRAMES_RULESETS&quot;) { $this-&gt;parser-&gt;clearBuffer(); $this-&gt;parser-&gt;popState(); $this-&gt;parser-&gt;appendToken(new CssAtKeyframesEndToken()); } else { return false; } return true; } } class CssAtKeyframesEndToken extends aCssAtBlockEndToken { } class CssAtImportToken extends aCssToken { public $Import = &quot;&quot;; public $MediaTypes = array(); public function __construct($import, $mediaTypes) { $this-&gt;Import = $import; $this-&gt;MediaTypes = $mediaTypes ? $mediaTypes : array(); } public function __toString() { return &quot;@import \&quot;&quot; . $this-&gt;Import . &quot;\&quot;&quot; . (count($this-&gt;MediaTypes) &gt; 0 ? &quot; &quot; . implode(&quot;,&quot;, $this-&gt;MediaTypes) : &quot;&quot;). &quot;;&quot;; } } class CssAtImportParserPlugin extends aCssParserPlugin { public function getTriggerChars() { return array(&quot;@&quot;, &quot;;&quot;, &quot;,&quot;, &quot;\n&quot;); } public function getTriggerStates() { return array(&quot;T_DOCUMENT&quot;, &quot;T_AT_IMPORT&quot;); } public function parse($index, $char, $previousChar, $state) { if ($char === &quot;@&quot; &amp;&amp; $state === &quot;T_DOCUMENT&quot; &amp;&amp; strtolower(substr($this-&gt;parser-&gt;getSource(), $index, 7)) === &quot;@import&quot;) { $this-&gt;parser-&gt;pushState(&quot;T_AT_IMPORT&quot;); $this-&gt;parser-&gt;clearBuffer(); return $index + 7; } elseif (($char === &quot;;&quot; || $char === &quot;\n&quot;) &amp;&amp; $state === &quot;T_AT_IMPORT&quot;) { $this-&gt;buffer = $this-&gt;parser-&gt;getAndClearBuffer(&quot;;&quot;); $pos = false; foreach (array(&quot;)&quot;, &quot;\&quot;&quot;, &quot;&#x27;&quot;) as $needle) { if (($pos = strrpos($this-&gt;buffer, $needle)) !== false) { break; } } $import = substr($this-&gt;buffer, 0, $pos + 1); if (stripos($import, &quot;url(&quot;) === 0) { $import = substr($import, 4, -1); } $import = trim($import, &quot; \t\n\r\0\x0B&#x27;\&quot;&quot;); $mediaTypes = array_filter(array_map(&quot;trim&quot;, explode(&quot;,&quot;, trim(substr($this-&gt;buffer, $pos + 1), &quot; \t\n\r\0\x0B{&quot;)))); if ($pos) { $this-&gt;parser-&gt;appendToken(new CssAtImportToken($import, $mediaTypes)); } else { CssMin::triggerError(new CssError(__FILE__, __LINE__, __METHOD__ . &quot;: Invalid @import at-rule syntax&quot;, $this-&gt;parser-&gt;buffer)); } $this-&gt;parser-&gt;popState(); } else { return false; } return true; } } class CssAtFontFaceStartToken extends aCssAtBlockStartToken { public function __toString() { return &quot;@font-face{&quot;; } } class CssAtFontFaceParserPlugin extends aCssParserPlugin { public function getTriggerChars() { return array(&quot;@&quot;, &quot;{&quot;, &quot;}&quot;, &quot;:&quot;, &quot;;&quot;); } public function getTriggerStates() { return array(&quot;T_DOCUMENT&quot;, &quot;T_AT_FONT_FACE::PREPARE&quot;, &quot;T_AT_FONT_FACE&quot;, &quot;T_AT_FONT_FACE_DECLARATION&quot;); } public function parse($index, $char, $previousChar, $state) { if ($char === &quot;@&quot; &amp;&amp; $state === &quot;T_DOCUMENT&quot; &amp;&amp; strtolower(substr($this-&gt;parser-&gt;getSource(), $index, 10)) === &quot;@font-face&quot;) { $this-&gt;parser-&gt;pushState(&quot;T_AT_FONT_FACE::PREPARE&quot;); $this-&gt;parser-&gt;clearBuffer(); return $index + 10; } elseif ($char === &quot;{&quot; &amp;&amp; $state === &quot;T_AT_FONT_FACE::PREPARE&quot;) { $this-&gt;parser-&gt;setState(&quot;T_AT_FONT_FACE&quot;); $this-&gt;parser-&gt;clearBuffer(); $this-&gt;parser-&gt;appendToken(new CssAtFontFaceStartToken()); } elseif ($char === &quot;:&quot; &amp;&amp; $state === &quot;T_AT_FONT_FACE&quot;) { $this-&gt;parser-&gt;pushState(&quot;T_AT_FONT_FACE_DECLARATION&quot;); $this-&gt;buffer = $this-&gt;parser-&gt;getAndClearBuffer(&quot;:&quot;, true); } elseif ($char === &quot;:&quot; &amp;&amp; $state === &quot;T_AT_FONT_FACE_DECLARATION&quot;) { if ($this-&gt;buffer === &quot;filter&quot;) { return false; } CssMin::triggerError(new CssError(__FILE__, __LINE__, __METHOD__ . &quot;: Unterminated @font-face declaration&quot;, $this-&gt;buffer . &quot;:&quot; . $this-&gt;parser-&gt;getBuffer() . &quot;_&quot;)); } elseif (($char === &quot;;&quot; || $char === &quot;}&quot;) &amp;&amp; $state === &quot;T_AT_FONT_FACE_DECLARATION&quot;) { $value = $this-&gt;parser-&gt;getAndClearBuffer(&quot;;}&quot;); if (strtolower(substr($value, -10, 10)) === &quot;!important&quot;) { $value = trim(substr($value, 0, -10)); $isImportant = true; } else { $isImportant = false; } $this-&gt;parser-&gt;popState(); $this-&gt;parser-&gt;appendToken(new CssAtFontFaceDeclarationToken($this-&gt;buffer, $value, $isImportant)); $this-&gt;buffer = &quot;&quot;; if ($char === &quot;}&quot;) { $this-&gt;parser-&gt;appendToken(new CssAtFontFaceEndToken()); $this-&gt;parser-&gt;popState(); } } elseif ($char === &quot;}&quot; &amp;&amp; $state === &quot;T_AT_FONT_FACE&quot;) { $this-&gt;parser-&gt;appendToken(new CssAtFontFaceEndToken()); $this-&gt;parser-&gt;clearBuffer(); $this-&gt;parser-&gt;popState(); } else { return false; } return true; } } class CssAtFontFaceEndToken extends aCssAtBlockEndToken { } class CssAtFontFaceDeclarationToken extends aCssDeclarationToken { } class CssAtCharsetToken extends aCssToken { public $Charset = &quot;&quot;; public function __construct($charset) { $this-&gt;Charset = $charset; } public function __toString() { return &quot;@charset &quot; . $this-&gt;Charset . &quot;;&quot;; } } class CssAtCharsetParserPlugin extends aCssParserPlugin { public function getTriggerChars() { return array(&quot;@&quot;, &quot;;&quot;, &quot;\n&quot;); } public function getTriggerStates() { return array(&quot;T_DOCUMENT&quot;, &quot;T_AT_CHARSET&quot;); } public function parse($index, $char, $previousChar, $state) { if ($char === &quot;@&quot; &amp;&amp; $state === &quot;T_DOCUMENT&quot; &amp;&amp; strtolower(substr($this-&gt;parser-&gt;getSource(), $index, 8)) === &quot;@charset&quot;) { $this-&gt;parser-&gt;pushState(&quot;T_AT_CHARSET&quot;); $this-&gt;parser-&gt;clearBuffer(); return $index + 8; } elseif (($char === &quot;;&quot; || $char === &quot;\n&quot;) &amp;&amp; $state === &quot;T_AT_CHARSET&quot;) { $charset = $this-&gt;parser-&gt;getAndClearBuffer(&quot;;&quot;); $this-&gt;parser-&gt;popState(); $this-&gt;parser-&gt;appendToken(new CssAtCharsetToken($charset)); } else { return false; } return true; } } 
?&gt;
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
